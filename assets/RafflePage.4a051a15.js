import{a as ie,Q as ot}from"./QTabs.c8b0d282.js";import{aF as T,bZ as fe,dj as rt,dk as it,dl as ct,de as q,au as S,J as y,b1 as m,ak as j,al as k,as as t,cl as Q,cP as K,P as x,co as W,cR as $,cr as F,dm as de,cT as E,ah as O,bs as le,aT as we,cc as _e,c7 as xe,bC as ut,aC as Me,b_ as ze,cd as ft,ar as A,bx as c,V as _,cm as dt,cU as mt,aX as ae,bz as pt,a6 as Ie,cX as G,dn as vt,ai as g,a1 as D,dp as yt,cY as gt,cZ as me,b9 as kt,aj as w,dq as ht,cn as J,dr as bt,cQ as ce,c_ as wt,cq as ne}from"./index.d5eb11ab.js";import{Q as ee}from"./QSpace.8dfa427c.js";import{Q as _t}from"./QPage.5a849792.js";import{f as Be,Q as xt,a as pe,b as Se,c as St}from"./calcAmountToTransfer.8e444d7c.js";import{Q as je}from"./QImg.fcb1070c.js";import{Q as R}from"./QCardSection.10d726a7.js";import{Q as B}from"./QSeparator.da97b09e.js";import{Q as Z,a as N}from"./QItem.21209561.js";import{v as Tt,u as $t,j as Pt,w as Te,x as At,e as Ct,k as qt,y as Rt,z as Qt,f as Vt,l as Ot,A as $e,B as Mt,c as Pe,g as zt,C as Ae,D as It,Q as I}from"./QMenu.e426284b.js";import{Q as Bt}from"./QList.4fefc1d9.js";import{Q as te,u as jt,a as Et}from"./QCard.93c501c7.js";import{Q as Ee}from"./QCardActions.de932eaa.js";import{Q as L}from"./QInput.f01ec846.js";import{h as M}from"./handleTransaction.de86a7c9.js";import{_ as Ue,c as De}from"./TokenSelectDropdown.8b663d53.js";import{a as Ut,u as Dt}from"./rtl.2b1bf14c.js";import{_ as Nt}from"./AccountBalance.afa55dba.js";import{c as Lt,Q as Kt}from"./QSelect.19ebe973.js";import{C as Wt}from"./ClosePopup.1c69e7ea.js";import{Q as Ce}from"./QBadge.9538deb9.js";import{t as Ne}from"./token.c82b1f54.js";import{g as Le}from"./extensionType.a72963f5.js";import{f as ue}from"./format_address.d3022ffc.js";import{_ as Ht}from"./plugin-vue_export-helper.21dcd24c.js";import"./uid.42677368.js";import"./QSlideTransition.057b918d.js";import"./use-checkbox.c85efc70.js";import"./use-form.e6fad49f.js";import"./use-key-composition.a5c39b76.js";import"./vaultTransactionCreate.0b4a943d.js";import"./errors.825970a3.js";import"./web3.6c1c0919.js";import"./bigint.582130a3.js";const Ft=[T("rect",{x:"0",y:"0",width:"100",height:"100",fill:"none"}),T("g",{transform:"translate(25 25)"},[T("rect",{x:"-20",y:"-20",width:"40",height:"40",fill:"currentColor",opacity:"0.9"},[T("animateTransform",{attributeName:"transform",type:"scale",from:"1.5",to:"1",repeatCount:"indefinite",begin:"0s",dur:"1s",calcMode:"spline",keySplines:"0.2 0.8 0.2 0.8",keyTimes:"0;1"})])]),T("g",{transform:"translate(75 25)"},[T("rect",{x:"-20",y:"-20",width:"40",height:"40",fill:"currentColor",opacity:"0.8"},[T("animateTransform",{attributeName:"transform",type:"scale",from:"1.5",to:"1",repeatCount:"indefinite",begin:"0.1s",dur:"1s",calcMode:"spline",keySplines:"0.2 0.8 0.2 0.8",keyTimes:"0;1"})])]),T("g",{transform:"translate(25 75)"},[T("rect",{x:"-20",y:"-20",width:"40",height:"40",fill:"currentColor",opacity:"0.7"},[T("animateTransform",{attributeName:"transform",type:"scale",from:"1.5",to:"1",repeatCount:"indefinite",begin:"0.3s",dur:"1s",calcMode:"spline",keySplines:"0.2 0.8 0.2 0.8",keyTimes:"0;1"})])]),T("g",{transform:"translate(75 75)"},[T("rect",{x:"-20",y:"-20",width:"40",height:"40",fill:"currentColor",opacity:"0.6"},[T("animateTransform",{attributeName:"transform",type:"scale",from:"1.5",to:"1",repeatCount:"indefinite",begin:"0.2s",dur:"1s",calcMode:"spline",keySplines:"0.2 0.8 0.2 0.8",keyTimes:"0;1"})])])];var Gt=fe({name:"QSpinnerCube",props:rt,setup(e){const{cSize:a,classes:i}=it(e);return()=>T("svg",{class:i.value,width:a.value,height:a.value,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid"},Ft)}});const P=ct("raffleStore",{state:()=>({raffles:[]}),getters:{getRunningRaffles(e){return e.raffles.filter(a=>Object.keys(a.account.state)[0]=="running"||Object.keys(a.account.state)[0]=="full"||Object.keys(a.account.state)[0]=="claimprize")}},actions:{async updateStore(){if(q())try{const e=q().pg_raffle.value;this.raffles=await(e==null?void 0:e.account.raffle.all()),console.log("[Updated] RaffleStore")}catch(e){console.error(e)}}}}),Yt={class:"col q-pa-sm"},Xt=k("p",{class:"text-overline"},"Add a prize:",-1),Zt={class:"col q-gutter-y-sm"},Jt={class:"row"},ea=S({__name:"RafflePrepare",props:["raffle"],setup(e){const a=y(1),i=y(""),r=y(""),n=e;y([]);async function l(){var s,o,u,v;try{const p=new K,d=(s=q())==null?void 0:s.pg_raffle.value,f=new x(r.value.mint),h=(await W().connection.getParsedTokenAccountsByOwner($(),{mint:f})).value[0].pubkey,V=new x(n.raffle.publicKey.toString()),b=await W().connection.getParsedAccountInfo(f);console.log((o=b.value)==null?void 0:o.data.parsed.info.decimals),i.value=((u=F().token_list.find(z=>z.address==f))==null?void 0:u.logoURI)??"",p.add(await(d==null?void 0:d.methods.prepare(new de(a.value*Math.pow(10,(v=b.value)==null?void 0:v.data.parsed.info.decimals)),i.value).accountsPartial({creator:$(),raffle:V,from:h,prizeMint:f}).instruction())),await M(p,"[Raffle] prepare"),await P().updateStore()}catch(p){E.create({color:"red",message:`${p}`,timeout:5e3})}}return(s,o)=>(m(),j("div",Yt,[Xt,k("div",Zt,[t(Ue,{label:"","textbox-label":"Select prize",onToken_account_selected:o[0]||(o[0]=u=>r.value=u)}),k("div",Jt,[t(L,{class:"col",filled:"",square:"",modelValue:a.value,"onUpdate:modelValue":o[1]||(o[1]=u=>a.value=u),type:"number",label:"Count"},null,8,["modelValue"]),t(Q,{filled:"",square:"",class:"col-2",color:"primary",icon:"send",onClick:o[2]||(o[2]=u=>l())})])])]))}});var ta=fe({name:"QTooltip",inheritAttrs:!1,props:{...Tt,...$t,...Pt,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{default:"jump-down"},transitionHide:{default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:Te},self:{type:String,default:"top middle",validator:Te},offset:{type:Array,default:()=>[14,14],validator:At},scrollTarget:{default:void 0},delay:{type:Number,default:0},hideDelay:{type:Number,default:0}},emits:[...Ct],setup(e,{slots:a,emit:i,attrs:r}){let n,l;const s=Me(),{proxy:{$q:o}}=s,u=y(null),v=y(!1),p=O(()=>Ae(e.anchor,o.lang.rtl)),d=O(()=>Ae(e.self,o.lang.rtl)),f=O(()=>e.persistent!==!0),{registerTick:h,removeTick:V}=Ut(),{registerTimeout:b}=Dt(),{transitionProps:z,transitionStyle:He}=qt(e),{localScrollTarget:ve,changeScrollEvent:Fe,unconfigureScrollTarget:Ge}=Rt(e,he),{anchorEl:U,canShow:Ye,anchorEvents:Y}=Qt({showing:v,configureAnchorEl:nt}),{show:Xe,hide:oe}=Vt({showing:v,canShow:Ye,handleShow:Je,handleHide:et,hideOnRouteChange:f,processOnMount:!0});Object.assign(Y,{delayShow:tt,delayHide:at});const{showPortal:ye,hidePortal:ge,renderPortal:Ze}=Ot(s,u,st,"tooltip");if(o.platform.is.mobile===!0){const C={anchorEl:U,innerRef:u,onClickOutside(H){return oe(H),H.target.classList.contains("q-dialog__backdrop")&&ft(H),!0}},re=O(()=>e.modelValue===null&&e.persistent!==!0&&v.value===!0);le(re,H=>{(H===!0?It:$e)(C)}),we(()=>{$e(C)})}function Je(C){ye(),h(()=>{l=new MutationObserver(()=>X()),l.observe(u.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),X(),he()}),n===void 0&&(n=le(()=>o.screen.width+"|"+o.screen.height+"|"+e.self+"|"+e.anchor+"|"+o.lang.rtl,X)),b(()=>{ye(!0),i("show",C)},e.transitionDuration)}function et(C){V(),ge(),ke(),b(()=>{ge(!0),i("hide",C)},e.transitionDuration)}function ke(){l!==void 0&&(l.disconnect(),l=void 0),n!==void 0&&(n(),n=void 0),Ge(),_e(Y,"tooltipTemp")}function X(){Mt({targetEl:u.value,offset:e.offset,anchorEl:U.value,anchorOrigin:p.value,selfOrigin:d.value,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function tt(C){if(o.platform.is.mobile===!0){Pe(),document.body.classList.add("non-selectable");const re=U.value,H=["touchmove","touchcancel","touchend","click"].map(be=>[re,be,"delayHide","passiveCapture"]);xe(Y,"tooltipTemp",H)}b(()=>{Xe(C)},e.delay)}function at(C){o.platform.is.mobile===!0&&(_e(Y,"tooltipTemp"),Pe(),setTimeout(()=>{document.body.classList.remove("non-selectable")},10)),b(()=>{oe(C)},e.hideDelay)}function nt(){if(e.noParentEvent===!0||U.value===null)return;const C=o.platform.is.mobile===!0?[[U.value,"touchstart","delayShow","passive"]]:[[U.value,"mouseenter","delayShow","passive"],[U.value,"mouseleave","delayHide","passive"]];xe(Y,"anchor",C)}function he(){if(U.value!==null||e.scrollTarget!==void 0){ve.value=zt(U.value,e.scrollTarget);const C=e.noParentEvent===!0?X:oe;Fe(ve.value,C)}}function lt(){return v.value===!0?T("div",{...r,ref:u,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",r.class],style:[r.style,He.value],role:"tooltip"},ze(a.default)):null}function st(){return T(ut,z.value,lt)}return we(ke),Object.assign(s.proxy,{updatePosition:X}),Ze}});const aa={key:0,class:"col q-pa-sm q-gutter-y-sm"},na=k("p",{class:"text-overline"},"Buy Ticket(s)",-1),la={class:"row"},sa={class:"row"},oa={class:"text-caption text-right text-weight-thin"},ra={class:"col"},ia={key:1,class:"row full-width justify-center"},ca=S({__name:"RaffleBuyTicket",props:["raffle","tickets"],setup(e){const a=y(),i=e,r=O(()=>!mt().publicKey.value);async function n(){var f,h,V;const l=new K,s=(f=q())==null?void 0:f.pg_raffle.value,o=(h=q())==null?void 0:h.pg_whitelist.value,u=new x(i.raffle.account.ticketMint.toString()),v=(await W().connection.getParsedTokenAccountsByOwner($(),{mint:u})).value[0].pubkey,p=new x(i.raffle.publicKey.toString());let d=Be();try{l.add(await(s==null?void 0:s.methods.buyTickets(new de(a.value)).accountsPartial({signer:$(),raffle:p,entrant:$(),ticketsMint:u,from:v,whitelist:d,whitelistEntry:x.findProgramAddressSync([(V=$())==null?void 0:V.toBytes(),d.toBytes()],o==null?void 0:o.programId)[0],whitelistProgram:o==null?void 0:o.programId}).instruction())),await M(l,"[Raffle] buy ticket"),await P().updateStore()}catch(b){E.create({color:"danger",message:`${b}`,timeout:5e3})}}return(l,s)=>r.value?(m(),j("div",ia,[t(_(dt),{class:"",dark:""})])):(m(),j("div",aa,[na,k("div",la,[t(L,{square:"",filled:"",outlined:"",type:"number",class:"col",label:"Amount",modelValue:a.value,"onUpdate:modelValue":s[0]||(s[0]=o=>a.value=o)},null,8,["modelValue"]),t(Q,{square:"",disable:!a.value,color:"primary",icon:"send",onClick:s[1]||(s[1]=o=>n())},null,8,["disable"])]),k("div",sa,[t(ee),k("p",oa,[A(" 0.001\u25CE fee "),t(ta,{anchor:"bottom right",self:"top middle"},{default:c(()=>[A(" cover deployment costs ")]),_:1})])]),k("div",ra,[t(Nt,{mint:e.raffle.account.ticketMint},null,8,["mint"])])]))}}),ua=k("source",{src:"Burningticket.mp4",type:"video/mp4"},null,-1),fa=S({__name:"BurningTicket",setup(e){const a=y();return ae(()=>{a.value.playbackRate=.3,console.log(a.value)}),(i,r)=>(m(),j("video",{ref_key:"ticket_burning",ref:a,autoplay:"",playbackspeed:"0.1"},[ua,A(" Your browser does not support the video tag. ")],512))}}),da=k("div",{class:"text-h6 text-center"},"Drawing...",-1),ma=S({__name:"RaffleRevealWinner",props:["raffle","is_admin"],setup(e){y();const a=e,i=y(!1);le(()=>i.value,()=>{i.value==!1&&P().updateStore()});async function r(){var n;try{const l=new K,s=(n=q())==null?void 0:n.pg_raffle.value,o=new x(a.raffle.publicKey.toString());let[u,v]=x.findProgramAddressSync([G("tickets"),o.toBytes()],s==null?void 0:s.programId);l.add(await(s==null?void 0:s.methods.revealWinners().accounts({raffle:o,tickets:u,recentBlockHashes:vt}).instruction())),await M(l,"[Raffle] reveal winner"),i.value=!0}catch(l){E.create({color:"red",message:`${l}`,timeout:5e3})}}return(n,l)=>(m(),j(Ie,null,[t(Q,{square:"",class:"row",color:"primary",icon:"send",label:"Reveal Winner",onClick:l[0]||(l[0]=s=>r())}),t(Lt,{maximized:!0,modelValue:i.value,"onUpdate:modelValue":l[2]||(l[2]=s=>i.value=s)},{default:c(()=>[t(te,{flat:"",square:"",class:""},{default:c(()=>[t(R,null,{default:c(()=>[da]),_:1}),t(R,{class:"q-pt-none row"},{default:c(()=>[t(ee),t(fa),t(ee)]),_:1}),t(Ee,{align:"right"},{default:c(()=>[pt(t(Q,{flat:"",label:"close",color:"primary",onClick:l[1]||(l[1]=s=>_(P)().update_raffles())},null,512),[[Wt]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),pa={class:"absolute-full flex flex-center"};var Ke=(e=>(e.created="orange",e.ready="orange",e.paused="pink",e.full="purple",e.claimprize="purple",e.claimtickets="purple",e.running="primary",e))(Ke||{});const va=S({__name:"RaffleStateBadge",props:["raffle","tickets"],setup(e){const a=e,i=O(()=>{var r,n;return((r=a.tickets)==null?void 0:r.sold)/((n=a.tickets)==null?void 0:n.total)});return(r,n)=>Object.keys(e.raffle.account.state)[0]=="running"?(m(),g(xt,{key:0,size:"25px",value:i.value,color:"primary"},{default:c(()=>{var l,s;return[k("div",pa,[t(Ce,{color:"black","text-color":"primary",label:`Tickets: ${(l=e.tickets)==null?void 0:l.sold}/${(s=e.tickets)==null?void 0:s.total}`},null,8,["label"])])]}),_:1},8,["value"])):(m(),g(Ce,{key:1,color:Ke[Object.keys(e.raffle.account.state)[0]],class:"text-h6 justify-center full-width"},{default:c(()=>[A(D(Object.keys(e.raffle.account.state)[0].toUpperCase()),1)]),_:1},8,["color"]))}}),se=new x(yt.address);function ya(e,a){return x.findProgramAddressSync([G("raffle"),G(e),a.toArrayLike(gt.Buffer).reverse()],se)[0]}function ga(e){return x.findProgramAddressSync([G("tickets"),e.toBytes()],se)[0]}function We(e){return x.findProgramAddressSync([G("vaultPrize"),e.toBytes()],se)[0]}function ka(e){return x.findProgramAddressSync([G("vaultTickets"),e.toBytes()],se)[0]}const ha=S({__name:"RaffleClaimPrize",props:["raffle","is_admin"],setup(e){const a=e;async function i(){var r;try{let n=new K;const l=(r=q())==null?void 0:r.pg_raffle.value,s=new x(a.raffle.account.prizeMint.toString()),o=new x(a.raffle.account.winner.toString()),u=await Le(s,o,!0,me,Ne.ASSOCIATED_PROGRAM_ID);await W().connection.getAccountInfo(u)===null&&n.add(De($(),u,o,s));const v=new x(a.raffle.publicKey.toString()),p=We(v);n.add(await(l==null?void 0:l.methods.claimPrize().accountsPartial({raffle:v,prizeMint:s,prizeVault:p,to:u}).instruction())),await M(n,"[Raffle] Claim Prize"),await P().updateStore()}catch(n){E.create({color:"red",message:`${n}`,timeout:5e3,position:"bottom-right"})}}return(r,n)=>(m(),g(Q,{color:"primary",icon:"send",label:"Claim Prize",onClick:n[0]||(n[0]=l=>i())}))}});async function ba(e){try{return!!await W().connection.getAccountInfo(e)}catch(a){return console.error("Error checking account:",a),!1}}const wa=S({__name:"RaffleClose",props:["raffle"],setup(e){const a=e;async function i(){var r;try{const n=new K,l=(r=q())==null?void 0:r.pg_raffle.value;let s=a.raffle.publicKey;const o=ga(s),u=ka(s);let v=We(s);await ba(v)||(v=null),n.add(await(l==null?void 0:l.methods.close().accountsPartial({creator:$(),raffle:s,tickets:o,ticketsVault:u,prizeVault:v}).instruction())),await M(n,"[Raffle] close"),await P().updateStore()}catch(n){E.create({color:"red",message:`${n}`,timeout:5e3})}}return(r,n)=>(m(),g(Q,{square:"",color:"primary",icon:"send",label:"Close Raffle",onClick:n[0]||(n[0]=l=>i())}))}}),_a=S({__name:"RaffleClaimTickets",props:["raffle","is_admin"],setup(e){const a=e;async function i(){var r;try{const n=new K,l=(r=q())==null?void 0:r.pg_raffle.value,s=new x(a.raffle.account.ticketMint.toString()),o=await Le(s,$(),!0,me,Ne.ASSOCIATED_PROGRAM_ID);await W().connection.getAccountInfo(o)===null&&n.add(De($(),o,$(),s)),n.add(await(l==null?void 0:l.methods.claimTickets().accountsPartial({creator:$(),raffle:a.raffle.publicKey,ticketsMint:s,to:o}).instruction())),await M(n,"[Raffle Claim Tickets]"),await P().updateStore()}catch(n){E.create({color:"red",message:`${n}`,timeout:5e3,position:"bottom-right"})}}return(r,n)=>(m(),g(Q,{color:"primary",icon:"send",label:"Claim Tickets",onClick:n[0]||(n[0]=l=>i())}))}}),xa=S({__name:"AccountsTable",props:["accounts"],setup(e){const a=y({rowsPerPage:0}),i=y([{name:"mint",required:!0,label:"Mint",align:"left",field:"mint",field:r=>{var n,l;return((n=F().token_list.find(s=>{var o;return s.address==((o=r.mint)==null?void 0:o.toString())}))==null?void 0:n.name)??((l=r.mint)==null?void 0:l.toString())},sortable:!0},{name:"calories",align:"right",label:"Amount",field:r=>r.tokenAmount.uiAmount,sortable:!0}]);return(r,n)=>{var l,s;return m(),g(pe,{square:"",dense:"",class:"col",title:"Accounts",rows:(s=(l=e.accounts)==null?void 0:l.value)==null?void 0:s.map(o=>o.account.data.parsed.info),columns:i.value,"row-key":"mint","hide-bottom":"",flat:"",pagination:a.value,"onUpdate:pagination":n[0]||(n[0]=o=>a.value=o),"rows-per-page-options":[0]},null,8,["rows","columns","pagination"])}}}),qe=9,Sa=95,Ta=45,Re=5;function $a(e){return e.split("").reduce((a,i)=>(a^i.charCodeAt(0))*-Re,Re)>>>2}function Pa(e="",a=Sa,i=Ta,r=$a){const n=r(e),l=n%qe*(360/qe);return[...Array(e?25:0)].reduce((s,o,u)=>n&1<<u%15?s+`<rect x="${u>14?7-~~(u/5):~~(u/5)}" y="${u%5}" width="1" height="1"/>`:s,`<svg viewBox="-1.5 -1.5 8 8" xmlns="http://www.w3.org/2000/svg" fill="hsl(${l} ${a}% ${i}%)">`)+"</svg>"}const Aa=["innerHTML"],Ca=S({__name:"IconFromSeed",props:{seed:{type:String,default:"default"}},setup(e){const i=y(Pa(e.seed));return(r,n)=>(m(),j("div",{innerHTML:i.value},null,8,Aa))}}),qa=["text","rect","circle","QBtn","QBadge","QChip","QToolbar","QCheckbox","QRadio","QToggle","QSlider","QRange","QInput","QAvatar"],Ra=["wave","pulse","pulse-x","pulse-y","fade","blink","none"];var Qa=fe({name:"QSkeleton",props:{...jt,tag:{type:String,default:"div"},type:{type:String,validator:e=>qa.includes(e),default:"rect"},animation:{type:String,validator:e=>Ra.includes(e),default:"wave"},animationSpeed:{type:[String,Number],default:1500},square:Boolean,bordered:Boolean,size:String,width:String,height:String},setup(e,{slots:a}){const i=Me(),r=Et(e,i.proxy.$q),n=O(()=>{const s=e.size!==void 0?[e.size,e.size]:[e.width,e.height];return{"--q-skeleton-speed":`${e.animationSpeed}ms`,width:s[0],height:s[1]}}),l=O(()=>`q-skeleton q-skeleton--${r.value===!0?"dark":"light"} q-skeleton--type-${e.type}`+(e.animation!=="none"?` q-skeleton--anim q-skeleton--anim-${e.animation}`:"")+(e.square===!0?" q-skeleton--square":"")+(e.bordered===!0?" q-skeleton--bordered":""));return()=>T(e.tag,{class:l.value,style:n.value},ze(a.default))}});const Va=S({__name:"Apex_TicketsChart",props:["data_value","data_label"],setup(e){const a=e,i=O(()=>a.data_value?a.data_value:[44,55,41,17,15]),r=O(()=>a.data_label?{legend:{labels:{colors:"white"},position:"left"},theme:{palette:"palette3"},labels:a.data_label}:{labels:["Apple","Mango","Orange","Watermelon"]});return(n,l)=>{const s=kt("apexchart");return e.data_value&&e.data_label?(m(),g(s,{key:0,height:"200px",type:"donut",options:r.value,series:i.value},null,8,["options","series"])):w("",!0)}}}),Oa=S({__name:"TicketsTable",props:["entrants"],setup(e){const a=e,i=y({rowsPerPage:0});y();const r=y([{name:"wallet",required:!0,label:"Wallet",align:"left",field:u=>ue(u.address),sortable:!0},{name:"amount",align:"right",label:"Amount",field:"amount",sortable:!0}]),n=y(),l=y(),s=y(!0);ae(async()=>{await o()}),le(()=>a.entrants,async()=>{await o()});async function o(){var v,p;n.value=(v=a.entrants)==null?void 0:v.map(d=>d.amount);const u=(p=a.entrants)==null?void 0:p.flatMap(d=>ue(d.address));l.value=u,s.value=!1}return(u,v)=>(m(),j(Ie,null,[t(pe,{square:"",dense:"",class:"col",title:"Tickets",rows:e.entrants,columns:r.value,"row-key":"mint","hide-bottom":"",flat:"",pagination:i.value,"onUpdate:pagination":v[0]||(v[0]=p=>i.value=p),"rows-per-page-options":[0]},null,8,["rows","columns","pagination"]),s.value?(m(),g(Qa,{key:0,type:"QInput"})):w("",!0),t(Va,{data_value:n.value,data_label:l.value},null,8,["data_value","data_label"])],64))}}),Ma={};function za(e,a){return m(),g(ht,{size:"xs"},{default:c(()=>[t(je,{src:"solscan.png"})]),_:1})}var Qe=Ht(Ma,[["render",za]]);const Ia=k("div",{class:"col q-gutter-y-sm"},[k("div",null,"Raffle account"),k("div",null,"Entrants account"),k("div",null,"Use Whitelist?")],-1),Ba={class:"col q-gutter-y-sm"},ja=S({__name:"RaffleLinks",props:["raffle","entrants"],setup(e){const a=e;return y({rowsPerPage:0}),(i,r)=>(m(),g(te,{flat:"",square:"",class:"row items-center q-pa-md"},{default:c(()=>[Ia,k("div",Ba,[t(Q,{class:"full-width",size:"xs",square:"",color:"primary",href:"https://solscan.io/account/"+a.raffle.publicKey,target:"_blank"},{default:c(()=>[t(Qe)]),_:1},8,["href"]),t(Q,{class:"full-width",square:"",size:"xs",color:"primary",href:"https://solscan.io/account/"+a.raffle.account.entrants,target:"_blank"},{default:c(()=>[t(Qe)]),_:1},8,["href"]),e.raffle.account.useWhitelist?(m(),g(J,{key:0,name:"check"})):(m(),g(J,{key:1,name:"clear"}))])]),_:1}))}}),Ea=S({__name:"RaffleToggleMode",props:["raffle"],setup(e){const a=e;async function i(){var r;try{const n=new K,l=(r=q())==null?void 0:r.pg_raffle.value;let s=await(l==null?void 0:l.account.raffle.fetch(a.raffle.publicKey));console.log(s),console.log(Object.keys(s.state)[0]);let o;switch(Object.keys(s.state)[0]){case"ready":n.add(await(l==null?void 0:l.methods.enable().accountsPartial({creator:$(),raffle:a.raffle.publicKey}).instruction())),await M(n,"[Raffle] enable");break;case"paused":n.add(await(l==null?void 0:l.methods.enable().accountsPartial({creator:$(),raffle:a.raffle.publicKey}).instruction())),await M(n,"[Raffle] enable");break;case"running":n.add(await(l==null?void 0:l.methods.disable().accountsPartial({creator:$(),raffle:a.raffle.publicKey}).instruction())),await M(n,"[Raffle] disable");break}await P().updateStore()}catch(n){E.create({color:"red",message:`${n}`,timeout:5e3})}}return(r,n)=>(m(),g(Q,{icon:"send",label:"Start/Pause",square:"",color:"primary",onClick:n[0]||(n[0]=l=>i())}))}}),Ua=S({__name:"RaffleEdit",props:["raffle"],setup(e){const a=y(""),i=y(""),r=y(""),n=e;ae(()=>{a.value=n.raffle.account.name,i.value=n.raffle.account.description,r.value=n.raffle.account.url});async function l(){var u;const s=new K,o=(u=q())==null?void 0:u.pg_raffle.value;try{s.add(await(o==null?void 0:o.methods.edit(a.value,i.value,r.value).accountsPartial({creator:$(),raffle:n.raffle.publicKey}).instruction())),await M(s,"[Raffle] update"),await P().updateStore()}catch(v){E.create({color:"danger",message:`${v}`,timeout:5e3})}}return(s,o)=>(m(),j("div",null,[t(L,{square:"",filled:"",label:"Name",modelValue:a.value,"onUpdate:modelValue":o[0]||(o[0]=u=>a.value=u)},null,8,["modelValue"]),t(L,{square:"",filled:"",label:"Description",modelValue:i.value,"onUpdate:modelValue":o[1]||(o[1]=u=>i.value=u)},null,8,["modelValue"]),t(L,{square:"",filled:"",label:"Image-URL",modelValue:r.value,"onUpdate:modelValue":o[2]||(o[2]=u=>r.value=u)},null,8,["modelValue"]),t(Q,{square:"",class:"full-width",color:"primary",label:"Update",onClick:o[3]||(o[3]=u=>l())})]))}});async function Ve(e){try{await navigator.clipboard.writeText(e),E.create({message:`Clipboard: ${e}`,position:"bottom-right",type:"info"})}catch{alert("Cannot copy")}}const Da={class:"text-h5 q-mt-sm q-mb-xs"},Na={class:"text-caption text-grey"},La=k("p",{class:"text-overline"},"Actions",-1),Ka={class:"col row justify-end q-mx-sm"},Wa=S({__name:"RaffleCard",props:["raffle","is_admin"],setup(e){const a=e,i=y(),r=y(),n=y();async function l(){const{pg_raffle:p}=q();i.value=await p.value.account.tickets.fetch(a.raffle.account.tickets),console.log(i.value)}async function s(){r.value=await W().connection.getParsedTokenAccountsByOwner(a.raffle.publicKey,{programId:me})}async function o(){const{pg_raffle:p}=q(),d=await p.value.account.tickets.getAccountInfo(a.raffle.account.tickets);let f=[];for(let b=0;b<i.value.total;b++){let z=u(d.data,b);f.push(z)}const V=f.map(b=>b.toString()).reduce((b,z)=>({...b,[z]:(b[z]||0)+1}),{});n.value=Object.entries(V).flatMap(b=>({address:b[0],amount:b[1]}))}function u(p,d){const f=16+32*d,h=f+32,V=p.slice(f,h);return new x(V)}ae(async()=>{await l(),await s,await bt(o)});const v=O(()=>a.raffle.account.url.length>0?a.raffle.account.url.toString():"unknown.svg");return(p,d)=>(m(),g(te,{square:"",flat:""},{default:c(()=>[t(je,{height:"200px",src:v.value},null,8,["src"]),t(R,null,{default:c(()=>[t(va,{raffle:e.raffle,tickets:i.value},null,8,["raffle","tickets"]),k("div",Da,D(e.raffle.account.name),1),k("div",Na,D(e.raffle.account.description),1)]),_:1}),t(B),t(R,null,{default:c(()=>[t(Bt,null,{default:c(()=>[t(Z,{clickable:""},{default:c(()=>[t(N,{avatar:""},{default:c(()=>[t(J,{color:"primary",name:"functions"})]),_:1}),t(N,null,{default:c(()=>[t(I,{class:"text-h6"},{default:c(()=>{var f;return[A(D((f=i.value)==null?void 0:f.total)+" Tickets",1)]}),_:1}),t(I,{class:"text-accent",caption:""},{default:c(()=>[A("Total tickets")]),_:1})]),_:1})]),_:1}),t(Z,{clickable:""},{default:c(()=>[t(N,{avatar:""},{default:c(()=>[t(J,{color:"red",name:"paid"})]),_:1}),t(N,null,{default:c(()=>[t(I,{class:"text-h6"},{default:c(()=>{var f;return[A(D((e.raffle.account.ticketPrice.toNumber()*Math.pow(10,-e.raffle.account.ticketDecimals)).toFixed(2))+" "+D((f=_(ce)().tokenList.find(h=>h.address==e.raffle.account.ticketMint.toString()))==null?void 0:f.symbol),1)]}),_:1}),t(I,{class:"text-accent",caption:""},{default:c(()=>[A("Price per ticket")]),_:1})]),_:1})]),_:1}),t(Z,{clickable:""},{default:c(()=>[t(N,{avatar:""},{default:c(()=>[t(J,{color:"amber",name:"local_movies"})]),_:1}),t(N,{class:"q-gutter-y-md"},{default:c(()=>[k("div",{onClick:d[0]||(d[0]=f=>_(Ve)(e.raffle.account.prizeMint.toString()))},[t(I,{class:"q-pt-md text-overline"},{default:c(()=>{var f;return[A(D(((f=_(ce)().tokenList.find(h=>h.address==e.raffle.account.prizeMint.toString()))==null?void 0:f.name)??e.raffle.account.ticketMint.toString()),1)]}),_:1}),t(I,{class:"text-accent",caption:""},{default:c(()=>[A("Prize-Mint")]),_:1})]),k("div",{onClick:d[1]||(d[1]=f=>_(Ve)(e.raffle.account.ticketMint.toString()))},[t(I,{class:"text-overline"},{default:c(()=>{var f;return[A(D(((f=_(ce)().tokenList.find(h=>h.address==e.raffle.account.ticketMint.toString()))==null?void 0:f.name)??e.raffle.account.ticketMint.toString()),1)]}),_:1}),t(I,{class:"text-accent",caption:""},{default:c(()=>[A("Ticket-Mint")]),_:1})])]),_:1})]),_:1}),e.raffle.account.randomness!=null?(m(),g(Z,{key:0,clickable:""},{default:c(()=>[t(N,{avatar:""},{default:c(()=>{var f,h;return[t(Ca,{style:{width:"100px"},seed:(h=(f=e.raffle.account)==null?void 0:f.winner)==null?void 0:h.toString()},null,8,["seed"])]}),_:1}),t(N,null,{default:c(()=>[t(I,{class:"text-h6",l:""},{default:c(()=>[A("Winner")]),_:1}),t(I,{class:"text-orange-9",caption:""},{default:c(()=>{var f;return[A(D(_(ue)((f=e.raffle.account.winner)==null?void 0:f.toString())),1)]}),_:1})]),_:1})]),_:1})):w("",!0)]),_:1})]),_:1}),t(B),e.is_admin?(m(),g(Se,{key:0,icon:"info",label:"Edit"},{default:c(()=>[t(Ua,{raffle:e.raffle},null,8,["raffle"])]),_:1})):w("",!0),e.is_admin?(m(),g(B,{key:1})):w("",!0),e.is_admin?w("",!0):(m(),g(Se,{key:2,icon:"info",label:"Details"},{default:c(()=>[t(te,{flat:""},{default:c(()=>[t(B),t(R,null,{default:c(()=>[t(xa,{accounts:r.value},null,8,["accounts"])]),_:1}),t(B),t(R,null,{default:c(()=>[t(Oa,{entrants:n.value},null,8,["entrants"])]),_:1}),t(B),t(R,null,{default:c(()=>[t(ja,{raffle:e.raffle,entrants:n.value,class:"q-pb-md"},null,8,["raffle","entrants"])]),_:1})]),_:1})]),_:1})),t(B),e.is_admin?(m(),g(R,{key:3},{default:c(()=>[Object.keys(e.raffle.account.state)[0]=="created"?(m(),g(ea,{key:0,raffle:e.raffle},null,8,["raffle"])):w("",!0)]),_:1})):w("",!0),Object.keys(e.raffle.account.state)[0]=="running"&&!e.is_admin?(m(),g(Ee,{key:4},{default:c(()=>[t(ca,{raffle:e.raffle,tickets:i.value},null,8,["raffle","tickets"])]),_:1})):w("",!0),e.is_admin?(m(),g(R,{key:5,class:"col"},{default:c(()=>[La,k("div",Ka,[Object.keys(e.raffle.account.state)[0]=="full"?(m(),g(ma,{key:0,raffle:e.raffle},null,8,["raffle"])):w("",!0),Object.keys(e.raffle.account.state)[0]=="claimprize"||Object.keys(e.raffle.account.state)[0]=="ready"?(m(),g(ha,{key:1,raffle:e.raffle},null,8,["raffle"])):w("",!0),Object.keys(e.raffle.account.state)[0]=="claimtickets"?(m(),g(_a,{key:2,raffle:e.raffle},null,8,["raffle"])):w("",!0),Object.keys(e.raffle.account.state)[0]=="ready"||Object.keys(e.raffle.account.state)[0]=="running"||Object.keys(e.raffle.account.state)[0]=="paused"?(m(),g(Ea,{key:3,raffle:e.raffle},null,8,["raffle"])):w("",!0),Object.keys(e.raffle.account.state)[0]=="created"||Object.keys(e.raffle.account.state)[0]=="done"?(m(),g(wa,{key:4,raffle:e.raffle},null,8,["raffle"])):w("",!0)])]),_:1})):w("",!0)]),_:1}))}}),Ha={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},Oe=S({__name:"RaffleGrid",props:{is_admin:{type:Boolean,default:!1},raffles:{type:[],default:[]},count:{type:Number,default:0}},setup(e){const a=e,i=O(()=>[0]),r=y({rowsPerPage:0});return(n,l)=>(m(),g(pe,{grid:"",rows:a.raffles,"row-key":"name","hide-header":"",pagination:r.value,"onUpdate:pagination":l[0]||(l[0]=s=>r.value=s),"rows-per-page-options":i.value},{item:c(s=>[k("div",Ha,[t(Wa,{is_admin:e.is_admin,raffle:s.row},null,8,["is_admin","raffle"])])]),_:1},8,["rows","pagination","rows-per-page-options"]))}}),Fa=k("p",{class:"text-h5"},"Raffle",-1),Ga=k("p",{class:"text-h5"},"Tickets",-1),Ya={class:""},Xa=k("p",{class:"text-h5"},"Whitelist",-1),Za={class:"col q-gutter-y-sm"},Ja=S({__name:"RaffleCreateRaffle",setup(e){const a=y(),i=y(),r=y(),n=y(),l=y();async function s(){var v,p;try{const d=new K,f=(v=q())==null?void 0:v.pg_raffle.value,h=new de(window.crypto.getRandomValues(new Uint8Array(8))),V=ya(a.value,h),b=Be(),z=await W().connection.getParsedAccountInfo(new x(l.value.mint));d.add(await(f==null?void 0:f.methods.initialize(a.value,i.value,St(n.value,(p=z.value)==null?void 0:p.data.parsed.info.decimals),r.value,h).accountsPartial({creator:$(),raffle:V,ticketsMint:new x(l.value.mint),whitelist:ne().whitelistSelected.publicKey}).instruction())),await M(d,"[Raffle] Create"),await P().updateStore()}catch(d){E.create({color:"red",message:`${d}`,timeout:5e3})}}const o=y([]);return y(wt().accounts.filter(v=>v.account.data.parsed.info.tokenAmount.uiAmount>0).flatMap(v=>v.account.data.parsed.info.mint)).value.forEach(v=>{var d,f;const p=((d=F().token_list.find(h=>h.address==v))==null?void 0:d.name)??v+" ["+((f=F().token_list.find(h=>h.address==v))==null?void 0:f.symbol)??"]";o.value.push({label:p,value:v})}),(v,p)=>(m(),g(te,{square:"",flat:"",class:"col q-pa-sm",style:{"max-width":"800px"}},{default:c(()=>[t(R,{class:"q-gutter-y-md"},{default:c(()=>[Fa,t(L,{filled:"",square:"",modelValue:a.value,"onUpdate:modelValue":p[0]||(p[0]=d=>a.value=d),type:"text",label:"Name"},null,8,["modelValue"]),t(L,{filled:"",square:"",modelValue:i.value,"onUpdate:modelValue":p[1]||(p[1]=d=>i.value=d),type:"text",label:"Description"},null,8,["modelValue"])]),_:1}),t(B),t(R,{class:"q-gutter-y-md"},{default:c(()=>[Ga,k("div",Ya,[t(Ue,{label:"","textbox-label":"Token",onToken_account_selected:p[2]||(p[2]=d=>l.value=d)})]),t(L,{filled:"",square:"",modelValue:r.value,"onUpdate:modelValue":p[3]||(p[3]=d=>r.value=d),type:"number",label:"Tickets Count"},null,8,["modelValue"]),t(L,{filled:"",square:"",type:"number",modelValue:n.value,"onUpdate:modelValue":p[4]||(p[4]=d=>n.value=d),label:"Ticket Price"},null,8,["modelValue"])]),_:1}),t(B),t(R,{class:"q-gutter-y-md"},{default:c(()=>[Xa,k("div",Za,[t(Kt,{class:"full-width",filled:"",square:"",modelValue:_(ne)().whitelistSelected,"onUpdate:modelValue":p[5]||(p[5]=d=>_(ne)().whitelistSelected=d),clearable:"","use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",behavior:"menu","option-label":d=>{var f;return(f=d.account)==null?void 0:f.name},label:"Whitelist selcted",options:_(ne)().whitelists,style:{width:"250px"}},{"no-option":c(()=>[t(Z,null,{default:c(()=>[t(N,{class:"text-grey"},{default:c(()=>[A(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","option-label","options"])])]),_:1}),t(B),t(R,{class:"row justify-end"},{default:c(()=>[t(Q,{icon:"send",square:"",class:"row",color:"primary",onClick:p[6]||(p[6]=d=>s()),label:"Create"})]),_:1})]),_:1}))}}),en={class:"row shadow-2"},tn={class:""},an={key:0,class:"row"},nn={key:2,class:"row justify-center"},jn=S({__name:"RafflePage",setup(e){const a=y("raffle");return ae(async()=>{await P().updateStore()}),(i,r)=>(m(),g(_t,{class:"col bg-black"},{default:c(()=>[k("div",en,[t(ot,{modelValue:a.value,"onUpdate:modelValue":r[0]||(r[0]=n=>a.value=n),"no-caps":"","outside-arrows":"","mobile-arrows":"",class:"col bg-dark"},{default:c(()=>[t(ie,{name:"raffle",label:"Raffle"}),_(F)().is_admin?(m(),g(ie,{key:0,name:"create",label:"Create"})):w("",!0),_(F)().is_admin?(m(),g(ie,{key:1,name:"manage",label:"Manage"})):w("",!0)]),_:1},8,["modelValue"]),t(Q,{flat:"",class:"bg-dark",icon:"refresh",onClick:r[1]||(r[1]=n=>_(P)().updateStore())})]),k("div",tn,[a.value==="raffle"&&_(P)().raffles.length==0?(m(),j("div",an,[t(ee),t(Gt,{class:"row",color:"primary",size:"10rem"}),t(ee)])):w("",!0),a.value==="raffle"&&_(P)().raffles.length>0?(m(),g(Oe,{key:1,raffles:_(P)().getRunningRaffles,is_admin:!1},null,8,["raffles"])):w("",!0),a.value==="create"?(m(),j("div",nn,[t(Ja,{class:"q-mt-xl"})])):w("",!0),a.value==="manage"?(m(),g(Oe,{key:3,raffles:_(P)().raffles,is_admin:_(F)().is_admin},null,8,["raffles","is_admin"])):w("",!0)])]),_:1}))}});export{jn as default};
