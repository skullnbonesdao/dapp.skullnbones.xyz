import{a as ue,Q as rt}from"./QTabs.2d54f4b2.js";import{cM as it,dj as O,au as S,J as g,cp as V,b1 as v,ak as D,al as k,as as t,bx as r,ar as T,ck as Q,d9 as N,P as b,cn as U,d0 as ve,dc as W,bZ as Me,ah as z,bs as te,aT as xe,cb as Se,c6 as Te,aF as me,bC as ct,aC as ze,cg as Be,cc as ut,dp as ft,df as F,a1 as I,V as A,dq as Ae,aX as ne,bz as dt,a6 as je,dr as mt,ai as _,ds as pt,d6 as vt,dg as ge,b9 as gt,aj as x,dt as yt,cm as ee,da as fe}from"./index.83a77d2b.js";import{Q as le}from"./QSpace.b1c7f2b7.js";import{u as se,Q as kt}from"./globalWallet.253a07e9.js";import{Q as _t}from"./QPage.a6a97328.js";import{Q as ht,a as ye,f as De}from"./format_address.ffec8bff.js";import{Q as Le}from"./QImg.de19af81.js";import{Q as J,a as C}from"./QInput.a46bd7b9.js";import{Q as L}from"./QSeparator.d6f41f82.js";import{j as K,k as E,B as wt,u as bt,n as xt,C as $e,D as St,e as Tt,o as At,f as $t,p as Pt,E as qt,F as Rt,h as Ct,q as Ot,G as Pe,H as Qt,c as qe,g as Vt,I as Re,J as It,l as M}from"./rtl.d60794d2.js";import{Q as Et}from"./QList.0405a8dd.js";import{Q as ae,u as Mt,a as zt}from"./QCard.b2c77731.js";import{Q as Bt,c as jt}from"./calcAmountToTransfer.c4b553ca.js";import{Q as Ue}from"./QCardActions.39a4610d.js";import{Q as pe,c as Dt}from"./QSelect.76388295.js";import{g as $,h as B}from"./handleTransaction.0f8c4820.js";import"./SquadsStore.88bace6d.js";import{C as Lt}from"./ClosePopup.0fdb8bc3.js";import{Q as Ce}from"./QBadge.7b301d08.js";import{t as Ne}from"./token.b11d8f01.js";import{g as We}from"./extensionType.565ab7c5.js";import{c as He}from"./associatedTokenAccount.318c78cb.js";import{_ as Ut}from"./plugin-vue_export-helper.21dcd24c.js";import{u as Oe}from"./globalWhitelist.b5828b58.js";import"./assert.8d022599.js";import"./index.01382230.js";import"./QSlideTransition.8bca4d8f.js";import"./use-checkbox.9f2a4048.js";import"./pda.5a114900.js";import"./cusper.d3aba938.js";import"./vaultTransactionCreate.9c621d93.js";import"./errors.0f021fd2.js";const q=it("raffleStore",{state:()=>({raffles:[]}),getters:{getRunningRaffles(e){return e.raffles.filter(a=>Object.keys(a.account.state)[0]=="running"||Object.keys(a.account.state)[0]=="full"||Object.keys(a.account.state)[0]=="claimprize")}},actions:{async updateStore(){if(O())try{const e=O().pg_raffle.value;this.raffles=await(e==null?void 0:e.account.raffle.all()),console.log("[Updated] RaffleStore")}catch(e){console.error(e)}}}}),Nt={class:"col q-pa-sm"},Wt=k("p",{class:"text-overline"},"Add a prize:",-1),Ht={class:"col q-gutter-y-sm"},Kt={class:"row"},Ft=S({__name:"RafflePrepare",props:["raffle"],setup(e){const a=g(1),i=g(""),o=g(""),n=e,l=g([]);g(se().token_accounts.filter(f=>f.account.data.parsed.info.tokenAmount.uiAmount>0).flatMap(f=>f.account.data.parsed.info.mint)).value.forEach(f=>{var p,d;return l.value.push({label:V().token_list.find(h=>h.address==f)?((p=V().token_list.find(h=>h.address==f))==null?void 0:p.name)+" ["+((d=V().token_list.find(h=>h.address==f))==null?void 0:d.symbol)+"]":f,value:f})});async function u(){var f,p,d,h;try{const c=new N,m=(f=O())==null?void 0:f.pg_raffle.value,y=new b(o.value.value),w=(await U().connection.getParsedTokenAccountsByOwner($(),{mint:y})).value[0].pubkey,P=new b(n.raffle.publicKey.toString()),G=await U().connection.getParsedAccountInfo(y);console.log((p=G.value)==null?void 0:p.data.parsed.info.decimals),i.value=((d=V().token_list.find(Y=>Y.address==y))==null?void 0:d.logoURI)??"",c.add(await(m==null?void 0:m.methods.prepare(new ve(a.value*Math.pow(10,(h=G.value)==null?void 0:h.data.parsed.info.decimals)),i.value).accountsPartial({creator:$(),raffle:P,from:w,prizeMint:y}).instruction())),await B(c,"[Raffle] prepare"),await q().updateStore()}catch(c){W.create({color:"red",message:`${c}`,timeout:5e3})}}return(f,p)=>(v(),D("div",Nt,[Wt,k("div",Ht,[t(pe,{class:"full-width",filled:"",square:"",modelValue:o.value,"onUpdate:modelValue":p[0]||(p[0]=d=>o.value=d),clearable:"","use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",behavior:"menu",label:"Select Ticket by mint",options:l.value,style:{width:"250px"}},{"no-option":r(()=>[t(K,null,{default:r(()=>[t(E,{class:"text-grey"},{default:r(()=>[T(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"]),k("div",Kt,[t(J,{class:"col",filled:"",square:"",modelValue:a.value,"onUpdate:modelValue":p[1]||(p[1]=d=>a.value=d),type:"number",label:"Count"},null,8,["modelValue"]),t(Q,{filled:"",square:"",class:"col-2",color:"primary",icon:"send",onClick:p[2]||(p[2]=d=>u())})])])]))}});var Gt=Me({name:"QTooltip",inheritAttrs:!1,props:{...wt,...bt,...xt,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{default:"jump-down"},transitionHide:{default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:$e},self:{type:String,default:"top middle",validator:$e},offset:{type:Array,default:()=>[14,14],validator:St},scrollTarget:{default:void 0},delay:{type:Number,default:0},hideDelay:{type:Number,default:0}},emits:[...Tt],setup(e,{slots:a,emit:i,attrs:o}){let n,l;const s=ze(),{proxy:{$q:u}}=s,f=g(null),p=g(!1),d=z(()=>Re(e.anchor,u.lang.rtl)),h=z(()=>Re(e.self,u.lang.rtl)),c=z(()=>e.persistent!==!0),{registerTick:m,removeTick:y}=At(),{registerTimeout:w}=$t(),{transitionProps:P,transitionStyle:G}=Pt(e),{localScrollTarget:Y,changeScrollEvent:re,unconfigureScrollTarget:Ye}=qt(e,we),{anchorEl:j,canShow:Je,anchorEvents:Z}=Rt({showing:p,configureAnchorEl:lt}),{show:Ze,hide:ie}=Ct({showing:p,canShow:Je,handleShow:et,handleHide:tt,hideOnRouteChange:c,processOnMount:!0});Object.assign(Z,{delayShow:at,delayHide:nt});const{showPortal:ke,hidePortal:_e,renderPortal:Xe}=Ot(s,f,ot,"tooltip");if(u.platform.is.mobile===!0){const R={anchorEl:j,innerRef:f,onClickOutside(H){return ie(H),H.target.classList.contains("q-dialog__backdrop")&&ut(H),!0}},ce=z(()=>e.modelValue===null&&e.persistent!==!0&&p.value===!0);te(ce,H=>{(H===!0?It:Pe)(R)}),xe(()=>{Pe(R)})}function et(R){ke(),m(()=>{l=new MutationObserver(()=>X()),l.observe(f.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),X(),we()}),n===void 0&&(n=te(()=>u.screen.width+"|"+u.screen.height+"|"+e.self+"|"+e.anchor+"|"+u.lang.rtl,X)),w(()=>{ke(!0),i("show",R)},e.transitionDuration)}function tt(R){y(),_e(),he(),w(()=>{_e(!0),i("hide",R)},e.transitionDuration)}function he(){l!==void 0&&(l.disconnect(),l=void 0),n!==void 0&&(n(),n=void 0),Ye(),Se(Z,"tooltipTemp")}function X(){Qt({targetEl:f.value,offset:e.offset,anchorEl:j.value,anchorOrigin:d.value,selfOrigin:h.value,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function at(R){if(u.platform.is.mobile===!0){qe(),document.body.classList.add("non-selectable");const ce=j.value,H=["touchmove","touchcancel","touchend","click"].map(be=>[ce,be,"delayHide","passiveCapture"]);Te(Z,"tooltipTemp",H)}w(()=>{Ze(R)},e.delay)}function nt(R){u.platform.is.mobile===!0&&(Se(Z,"tooltipTemp"),qe(),setTimeout(()=>{document.body.classList.remove("non-selectable")},10)),w(()=>{ie(R)},e.hideDelay)}function lt(){if(e.noParentEvent===!0||j.value===null)return;const R=u.platform.is.mobile===!0?[[j.value,"touchstart","delayShow","passive"]]:[[j.value,"mouseenter","delayShow","passive"],[j.value,"mouseleave","delayHide","passive"]];Te(Z,"anchor",R)}function we(){if(j.value!==null||e.scrollTarget!==void 0){Y.value=Vt(j.value,e.scrollTarget);const R=e.noParentEvent===!0?X:ie;re(Y.value,R)}}function st(){return p.value===!0?me("div",{...o,ref:f,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",o.class],style:[o.style,G.value],role:"tooltip"},Be(a.default)):null}function ot(){return me(ct,P.value,st)}return xe(he),Object.assign(s.proxy,{updatePosition:X}),Xe}});const Yt=new b(ft.address),Jt=new b("adm1rpWxyo8u9y2Q2wxxfqaVDLE2gD1N9PbZbbhokTP"),Zt="Crew";function Ke(){return b.findProgramAddressSync([Jt.toBuffer(),F(Zt)],Yt)[0]}const Xt={class:"col q-pa-sm q-gutter-y-sm"},ea=k("p",{class:"text-overline"},"Buy Ticket(s)",-1),ta={class:"row"},aa={class:"row"},na={class:"col row q-gutter-x-xs text-weight-light"},la=k("p",null,"Available:",-1),sa={class:"text-caption text-right text-weight-thin"},oa=S({__name:"RaffleBuyTicket",props:["raffle","tickets"],setup(e){const a=g(),i=e;async function o(){var h,c,m;const n=new N;await se().update_accounts();const l=(h=O())==null?void 0:h.pg_raffle.value,s=(c=O())==null?void 0:c.pg_whitelist.value,u=new b(i.raffle.account.ticketMint.toString()),f=(await U().connection.getParsedTokenAccountsByOwner($(),{mint:u})).value[0].pubkey,p=new b(i.raffle.publicKey.toString());let d=Ke();try{n.add(await(l==null?void 0:l.methods.buyTickets(new ve(a.value)).accountsPartial({signer:$(),raffle:p,entrant:$(),ticketsMint:u,from:f,whitelist:d,whitelistEntry:b.findProgramAddressSync([(m=$())==null?void 0:m.toBytes(),d.toBytes()],s==null?void 0:s.programId)[0],whitelistProgram:s==null?void 0:s.programId}).instruction())),await B(n,"[Raffle] buy ticket"),await q().updateStore()}catch(y){W.create({color:"danger",message:`${y}`,timeout:5e3})}}return(n,l)=>{var s,u,f,p;return v(),D("div",Xt,[ea,k("div",ta,[t(J,{square:"",filled:"",outlined:"",type:"number",class:"col",label:"Amount",modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=d=>a.value=d)},null,8,["modelValue"]),t(Q,{square:"",disable:!a.value,color:"primary",icon:"send",onClick:l[1]||(l[1]=d=>o())},null,8,["disable"])]),k("div",aa,[k("div",na,[la,k("p",null,I((u=(s=A(Ae)().accounts)==null?void 0:s.find(d=>d.mint==e.raffle.account.ticketMint.toString()))==null?void 0:u.uiAmount),1),k("p",null,I((p=(f=A(Ae)().accounts)==null?void 0:f.find(d=>d.mint==e.raffle.account.ticketMint.toString()))==null?void 0:p.info.symbol),1)]),k("p",sa,[T(" 0.001\u25CE fee "),t(Gt,{anchor:"bottom right",self:"top middle"},{default:r(()=>[T(" cover deployment costs ")]),_:1})])])])}}}),ra=k("source",{src:"Burningticket.mp4",type:"video/mp4"},null,-1),ia=S({__name:"BurningTicket",setup(e){const a=g();return ne(()=>{a.value.playbackRate=.3,console.log(a.value)}),(i,o)=>(v(),D("video",{ref_key:"ticket_burning",ref:a,autoplay:"",playbackspeed:"0.1"},[ra,T(" Your browser does not support the video tag. ")],512))}}),ca=k("div",{class:"text-h6 text-center"},"Drawing...",-1),ua=S({__name:"RaffleRevealWinner",props:["raffle","is_admin"],setup(e){g();const a=e,i=g(!1);te(()=>i.value,()=>{i.value==!1&&q().updateStore()});async function o(){var n;try{const l=new N,s=(n=O())==null?void 0:n.pg_raffle.value,u=new b(a.raffle.publicKey.toString());let[f,p]=b.findProgramAddressSync([F("tickets"),u.toBytes()],s==null?void 0:s.programId);l.add(await(s==null?void 0:s.methods.revealWinners().accounts({raffle:u,tickets:f,recentBlockHashes:mt}).instruction())),await B(l,"[Raffle] reveal winner"),i.value=!0}catch(l){W.create({color:"red",message:`${l}`,timeout:5e3})}}return(n,l)=>(v(),D(je,null,[t(Q,{square:"",class:"row",color:"primary",icon:"send",label:"Reveal Winner",onClick:l[0]||(l[0]=s=>o())}),t(Dt,{maximized:!0,modelValue:i.value,"onUpdate:modelValue":l[2]||(l[2]=s=>i.value=s)},{default:r(()=>[t(ae,{flat:"",square:"",class:""},{default:r(()=>[t(C,null,{default:r(()=>[ca]),_:1}),t(C,{class:"q-pt-none row"},{default:r(()=>[t(le),t(ia),t(le)]),_:1}),t(Ue,{align:"right"},{default:r(()=>[dt(t(Q,{flat:"",label:"close",color:"primary",onClick:l[1]||(l[1]=s=>A(q)().update_raffles())},null,512),[[Lt]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),fa={class:"absolute-full flex flex-center"};var Fe=(e=>(e.created="orange",e.ready="orange",e.paused="pink",e.full="purple",e.claimprize="purple",e.claimtickets="purple",e.running="primary",e))(Fe||{});const da=S({__name:"RaffleStateBadge",props:["raffle","tickets"],setup(e){const a=e,i=z(()=>{var o,n;return((o=a.tickets)==null?void 0:o.sold)/((n=a.tickets)==null?void 0:n.total)});return(o,n)=>Object.keys(e.raffle.account.state)[0]=="running"?(v(),_(ht,{key:0,size:"25px",value:i.value,color:"primary"},{default:r(()=>{var l,s;return[k("div",fa,[t(Ce,{color:"black","text-color":"primary",label:`Tickets: ${(l=e.tickets)==null?void 0:l.sold}/${(s=e.tickets)==null?void 0:s.total}`},null,8,["label"])])]}),_:1},8,["value"])):(v(),_(Ce,{key:1,color:Fe[Object.keys(e.raffle.account.state)[0]],class:"text-h6 justify-center full-width"},{default:r(()=>[T(I(Object.keys(e.raffle.account.state)[0].toUpperCase()),1)]),_:1},8,["color"]))}}),oe=new b(pt.address);function ma(e,a){return b.findProgramAddressSync([F("raffle"),F(e),a.toArrayLike(vt.Buffer).reverse()],oe)[0]}function pa(e){return b.findProgramAddressSync([F("tickets"),e.toBytes()],oe)[0]}function Ge(e){return b.findProgramAddressSync([F("vaultPrize"),e.toBytes()],oe)[0]}function va(e){return b.findProgramAddressSync([F("vaultTickets"),e.toBytes()],oe)[0]}const ga=S({__name:"RaffleClaimPrize",props:["raffle","is_admin"],setup(e){const a=e;async function i(){var o;try{let n=new N;const l=(o=O())==null?void 0:o.pg_raffle.value,s=new b(a.raffle.account.prizeMint.toString()),u=new b(a.raffle.account.winner.toString()),f=await We(s,u,!0,ge,Ne.ASSOCIATED_PROGRAM_ID);await U().connection.getAccountInfo(f)===null&&n.add(He($(),f,u,s));const p=new b(a.raffle.publicKey.toString()),d=Ge(p);n.add(await(l==null?void 0:l.methods.claimPrize().accountsPartial({raffle:p,prizeMint:s,prizeVault:d,to:f}).instruction())),await B(n,"[Raffle] Claim Prize"),await q().updateStore()}catch(n){W.create({color:"red",message:`${n}`,timeout:5e3,position:"bottom-right"})}}return(o,n)=>(v(),_(Q,{color:"primary",icon:"send",label:"Claim Prize",onClick:n[0]||(n[0]=l=>i())}))}});async function ya(e){try{return!!await U().connection.getAccountInfo(e)}catch(a){return console.error("Error checking account:",a),!1}}const ka=S({__name:"RaffleClose",props:["raffle"],setup(e){const a=e;async function i(){var o;try{const n=new N,l=(o=O())==null?void 0:o.pg_raffle.value;let s=a.raffle.publicKey;const u=pa(s),f=va(s);let p=Ge(s);await ya(p)||(p=null),n.add(await(l==null?void 0:l.methods.close().accountsPartial({creator:$(),raffle:s,tickets:u,ticketsVault:f,prizeVault:p}).instruction())),await B(n,"[Raffle] close"),await q().updateStore()}catch(n){W.create({color:"red",message:`${n}`,timeout:5e3})}}return(o,n)=>(v(),_(Q,{square:"",color:"primary",icon:"send",label:"Close Raffle",onClick:n[0]||(n[0]=l=>i())}))}}),_a=S({__name:"RaffleClaimTickets",props:["raffle","is_admin"],setup(e){const a=e;async function i(){var o;try{const n=new N,l=(o=O())==null?void 0:o.pg_raffle.value,s=new b(a.raffle.account.ticketMint.toString()),u=await We(s,$(),!0,ge,Ne.ASSOCIATED_PROGRAM_ID);await U().connection.getAccountInfo(u)===null&&n.add(He($(),u,$(),s)),n.add(await(l==null?void 0:l.methods.claimTickets().accountsPartial({creator:$(),raffle:a.raffle.publicKey,ticketsMint:s,to:u}).instruction())),await B(n,"[Raffle Claim Tickets]"),await q().updateStore()}catch(n){W.create({color:"red",message:`${n}`,timeout:5e3,position:"bottom-right"})}}return(o,n)=>(v(),_(Q,{color:"primary",icon:"send",label:"Claim Tickets",onClick:n[0]||(n[0]=l=>i())}))}}),ha=S({__name:"AccountsTable",props:["accounts"],setup(e){const a=g({rowsPerPage:0}),i=g([{name:"mint",required:!0,label:"Mint",align:"left",field:"mint",field:o=>{var n,l;return((n=V().token_list.find(s=>{var u;return s.address==((u=o.mint)==null?void 0:u.toString())}))==null?void 0:n.name)??((l=o.mint)==null?void 0:l.toString())},sortable:!0},{name:"calories",align:"right",label:"Amount",field:o=>o.tokenAmount.uiAmount,sortable:!0}]);return(o,n)=>{var l,s;return v(),_(ye,{square:"",dense:"",class:"col",title:"Accounts",rows:(s=(l=e.accounts)==null?void 0:l.value)==null?void 0:s.map(u=>u.account.data.parsed.info),columns:i.value,"row-key":"mint","hide-bottom":"",flat:"",pagination:a.value,"onUpdate:pagination":n[0]||(n[0]=u=>a.value=u),"rows-per-page-options":[0]},null,8,["rows","columns","pagination"])}}}),Qe=9,wa=95,ba=45,Ve=5;function xa(e){return e.split("").reduce((a,i)=>(a^i.charCodeAt(0))*-Ve,Ve)>>>2}function Sa(e="",a=wa,i=ba,o=xa){const n=o(e),l=n%Qe*(360/Qe);return[...Array(e?25:0)].reduce((s,u,f)=>n&1<<f%15?s+`<rect x="${f>14?7-~~(f/5):~~(f/5)}" y="${f%5}" width="1" height="1"/>`:s,`<svg viewBox="-1.5 -1.5 8 8" xmlns="http://www.w3.org/2000/svg" fill="hsl(${l} ${a}% ${i}%)">`)+"</svg>"}const Ta=["innerHTML"],Aa=S({__name:"IconFromSeed",props:{seed:{type:String,default:"default"}},setup(e){const i=g(Sa(e.seed));return(o,n)=>(v(),D("div",{innerHTML:i.value},null,8,Ta))}}),$a=["text","rect","circle","QBtn","QBadge","QChip","QToolbar","QCheckbox","QRadio","QToggle","QSlider","QRange","QInput","QAvatar"],Pa=["wave","pulse","pulse-x","pulse-y","fade","blink","none"];var qa=Me({name:"QSkeleton",props:{...Mt,tag:{type:String,default:"div"},type:{type:String,validator:e=>$a.includes(e),default:"rect"},animation:{type:String,validator:e=>Pa.includes(e),default:"wave"},animationSpeed:{type:[String,Number],default:1500},square:Boolean,bordered:Boolean,size:String,width:String,height:String},setup(e,{slots:a}){const i=ze(),o=zt(e,i.proxy.$q),n=z(()=>{const s=e.size!==void 0?[e.size,e.size]:[e.width,e.height];return{"--q-skeleton-speed":`${e.animationSpeed}ms`,width:s[0],height:s[1]}}),l=z(()=>`q-skeleton q-skeleton--${o.value===!0?"dark":"light"} q-skeleton--type-${e.type}`+(e.animation!=="none"?` q-skeleton--anim q-skeleton--anim-${e.animation}`:"")+(e.square===!0?" q-skeleton--square":"")+(e.bordered===!0?" q-skeleton--bordered":""));return()=>me(e.tag,{class:l.value,style:n.value},Be(a.default))}});const Ra=S({__name:"Apex_TicketsChart",props:["data_value","data_label"],setup(e){const a=e,i=z(()=>a.data_value?a.data_value:[44,55,41,17,15]),o=z(()=>a.data_label?{legend:{labels:{colors:"white"},position:"left"},theme:{palette:"palette3"},labels:a.data_label}:{labels:["Apple","Mango","Orange","Watermelon"]});return(n,l)=>{const s=gt("apexchart");return e.data_value&&e.data_label?(v(),_(s,{key:0,height:"200px",type:"donut",options:o.value,series:i.value},null,8,["options","series"])):x("",!0)}}}),Ca=S({__name:"TicketsTable",props:["entrants"],setup(e){const a=e,i=g({rowsPerPage:0});g();const o=g([{name:"wallet",required:!0,label:"Wallet",align:"left",field:f=>De(f.address),sortable:!0},{name:"amount",align:"right",label:"Amount",field:"amount",sortable:!0}]),n=g(),l=g(),s=g(!0);ne(async()=>{await u()}),te(()=>a.entrants,async()=>{await u()});async function u(){var p,d;n.value=(p=a.entrants)==null?void 0:p.map(h=>h.amount);const f=(d=a.entrants)==null?void 0:d.flatMap(h=>new b(h.address));l.value=f,s.value=!1}return(f,p)=>(v(),D(je,null,[t(ye,{square:"",dense:"",class:"col",title:"Tickets",rows:e.entrants,columns:o.value,"row-key":"mint","hide-bottom":"",flat:"",pagination:i.value,"onUpdate:pagination":p[0]||(p[0]=d=>i.value=d),"rows-per-page-options":[0]},null,8,["rows","columns","pagination"]),s.value?(v(),_(qa,{key:0,type:"QInput"})):x("",!0),t(Ra,{data_value:n.value,data_label:l.value},null,8,["data_value","data_label"])],64))}}),Oa={};function Qa(e,a){return v(),_(yt,{size:"xs"},{default:r(()=>[t(Le,{src:"solscan.png"})]),_:1})}var Ie=Ut(Oa,[["render",Qa]]);const Va=k("div",{class:"col q-gutter-y-sm"},[k("div",null,"Raffle account"),k("div",null,"Entrants account"),k("div",null,"Use Whitelist?")],-1),Ia={class:"col q-gutter-y-sm"},Ea=S({__name:"RaffleLinks",props:["raffle","entrants"],setup(e){const a=e;return g({rowsPerPage:0}),(i,o)=>(v(),_(ae,{flat:"",square:"",class:"row items-center q-pa-md"},{default:r(()=>[Va,k("div",Ia,[t(Q,{class:"full-width",size:"xs",square:"",color:"primary",href:"https://solscan.io/account/"+a.raffle.publicKey,target:"_blank"},{default:r(()=>[t(Ie)]),_:1},8,["href"]),t(Q,{class:"full-width",square:"",size:"xs",color:"primary",href:"https://solscan.io/account/"+a.raffle.account.entrants,target:"_blank"},{default:r(()=>[t(Ie)]),_:1},8,["href"]),e.raffle.account.useWhitelist?(v(),_(ee,{key:0,name:"check"})):(v(),_(ee,{key:1,name:"clear"}))])]),_:1}))}}),Ma=S({__name:"RaffleToggleMode",props:["raffle"],setup(e){const a=e;async function i(){var o;try{const n=new N,l=(o=O())==null?void 0:o.pg_raffle.value;let s=await(l==null?void 0:l.account.raffle.fetch(a.raffle.publicKey));console.log(s),console.log(Object.keys(s.state)[0]);let u;switch(Object.keys(s.state)[0]){case"ready":n.add(await(l==null?void 0:l.methods.enable().accountsPartial({creator:$(),raffle:a.raffle.publicKey}).instruction())),await B(n,"[Raffle] enable");break;case"paused":n.add(await(l==null?void 0:l.methods.enable().accountsPartial({creator:$(),raffle:a.raffle.publicKey}).instruction())),await B(n,"[Raffle] enable");break;case"running":n.add(await(l==null?void 0:l.methods.disable().accountsPartial({creator:$(),raffle:a.raffle.publicKey}).instruction())),await B(n,"[Raffle] disable");break}await q().updateStore()}catch(n){W.create({color:"red",message:`${n}`,timeout:5e3})}}return(o,n)=>(v(),_(Q,{icon:"send",label:"Start/Pause",square:"",color:"primary",onClick:n[0]||(n[0]=l=>i())}))}});async function de(e,a=3,i=1e3){let o=0;for(;o<a;)try{return await e()}catch(n){if(o++,o>=a)throw new Error(`Function ${e.name} failed after ${o} attempts: ${n}`);console.log(`Retry ${e.name}() | ${o}/${a} failed. Retrying in ${i}ms...`),await new Promise(l=>setTimeout(l,i))}throw new Error("This line should never be reached.")}const za={class:"text-h5 q-mt-sm q-mb-xs"},Ba={class:"text-caption text-grey"},ja=k("p",{class:"text-overline"},"Actions",-1),Da={class:"col row justify-end q-mx-sm"},La=S({__name:"RaffleCard",props:["raffle","is_admin"],setup(e){const a=e,i=g(),o=g(),n=g();async function l(){const{pg_raffle:d}=O();i.value=await d.value.account.tickets.fetch(a.raffle.account.tickets),console.log(i.value)}async function s(){o.value=await U().connection.getParsedTokenAccountsByOwner(a.raffle.publicKey,{programId:ge})}async function u(){const{pg_raffle:d}=O(),h=await d.value.account.tickets.getAccountInfo(a.raffle.account.tickets);let c=[];for(let w=0;w<i.value.total;w++){let P=f(h.data,w);c.push(P)}const y=c.map(w=>w.toString()).reduce((w,P)=>({...w,[P]:(w[P]||0)+1}),{});n.value=Object.entries(y).flatMap(w=>({address:w[0],amount:w[1]}))}function f(d,h){const c=16+32*h,m=c+32,y=d.slice(c,m);return new b(y)}ne(async()=>{await de(l),await de(s),await de(u)});function p(){var d;return a.raffle.account.url?a.raffle.account.url:(console.log(V().token_list.find(h=>h.address===a.raffle.account.prizeMint.toString())),((d=V().token_list.find(h=>h.address===a.raffle.account.prizeMint.toString()))==null?void 0:d.logoURI)??"snb_icon.svg")}return(d,h)=>(v(),_(ae,{square:"",flat:""},{default:r(()=>[t(Le,{height:"200px",src:p()},null,8,["src"]),t(C,null,{default:r(()=>[t(da,{raffle:e.raffle,tickets:i.value},null,8,["raffle","tickets"]),k("div",za,I(e.raffle.account.name),1),k("div",Ba,I(e.raffle.account.description),1)]),_:1}),t(L),t(C,null,{default:r(()=>[t(Et,null,{default:r(()=>[t(K,{clickable:""},{default:r(()=>[t(E,{avatar:""},{default:r(()=>[t(ee,{color:"primary",name:"functions"})]),_:1}),t(E,null,{default:r(()=>[t(M,{class:"text-h6"},{default:r(()=>{var c;return[T(I((c=i.value)==null?void 0:c.total)+" Tickets",1)]}),_:1}),t(M,{class:"text-accent",caption:""},{default:r(()=>[T("Total tickets")]),_:1})]),_:1})]),_:1}),t(K,{clickable:""},{default:r(()=>[t(E,{avatar:""},{default:r(()=>[t(ee,{color:"red",name:"paid"})]),_:1}),t(E,null,{default:r(()=>[t(M,{class:"text-h6"},{default:r(()=>{var c;return[T(I((e.raffle.account.ticketPrice.toNumber()*Math.pow(10,-e.raffle.account.ticketDecimals)).toFixed(2))+" "+I((c=A(fe)().tokenList.find(m=>m.address==e.raffle.account.ticketMint.toString()))==null?void 0:c.symbol),1)]}),_:1}),t(M,{class:"text-accent",caption:""},{default:r(()=>[T("Price per ticket")]),_:1})]),_:1})]),_:1}),t(K,{clickable:""},{default:r(()=>[t(E,{avatar:""},{default:r(()=>[t(ee,{color:"amber",name:"local_movies"})]),_:1}),t(E,{class:"q-gutter-y-md"},{default:r(()=>[k("div",null,[t(M,{class:"q-pt-md text-overline"},{default:r(()=>{var c;return[T(I(((c=A(fe)().tokenList.find(m=>m.address==e.raffle.account.prizeMint.toString()))==null?void 0:c.name)??e.raffle.account.ticketMint.toString()),1)]}),_:1}),t(M,{class:"text-accent",caption:""},{default:r(()=>[T("Prize-Mint")]),_:1})]),k("div",null,[t(M,{class:"text-overline"},{default:r(()=>{var c;return[T(I(((c=A(fe)().tokenList.find(m=>m.address==e.raffle.account.ticketMint.toString()))==null?void 0:c.name)??e.raffle.account.ticketMint.toString()),1)]}),_:1}),t(M,{class:"text-accent",caption:""},{default:r(()=>[T("Ticket-Mint")]),_:1})])]),_:1})]),_:1}),e.raffle.account.randomness!=null?(v(),_(K,{key:0,clickable:""},{default:r(()=>[t(E,{avatar:""},{default:r(()=>{var c,m;return[t(Aa,{style:{width:"100px"},seed:(m=(c=e.raffle.account)==null?void 0:c.winner)==null?void 0:m.toString()},null,8,["seed"])]}),_:1}),t(E,null,{default:r(()=>[t(M,{class:"text-h6",l:""},{default:r(()=>[T("Winner")]),_:1}),t(M,{class:"text-orange-9",caption:""},{default:r(()=>{var c;return[T(I(A(De)((c=e.raffle.account.winner)==null?void 0:c.toString())),1)]}),_:1})]),_:1})]),_:1})):x("",!0)]),_:1})]),_:1}),t(L),t(Bt,{icon:"info",label:"Details"},{default:r(()=>[t(ae,{flat:""},{default:r(()=>[t(L),t(C,null,{default:r(()=>[t(ha,{accounts:o.value},null,8,["accounts"])]),_:1}),t(L),t(C,null,{default:r(()=>[t(Ca,{entrants:n.value},null,8,["entrants"])]),_:1}),t(L),t(C,null,{default:r(()=>[t(Ea,{raffle:e.raffle,entrants:n.value,class:"q-pb-md"},null,8,["raffle","entrants"])]),_:1})]),_:1})]),_:1}),t(L),e.is_admin?(v(),_(C,{key:0},{default:r(()=>[Object.keys(e.raffle.account.state)[0]=="created"?(v(),_(Ft,{key:0,raffle:e.raffle},null,8,["raffle"])):x("",!0)]),_:1})):x("",!0),Object.keys(e.raffle.account.state)[0]=="running"&&!e.is_admin?(v(),_(Ue,{key:1},{default:r(()=>[t(oa,{raffle:e.raffle,tickets:i.value},null,8,["raffle","tickets"])]),_:1})):x("",!0),e.is_admin?(v(),_(C,{key:2,class:"col"},{default:r(()=>[ja,k("div",Da,[Object.keys(e.raffle.account.state)[0]=="full"?(v(),_(ua,{key:0,raffle:e.raffle},null,8,["raffle"])):x("",!0),Object.keys(e.raffle.account.state)[0]=="claimprize"||Object.keys(e.raffle.account.state)[0]=="ready"?(v(),_(ga,{key:1,raffle:e.raffle},null,8,["raffle"])):x("",!0),Object.keys(e.raffle.account.state)[0]=="claimtickets"?(v(),_(_a,{key:2,raffle:e.raffle},null,8,["raffle"])):x("",!0),Object.keys(e.raffle.account.state)[0]=="ready"||Object.keys(e.raffle.account.state)[0]=="running"||Object.keys(e.raffle.account.state)[0]=="paused"?(v(),_(Ma,{key:3,raffle:e.raffle},null,8,["raffle"])):x("",!0),Object.keys(e.raffle.account.state)[0]=="created"||Object.keys(e.raffle.account.state)[0]=="done"?(v(),_(ka,{key:4,raffle:e.raffle},null,8,["raffle"])):x("",!0)])]),_:1})):x("",!0)]),_:1}))}}),Ua={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},Ee=S({__name:"RaffleGrid",props:{is_admin:{type:Boolean,default:!1},raffles:{type:[],default:[]},count:{type:Number,default:0}},setup(e){const a=e,i=z(()=>[0]),o=g({rowsPerPage:0});return(n,l)=>(v(),_(ye,{grid:"",rows:a.raffles,"row-key":"name","hide-header":"",pagination:o.value,"onUpdate:pagination":l[0]||(l[0]=s=>o.value=s),"rows-per-page-options":i.value},{item:r(s=>[k("div",Ua,[t(La,{is_admin:e.is_admin,raffle:s.row},null,8,["is_admin","raffle"])])]),_:1},8,["rows","pagination","rows-per-page-options"]))}}),Na=k("p",{class:"text-h5"},"Raffle",-1),Wa=k("p",{class:"text-h5"},"Tickets",-1),Ha={class:"row justify-center"},Ka=k("p",{class:"text-h5"},"Whitelist",-1),Fa={class:"col q-gutter-y-sm"},Ga=S({__name:"RaffleCreateRaffle",setup(e){const a=g(),i=g(),o=g(),n=g(),l=g(),s=g(),u=g([]);ne(()=>f()),te(()=>Oe().whitelists,()=>f());function f(){Oe().whitelists.forEach(c=>{u.value.push({label:"Crew",value:c.publicKey.toString()})}),u.value.push({label:"none",value:null}),s.value=u.value.find(c=>c.label=="Crew")}async function p(){var c,m;try{const y=new N,w=(c=O())==null?void 0:c.pg_raffle.value,P=new ve(window.crypto.getRandomValues(new Uint8Array(8))),G=ma(a.value,P),Y=Ke(),re=await U().connection.getParsedAccountInfo(new b(l.value.value));y.add(await(w==null?void 0:w.methods.initialize(a.value,i.value,jt(n.value,(m=re.value)==null?void 0:m.data.parsed.info.decimals),o.value,P).accountsPartial({creator:$(),raffle:G,ticketsMint:new b(l.value.value),whitelist:Y}).instruction())),await B(y,"[Raffle] Create"),await q().updateStore()}catch(y){W.create({color:"red",message:`${y}`,timeout:5e3})}}const d=g([]);return g(se().token_accounts.filter(c=>c.account.data.parsed.info.tokenAmount.uiAmount>0).flatMap(c=>c.account.data.parsed.info.mint)).value.forEach(c=>{var y,w;const m=((y=V().token_list.find(P=>P.address==c))==null?void 0:y.name)??c+" ["+((w=V().token_list.find(P=>P.address==c))==null?void 0:w.symbol)??"]";d.value.push({label:m,value:c})}),(c,m)=>(v(),_(ae,{square:"",flat:"",class:"col q-pa-sm",style:{"max-width":"800px"}},{default:r(()=>[t(C,{class:"q-gutter-y-md"},{default:r(()=>[Na,t(J,{filled:"",square:"",modelValue:a.value,"onUpdate:modelValue":m[0]||(m[0]=y=>a.value=y),type:"text",label:"Name"},null,8,["modelValue"]),t(J,{filled:"",square:"",modelValue:i.value,"onUpdate:modelValue":m[1]||(m[1]=y=>i.value=y),type:"text",label:"Description"},null,8,["modelValue"])]),_:1}),t(L),t(C,{class:"q-gutter-y-md"},{default:r(()=>[Wa,k("div",Ha,[t(pe,{class:"col",filled:"",square:"",modelValue:l.value,"onUpdate:modelValue":m[2]||(m[2]=y=>l.value=y),clearable:"","use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",behavior:"menu",label:"Select Ticket by mint",options:d.value,style:{width:"250px"}},{"no-option":r(()=>[t(K,null,{default:r(()=>[t(E,{class:"text-grey"},{default:r(()=>[T(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"]),t(Q,{icon:"refresh",color:"primary",square:"",onClick:m[3]||(m[3]=y=>A(se)().update_accounts())})]),t(J,{filled:"",square:"",modelValue:o.value,"onUpdate:modelValue":m[4]||(m[4]=y=>o.value=y),type:"number",label:"Tickets"},null,8,["modelValue"]),t(J,{filled:"",square:"",type:"number",modelValue:n.value,"onUpdate:modelValue":m[5]||(m[5]=y=>n.value=y),label:"Ticket Price"},null,8,["modelValue"])]),_:1}),t(C,{class:"q-gutter-y-md"},{default:r(()=>[Ka,k("div",Fa,[t(pe,{class:"full-width",filled:"",square:"",modelValue:s.value,"onUpdate:modelValue":m[6]||(m[6]=y=>s.value=y),clearable:"","use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",behavior:"menu",label:"Whitelist selcted",options:u.value,style:{width:"250px"}},{"no-option":r(()=>[t(K,null,{default:r(()=>[t(E,{class:"text-grey"},{default:r(()=>[T(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])])]),_:1}),t(L),t(C,{class:"row justify-end"},{default:r(()=>[t(Q,{icon:"send",square:"",class:"row",color:"primary",onClick:m[7]||(m[7]=y=>p()),label:"Create"})]),_:1})]),_:1}))}}),Ya={class:"row shadow-2"},Ja={key:0,class:"row"},Za={key:1,class:""},Xa={key:1,class:"row justify-center"},Qn=S({__name:"RafflePage",setup(e){const a=g("raffle");return ne(async()=>{await q().updateStore()}),(i,o)=>(v(),_(_t,{class:"col bg-black"},{default:r(()=>[k("div",Ya,[t(rt,{modelValue:a.value,"onUpdate:modelValue":o[0]||(o[0]=n=>a.value=n),"no-caps":"","outside-arrows":"","mobile-arrows":"",class:"col bg-dark"},{default:r(()=>[t(ue,{name:"raffle",label:"Raffle"}),A(V)().is_admin?(v(),_(ue,{key:0,name:"create",label:"Create"})):x("",!0),A(V)().is_admin?(v(),_(ue,{key:1,name:"manage",label:"Manage"})):x("",!0)]),_:1},8,["modelValue"]),t(Q,{flat:"",class:"bg-dark",icon:"refresh",onClick:o[1]||(o[1]=n=>A(q)().updateStore())})]),A(q)().raffles.length==0?(v(),D("div",Ja,[t(le),t(kt,{class:"row",color:"primary",size:"10rem"}),t(le)])):x("",!0),A(q)().raffles.length>0?(v(),D("div",Za,[a.value==="raffle"?(v(),_(Ee,{key:0,raffles:A(q)().getRunningRaffles,is_admin:!1},null,8,["raffles"])):x("",!0),a.value==="create"?(v(),D("div",Xa,[t(Ga,{class:"q-mt-xl"})])):x("",!0),a.value==="manage"?(v(),_(Ee,{key:2,raffles:A(q)().raffles,is_admin:A(V)().is_admin},null,8,["raffles","is_admin"])):x("",!0)])):x("",!0)]),_:1}))}});export{Qn as default};
