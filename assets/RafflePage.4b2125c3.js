import{Q as qe}from"./QPage.0a30b619.js";import{Q as re,a as Te,b as ut}from"./QInput.9876aabd.js";import{K as dt,bZ as De,cu as He,J as y,ah as R,bs as F,aT as ye,aF as I,aC as We,bz as Ge,bT as ft,cg as Fe,cm as ae,cc as Ye,au as C,cr as q,b1 as v,ak as Y,al as w,as as t,bx as s,ar as A,ck as L,cT as z,P as x,cn as D,cp as S,cY as _e,cS as X,cZ as T,cP as Z,cb as Ce,c6 as Oe,bC as mt,cQ as U,c_ as Xe,c$ as gt,aX as he,V as P,a6 as vt,d0 as pt,ai as h,a1 as W,d1 as Ze,d2 as Je,d3 as et,d4 as tt,d5 as Ie,d6 as yt,d7 as _t,aj as $,cj as Re,cq as Be,d8 as bt,d9 as ht,cl as kt}from"./index.d56c8e4c.js";import{Q as be}from"./QSpace.3da72bf1.js";import{u as le,Q as wt,a as Ae,f as xt,b as St}from"./format_address.bc4fd6ff.js";import{Q as at}from"./QImg.072b2c38.js";import{Q as me,a as M}from"./QCard.02601849.js";import{Q as ne,a as Tt}from"./QList.1f6cd22f.js";import{f as nt,u as Pt,h as lt,d as It,M as Ve,j as ot,l as G,n as Q,m as E,O as At,v as $t,P as Ee,R as qt,w as Ct,i as Ot,x as Rt,S as Bt,T as Vt,y as Et,U as Me,V as Mt,c as Le,g as Lt,W as Ke,X as Kt}from"./use-key-composition.98db075b.js";import{a as Qt}from"./QSlideTransition.d89b8221.js";import{Q as st}from"./QCardActions.ce4b5449.js";import{Q as Pe,c as zt}from"./QSelect.c25aa818.js";import{C as jt}from"./ClosePopup.bba9fdfc.js";import{Q as Qe}from"./QBadge.d3c531ad.js";import{_ as Ut}from"./plugin-vue_export-helper.21dcd24c.js";import"./index.27d41b41.js";const te=dt({}),Nt=Object.keys(He);var Dt=De({name:"QExpansionItem",props:{...He,...nt,...Pt,icon:String,label:String,labelLines:[Number,String],caption:String,captionLines:[Number,String],dense:Boolean,toggleAriaLabel:String,expandIcon:String,expandedIcon:String,expandIconClass:[Array,String,Object],duration:Number,headerInsetLevel:Number,contentInsetLevel:Number,expandSeparator:Boolean,defaultOpened:Boolean,hideExpandIcon:Boolean,expandIconToggle:Boolean,switchToggleSide:Boolean,denseToggle:Boolean,group:String,popup:Boolean,headerStyle:[Array,String,Object],headerClass:[Array,String,Object]},emits:[...lt,"click","afterShow","afterHide"],setup(e,{slots:o,emit:c}){const{proxy:{$q:l}}=We(),a=It(e,l),n=y(e.modelValue!==null?e.modelValue:e.defaultOpened),r=y(null),u=Ve(),{show:f,hide:g,toggle:b}=ot({showing:n});let m,i;const d=R(()=>`q-expansion-item q-item-type q-expansion-item--${n.value===!0?"expanded":"collapsed"} q-expansion-item--${e.popup===!0?"popup":"standard"}`),_=R(()=>{if(e.contentInsetLevel===void 0)return null;const p=l.lang.rtl===!0?"Right":"Left";return{["padding"+p]:e.contentInsetLevel*56+"px"}}),k=R(()=>e.disable!==!0&&(e.href!==void 0||e.to!==void 0&&e.to!==null&&e.to!=="")),O=R(()=>{const p={};return Nt.forEach(j=>{p[j]=e[j]}),p}),K=R(()=>k.value===!0||e.expandIconToggle!==!0),ce=R(()=>e.expandedIcon!==void 0&&n.value===!0?e.expandedIcon:e.expandIcon||l.iconSet.expansionItem[e.denseToggle===!0?"denseIcon":"icon"]),ue=R(()=>e.disable!==!0&&(k.value===!0||e.expandIconToggle===!0)),oe=R(()=>({expanded:n.value===!0,detailsId:e.targetUid,toggle:b,show:f,hide:g})),B=R(()=>{const p=e.toggleAriaLabel!==void 0?e.toggleAriaLabel:l.lang.label[n.value===!0?"collapse":"expand"](e.label);return{role:"button","aria-expanded":n.value===!0?"true":"false","aria-controls":u,"aria-label":p}});F(()=>e.group,p=>{i!==void 0&&i(),p!==void 0&&fe()});function se(p){k.value!==!0&&b(p),c("click",p)}function N(p){p.keyCode===13&&H(p,!0)}function H(p,j){j!==!0&&r.value!==null&&r.value.focus(),b(p),Ye(p)}function de(){c("afterShow")}function ge(){c("afterHide")}function fe(){m===void 0&&(m=Ve()),n.value===!0&&(te[e.group]=m);const p=F(n,ie=>{ie===!0?te[e.group]=m:te[e.group]===m&&delete te[e.group]}),j=F(()=>te[e.group],(ie,pe)=>{pe===m&&ie!==void 0&&ie!==m&&g()});i=()=>{p(),j(),te[e.group]===m&&delete te[e.group],i=void 0}}function ke(){const p={class:[`q-focusable relative-position cursor-pointer${e.denseToggle===!0&&e.switchToggleSide===!0?" items-end":""}`,e.expandIconClass],side:e.switchToggleSide!==!0,avatar:e.switchToggleSide},j=[I(ae,{class:"q-expansion-item__toggle-icon"+(e.expandedIcon===void 0&&n.value===!0?" q-expansion-item__toggle-icon--rotated":""),name:ce.value})];return ue.value===!0&&(Object.assign(p,{tabindex:0,...B.value,onClick:H,onKeyup:N}),j.unshift(I("div",{ref:r,class:"q-expansion-item__toggle-focus q-icon q-focus-helper q-focus-helper--rounded",tabindex:-1}))),I(E,p,()=>j)}function we(){let p;return o.header!==void 0?p=[].concat(o.header(oe.value)):(p=[I(E,()=>[I(Q,{lines:e.labelLines},()=>e.label||""),e.caption?I(Q,{lines:e.captionLines,caption:!0},()=>e.caption):null])],e.icon&&p[e.switchToggleSide===!0?"push":"unshift"](I(E,{side:e.switchToggleSide===!0,avatar:e.switchToggleSide!==!0},()=>I(ae,{name:e.icon})))),e.disable!==!0&&e.hideExpandIcon!==!0&&p[e.switchToggleSide===!0?"unshift":"push"](ke()),p}function xe(){const p={ref:"item",style:e.headerStyle,class:e.headerClass,dark:a.value,disable:e.disable,dense:e.dense,insetLevel:e.headerInsetLevel};return K.value===!0&&(p.clickable=!0,p.onClick=se,Object.assign(p,k.value===!0?O.value:B.value)),I(G,p,we)}function ve(){return Ge(I("div",{key:"e-content",class:"q-expansion-item__content relative-position",style:_.value,id:u},Fe(o.default)),[[ft,n.value]])}function J(){const p=[xe(),I(Qt,{duration:e.duration,onShow:de,onHide:ge},ve)];return e.expandSeparator===!0&&p.push(I(ne,{class:"q-expansion-item__border q-expansion-item__border--top absolute-top",dark:a.value}),I(ne,{class:"q-expansion-item__border q-expansion-item__border--bottom absolute-bottom",dark:a.value})),p}return e.group!==void 0&&fe(),ye(()=>{i!==void 0&&i()}),()=>I("div",{class:d.value},[I("div",{class:"q-expansion-item__container relative-position"},J())])}});const Ht={class:"col q-pa-sm"},Wt=w("p",{class:"text-overline"},"Add a prize:",-1),Gt={class:"col q-gutter-y-sm"},Ft={class:"row"},Yt=C({__name:"RafflePrepare",props:["raffle"],setup(e){const o=y(1),c=y(""),l=y(""),a=e,n=y([]);y(le().token_accounts.filter(f=>f.account.data.parsed.info.tokenAmount.uiAmount>0).flatMap(f=>f.account.data.parsed.info.mint)).value.forEach(f=>{var g,b;return n.value.push({label:q().token_list.find(m=>m.address==f)?((g=q().token_list.find(m=>m.address==f))==null?void 0:g.name)+" ["+((b=q().token_list.find(m=>m.address==f))==null?void 0:b.symbol)+"]":f,value:f})});async function u(){var d,_,k,O;const f=(d=z())==null?void 0:d.pg_raffle.value,g=new x(l.value.value),b=(await D().connection.getParsedTokenAccountsByOwner(S().publicKey.value,{mint:g})).value[0].pubkey,m=new x(a.raffle.publicKey.toString()),i=await D().connection.getParsedAccountInfo(g);console.log((_=i.value)==null?void 0:_.data.parsed.info.decimals),c.value=((k=q().token_list.find(K=>K.address==g))==null?void 0:k.logoURI)??"";try{const K=await(f==null?void 0:f.methods.prepare(new _e(o.value*Math.pow(10,(O=i.value)==null?void 0:O.data.parsed.info.decimals)),c.value).accountsPartial({creator:S().publicKey.value,raffle:m,from:b,prizeMint:g}).rpc());console.log(K),await X(K),await T().update_raffles()}catch(K){Z.create({color:"red",message:`${K}`,timeout:5e3})}}return(f,g)=>(v(),Y("div",Ht,[Wt,w("div",Gt,[t(Pe,{class:"full-width",filled:"",square:"",modelValue:l.value,"onUpdate:modelValue":g[0]||(g[0]=b=>l.value=b),clearable:"","use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",behavior:"menu",label:"Select Ticket by mint",options:n.value,style:{width:"250px"}},{"no-option":s(()=>[t(G,null,{default:s(()=>[t(E,{class:"text-grey"},{default:s(()=>[A(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"]),w("div",Ft,[t(re,{class:"col",filled:"",square:"",modelValue:o.value,"onUpdate:modelValue":g[1]||(g[1]=b=>o.value=b),type:"number",label:"Count"},null,8,["modelValue"]),t(L,{filled:"",square:"",class:"col-2",color:"primary",icon:"send",onClick:g[2]||(g[2]=b=>u())})])])]))}});var Xt=De({name:"QTooltip",inheritAttrs:!1,props:{...At,...nt,...$t,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{default:"jump-down"},transitionHide:{default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:Ee},self:{type:String,default:"top middle",validator:Ee},offset:{type:Array,default:()=>[14,14],validator:qt},scrollTarget:{default:void 0},delay:{type:Number,default:0},hideDelay:{type:Number,default:0}},emits:[...lt],setup(e,{slots:o,emit:c,attrs:l}){let a,n;const r=We(),{proxy:{$q:u}}=r,f=y(null),g=y(!1),b=R(()=>Ke(e.anchor,u.lang.rtl)),m=R(()=>Ke(e.self,u.lang.rtl)),i=R(()=>e.persistent!==!0),{registerTick:d,removeTick:_}=Ct(),{registerTimeout:k}=Ot(),{transitionProps:O,transitionStyle:K}=Rt(e),{localScrollTarget:ce,changeScrollEvent:ue,unconfigureScrollTarget:oe}=Bt(e,pe),{anchorEl:B,canShow:se,anchorEvents:N}=Vt({showing:g,configureAnchorEl:ie}),{show:H,hide:de}=ot({showing:g,canShow:se,handleShow:we,handleHide:xe,hideOnRouteChange:i,processOnMount:!0});Object.assign(N,{delayShow:p,delayHide:j});const{showPortal:ge,hidePortal:fe,renderPortal:ke}=Et(r,f,ct,"tooltip");if(u.platform.is.mobile===!0){const V={anchorEl:B,innerRef:f,onClickOutside(ee){return de(ee),ee.target.classList.contains("q-dialog__backdrop")&&Ye(ee),!0}},Se=R(()=>e.modelValue===null&&e.persistent!==!0&&g.value===!0);F(Se,ee=>{(ee===!0?Kt:Me)(V)}),ye(()=>{Me(V)})}function we(V){ge(),d(()=>{n=new MutationObserver(()=>J()),n.observe(f.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),J(),pe()}),a===void 0&&(a=F(()=>u.screen.width+"|"+u.screen.height+"|"+e.self+"|"+e.anchor+"|"+u.lang.rtl,J)),k(()=>{ge(!0),c("show",V)},e.transitionDuration)}function xe(V){_(),fe(),ve(),k(()=>{fe(!0),c("hide",V)},e.transitionDuration)}function ve(){n!==void 0&&(n.disconnect(),n=void 0),a!==void 0&&(a(),a=void 0),oe(),Ce(N,"tooltipTemp")}function J(){Mt({targetEl:f.value,offset:e.offset,anchorEl:B.value,anchorOrigin:b.value,selfOrigin:m.value,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function p(V){if(u.platform.is.mobile===!0){Le(),document.body.classList.add("non-selectable");const Se=B.value,ee=["touchmove","touchcancel","touchend","click"].map($e=>[Se,$e,"delayHide","passiveCapture"]);Oe(N,"tooltipTemp",ee)}k(()=>{H(V)},e.delay)}function j(V){u.platform.is.mobile===!0&&(Ce(N,"tooltipTemp"),Le(),setTimeout(()=>{document.body.classList.remove("non-selectable")},10)),k(()=>{de(V)},e.hideDelay)}function ie(){if(e.noParentEvent===!0||B.value===null)return;const V=u.platform.is.mobile===!0?[[B.value,"touchstart","delayShow","passive"]]:[[B.value,"mouseenter","delayShow","passive"],[B.value,"mouseleave","delayHide","passive"]];Oe(N,"anchor",V)}function pe(){if(B.value!==null||e.scrollTarget!==void 0){ce.value=Lt(B.value,e.scrollTarget);const V=e.noParentEvent===!0?J:de;ue(ce.value,V)}}function rt(){return g.value===!0?I("div",{...l,ref:f,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",l.class],style:[l.style,K.value],role:"tooltip"},Fe(o.default)):null}function ct(){return I(mt,O.value,rt)}return ye(ve),Object.assign(r.proxy,{updatePosition:J}),ke}});const Zt={class:"col q-pa-sm q-gutter-y-sm"},Jt=w("p",{class:"text-overline"},"Buy Ticket(s)",-1),ea={class:"row"},ta={class:"text-caption text-right text-weight-thin"},aa=C({__name:"RaffleBuyTicket",props:["raffle","tickets"],setup(e){const o=y(),c=e;async function l(){var m,i,d;await le().update_accounts();const a=(m=z())==null?void 0:m.pg_raffle.value,n=(i=z())==null?void 0:i.pg_whitelist.value,r=new x(c.raffle.account.ticketMint.toString()),u=(await D().connection.getParsedTokenAccountsByOwner(S().publicKey.value,{mint:r})).value[0].pubkey,f=new x(c.raffle.publicKey.toString());x.findProgramAddressSync([U("entrants"),f.toBytes()],a==null?void 0:a.programId),x.findProgramAddressSync([U("proceeds"),f.toBytes()],a==null?void 0:a.programId);let[g,b]=x.findProgramAddressSync([Xe.toBuffer(),U(gt)],n==null?void 0:n.programId);x.findProgramAddressSync([S().publicKey.value.toBytes(),g.toBytes()],n==null?void 0:n.programId);try{const _=await(a==null?void 0:a.methods.buyTickets(new _e(o.value)).accountsPartial({signer:S().publicKey.value,raffle:f,entrant:S().publicKey.value,ticketsMint:r,from:u,whitelist:g,whitelistEntry:x.findProgramAddressSync([S().publicKey.value.toBytes(),g.toBytes()],n==null?void 0:n.programId)[0],whitelistProgram:n==null?void 0:n.programId}).rpc());console.log(_),await X(_)&&(await T().send_buy_message_discord(c.raffle.account.name.toString(),`${parseInt(c.tickets.sold.toString())+parseInt(o.value.toString())}/${(d=c.tickets)==null?void 0:d.total}`,o.value),await T().update_raffles(),await le().update_accounts())}catch(_){Z.create({color:"red",message:`${_}`,timeout:5e3})}}return(a,n)=>(v(),Y("div",Zt,[Jt,w("div",ea,[t(re,{square:"",filled:"",outlined:"",type:"number",class:"col",label:"Amount",modelValue:o.value,"onUpdate:modelValue":n[0]||(n[0]=r=>o.value=r)},null,8,["modelValue"]),t(L,{square:"",color:"primary",icon:"send",onClick:n[1]||(n[1]=r=>{l().then(()=>{console.log("done sending!")})})})]),w("p",ta,[A(" 0.001\u25CE fee "),t(Xt,{anchor:"bottom right",self:"top middle"},{default:s(()=>[A(" cover deployment costs ")]),_:1})])]))}}),na=w("source",{src:"Burningticket.mp4",type:"video/mp4"},null,-1),la=C({__name:"BurningTicket",setup(e){const o=y();return he(()=>{o.value.playbackRate=.3,console.log(o.value)}),(c,l)=>(v(),Y("video",{ref_key:"ticket_burning",ref:o,autoplay:"",playbackspeed:"0.1"},[na,A(" Your browser does not support the video tag. ")],512))}}),oa=w("div",{class:"text-h6 text-center"},"Drawing...",-1),sa=C({__name:"RaffleRevealWinner",props:["raffle","is_admin"],setup(e){y();const o=e,c=y(!1);async function l(){var f;const a=(f=z())==null?void 0:f.pg_raffle.value,n=new x(o.raffle.publicKey.toString());let[r,u]=x.findProgramAddressSync([U("tickets"),n.toBytes()],a==null?void 0:a.programId);try{const g=await(a==null?void 0:a.methods.revealWinners().accounts({raffle:n,tickets:r,recentBlockHashes:pt}).rpc());console.log(g),await X(g),c.value=!0}catch(g){Z.create({color:"red",message:`${g}`,timeout:5e3})}}return(a,n)=>(v(),Y(vt,null,[t(L,{square:"",class:"row",color:"primary",icon:"send",label:"Reveal Winner",onClick:n[0]||(n[0]=r=>l())}),t(zt,{maximized:!0,modelValue:c.value,"onUpdate:modelValue":n[2]||(n[2]=r=>c.value=r)},{default:s(()=>[t(me,{flat:"",square:"",class:""},{default:s(()=>[t(M,null,{default:s(()=>[oa]),_:1}),t(M,{class:"q-pt-none row"},{default:s(()=>[t(be),t(la),t(be)]),_:1}),t(st,{align:"right"},{default:s(()=>[Ge(t(L,{flat:"",label:"close",color:"primary",onClick:n[1]||(n[1]=r=>P(T)().update_raffles())},null,512),[[jt]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),ia={class:"absolute-full flex flex-center"};var it=(e=>(e.created="orange",e.ready="orange",e.paused="pink",e.full="purple",e.claimprize="purple",e.claimtickets="purple",e.running="primary",e))(it||{});const ra=C({__name:"RaffleStateBadge",props:["raffle","tickets"],setup(e){const o=e,c=R(()=>{var l,a;return((l=o.tickets)==null?void 0:l.sold)/((a=o.tickets)==null?void 0:a.total)});return(l,a)=>Object.keys(e.raffle.account.state)[0]=="running"?(v(),h(wt,{key:0,size:"25px",value:c.value,color:"primary"},{default:s(()=>{var n,r;return[w("div",ia,[t(Qe,{color:"black","text-color":"primary",label:`Tickets: ${(n=e.tickets)==null?void 0:n.sold}/${(r=e.tickets)==null?void 0:r.total}`},null,8,["label"])])]}),_:1},8,["value"])):(v(),h(Qe,{key:1,color:it[Object.keys(e.raffle.account.state)[0]],class:"text-h6 justify-center full-width"},{default:s(()=>[A(W(Object.keys(e.raffle.account.state)[0].toUpperCase()),1)]),_:1},8,["color"]))}}),ca=C({__name:"RaffleClaimPrize",props:["raffle","is_admin"],setup(e){const o=e;async function c(){var b;const l=(b=z())==null?void 0:b.pg_raffle.value,a=new x(o.raffle.account.prizeMint.toString()),n=new x(o.raffle.account.winner.toString()),r=await Ze(a,n,!0,Ie,tt.ASSOCIATED_PROGRAM_ID);if(await D().connection.getAccountInfo(r)===null){let m=new Je;m.add(et(S().publicKey.value,r,n,a)),await S().sendTransaction(m,D().connection)}const u=new x(o.raffle.publicKey.toString());let[f,g]=x.findProgramAddressSync([U("vaultPrize"),u.toBytes()],l==null?void 0:l.programId);console.log(o.raffle.account.name);try{const m=await(l==null?void 0:l.methods.claimPrize().accountsPartial({raffle:u,prizeMint:a,prizeVault:f,to:r}).rpc());console.log(m),await X(m),await T().update_raffles()}catch(m){Z.create({color:"red",message:`${m}`,timeout:5e3})}}return(l,a)=>(v(),h(L,{color:"primary",icon:"send",label:"Claim Prize",onClick:a[0]||(a[0]=n=>c())}))}});async function ua(e){try{return!!await D().connection.getAccountInfo(e)}catch(o){return console.error("Error checking account:",o),!1}}const da=C({__name:"RaffleClose",props:["raffle"],setup(e){const o=e;async function c(){var m;const l=(m=z())==null?void 0:m.pg_raffle.value;let a=o.raffle.publicKey,[n,r]=x.findProgramAddressSync([U("tickets"),a.toBytes()],l==null?void 0:l.programId),[u,f]=x.findProgramAddressSync([U("vaultTickets"),a.toBytes()],l==null?void 0:l.programId),[g,b]=x.findProgramAddressSync([U("vaultPrize"),a.toBytes()],l==null?void 0:l.programId);await ua(g)||(g=null);try{const i=await(l==null?void 0:l.methods.close().accountsPartial({creator:S().publicKey.value,raffle:a,tickets:n,ticketsVault:u,prizeVault:g}).rpc());console.log(i),await X(i),await T().update_raffles()}catch(i){Z.create({color:"red",message:`${i}`,timeout:5e3})}}return(l,a)=>(v(),h(L,{square:"",color:"primary",icon:"send",label:"Close Raffle",onClick:a[0]||(a[0]=n=>c())}))}}),fa=C({__name:"RaffleClaimTickets",props:["raffle","is_admin"],setup(e){y(),y();const o=e;async function c(){var r;const l=(r=z())==null?void 0:r.pg_raffle.value,a=new x(o.raffle.account.ticketMint.toString()),n=await Ze(a,S().publicKey.value,!0,Ie,tt.ASSOCIATED_PROGRAM_ID);if(await D().connection.getAccountInfo(n)===null){let u=new Je;u.add(et(S().publicKey.value,n,S().publicKey.value,a)),await S().sendTransaction(u,D().connection)}try{const u=await(l==null?void 0:l.methods.claimTickets().accountsPartial({creator:S().publicKey.value,raffle:o.raffle.publicKey,ticketsMint:a,to:n}).rpc());console.log(u),await X(u),await T().update_raffles()}catch(u){Z.create({color:"red",message:`${u}`,timeout:5e3})}}return(l,a)=>(v(),h(L,{color:"primary",icon:"send",label:"Claim Tickets",onClick:a[0]||(a[0]=n=>c())}))}}),ma=C({__name:"AccountsTable",props:["accounts"],setup(e){const o=y({rowsPerPage:0}),c=y([{name:"mint",required:!0,label:"Mint",align:"left",field:"mint",field:l=>{var a,n;return((a=q().token_list.find(r=>{var u;return r.address==((u=l.mint)==null?void 0:u.toString())}))==null?void 0:a.name)??((n=l.mint)==null?void 0:n.toString())},sortable:!0},{name:"calories",align:"right",label:"Amount",field:l=>l.tokenAmount.uiAmount,sortable:!0}]);return(l,a)=>{var n,r;return v(),h(Ae,{bordered:"",square:"",dense:"",class:"col",title:"Accounts",rows:(r=(n=e.accounts)==null?void 0:n.value)==null?void 0:r.map(u=>u.account.data.parsed.info),columns:c.value,"row-key":"mint","hide-bottom":"",flat:"",pagination:o.value,"onUpdate:pagination":a[0]||(a[0]=u=>o.value=u),"rows-per-page-options":[0]},null,8,["rows","columns","pagination"])}}}),ze=9,ga=95,va=45,je=5;function pa(e){return e.split("").reduce((o,c)=>(o^c.charCodeAt(0))*-je,je)>>>2}function ya(e="",o=ga,c=va,l=pa){const a=l(e),n=a%ze*(360/ze);return[...Array(e?25:0)].reduce((r,u,f)=>a&1<<f%15?r+`<rect x="${f>14?7-~~(f/5):~~(f/5)}" y="${f%5}" width="1" height="1"/>`:r,`<svg viewBox="-1.5 -1.5 8 8" xmlns="http://www.w3.org/2000/svg" fill="hsl(${n} ${o}% ${c}%)">`)+"</svg>"}const _a=["innerHTML"],ba=C({__name:"IconFromSeed",props:{seed:{type:String,default:"default"}},setup(e){const c=y(ya(e.seed));return(l,a)=>(v(),Y("div",{innerHTML:c.value},null,8,_a))}}),ha=C({__name:"TicketsTable",props:["entrants"],setup(e){const o=y({rowsPerPage:0});y();const c=y([{name:"wallet",required:!0,label:"Wallet",align:"left",field:l=>xt(l.address),sortable:!0},{name:"amount",align:"right",label:"Amount",field:"amount",sortable:!0}]);return(l,a)=>(v(),h(Ae,{bordered:"",square:"",dense:"",class:"col",title:"Tickets",rows:e.entrants,columns:c.value,"row-key":"mint","hide-bottom":"",flat:"",pagination:o.value,"onUpdate:pagination":a[0]||(a[0]=n=>o.value=n),"rows-per-page-options":[0]},null,8,["rows","columns","pagination"]))}}),ka={};function wa(e,o){return v(),h(yt,{size:"xs"},{default:s(()=>[t(at,{src:"solscan.png"})]),_:1})}var Ue=Ut(ka,[["render",wa]]);const xa=w("div",{class:"col q-gutter-y-sm"},[w("div",null,"Raffle account"),w("div",null,"Entrants account"),w("div",null,"Use Whitelist?")],-1),Sa={class:"col q-gutter-y-sm"},Ta=C({__name:"RaffleLinks",props:["raffle","entrants"],setup(e){const o=e;return y({rowsPerPage:0}),(c,l)=>(v(),h(me,{bordered:"",flat:"",square:"",class:"row items-center q-pa-md"},{default:s(()=>[xa,w("div",Sa,[t(L,{class:"full-width",size:"xs",square:"",color:"primary",href:"https://solscan.io/account/"+o.raffle.publicKey,target:"_blank"},{default:s(()=>[t(Ue)]),_:1},8,["href"]),t(L,{class:"full-width",square:"",size:"xs",color:"primary",href:"https://solscan.io/account/"+o.raffle.account.entrants,target:"_blank"},{default:s(()=>[t(Ue)]),_:1},8,["href"]),e.raffle.account.useWhitelist?(v(),h(ae,{key:0,name:"check"})):(v(),h(ae,{key:1,name:"clear"}))])]),_:1}))}}),Pa=C({__name:"RaffleToggleMode",props:["raffle"],setup(e){const o=e;async function c(){var n;const l=(n=z())==null?void 0:n.pg_raffle.value;let a=await(l==null?void 0:l.account.raffle.fetch(o.raffle.publicKey));console.log(a),console.log(Object.keys(a.state)[0]);try{let r;switch(Object.keys(a.state)[0]){case"ready":r=await(l==null?void 0:l.methods.enable().accountsPartial({creator:S().publicKey.value,raffle:o.raffle.publicKey}).rpc());break;case"paused":r=await(l==null?void 0:l.methods.enable().accountsPartial({creator:S().publicKey.value,raffle:o.raffle.publicKey}).rpc());break;case"running":r=await(l==null?void 0:l.methods.disable().accountsPartial({creator:S().publicKey.value,raffle:o.raffle.publicKey}).rpc());break}console.log(r),r&&await X(r),await T().update_raffles()}catch(r){Z.create({color:"red",message:`${r}`,timeout:5e3})}}return(l,a)=>(v(),h(L,{icon:"send",label:"Start/Pause",square:"",color:"primary",onClick:a[0]||(a[0]=n=>c())}))}}),Ia={class:"text-h5 q-mt-sm q-mb-xs"},Aa={class:"text-caption text-grey"},$a=w("p",{class:"text-overline"},"Actions",-1),qa={class:"col row justify-end q-mx-sm"},Ca=C({__name:"RaffleCard",props:["raffle","is_admin"],setup(e){const o=e,c=y(),l=y();y(!1);async function a(){const{pg_raffle:b}=z();c.value=await b.value.account.tickets.fetch(o.raffle.account.tickets),console.log(c.value),l.value=await D().connection.getParsedTokenAccountsByOwner(o.raffle.publicKey,{programId:Ie})}const n=y();async function r(){const{pg_raffle:b}=z(),m=await b.value.account.tickets.getAccountInfo(o.raffle.account.tickets);let i=[];for(let k=0;k<c.value.total;k++){let O=u(m.data,k);i.push(O)}const _=i.map(k=>k.toString()).reduce((k,O)=>({...k,[O]:(k[O]||0)+1}),{});n.value=Object.entries(_).flatMap(k=>({address:k[0],amount:k[1]}))}function u(b,m){const i=16+32*m,d=i+32,_=b.slice(i,d);return new x(_)}he(async()=>{await a(),await r()});const{_updateCount:f}=_t(T());F(f,async()=>{await a()});function g(){var b;return o.raffle.account.url?o.raffle.account.url:(console.log(q().token_list.find(m=>m.address===o.raffle.account.prizeMint.toString())),((b=q().token_list.find(m=>m.address===o.raffle.account.prizeMint.toString()))==null?void 0:b.logoURI)??"snb_icon.svg")}return(b,m)=>(v(),h(me,{square:"",flat:""},{default:s(()=>[t(at,{height:"200px",src:g()},null,8,["src"]),t(M,null,{default:s(()=>[t(ra,{raffle:e.raffle,tickets:c.value},null,8,["raffle","tickets"]),w("div",Ia,W(e.raffle.account.name),1),w("div",Aa,W(e.raffle.account.description),1)]),_:1}),t(ne),t(M,null,{default:s(()=>[t(Tt,null,{default:s(()=>[t(G,{clickable:""},{default:s(()=>[t(E,{avatar:""},{default:s(()=>[t(ae,{color:"primary",name:"functions"})]),_:1}),t(E,null,{default:s(()=>[t(Q,{class:"text-h6"},{default:s(()=>{var i;return[A(W((i=c.value)==null?void 0:i.total),1)]}),_:1}),t(Q,{class:"text-orange-9",caption:""},{default:s(()=>[A("Total tickets")]),_:1})]),_:1})]),_:1}),t(G,{clickable:""},{default:s(()=>[t(E,{avatar:""},{default:s(()=>[t(ae,{color:"red",name:"paid"})]),_:1}),t(E,null,{default:s(()=>[t(Q,{class:"text-h6"},{default:s(()=>[A(W((e.raffle.account.ticketPrice.toNumber()*Math.pow(10,-e.raffle.account.ticketDecimals)).toFixed(2)),1)]),_:1}),t(Q,{class:"text-orange-9",caption:""},{default:s(()=>[A("Price per ticket")]),_:1})]),_:1})]),_:1}),t(G,{clickable:""},{default:s(()=>[t(E,{avatar:""},{default:s(()=>[t(ae,{color:"amber",name:"local_movies"})]),_:1}),t(E,null,{default:s(()=>[t(Q,{class:"text-overline"},{default:s(()=>[A(W(P(q)().token_list.find(i=>i.address==e.raffle.account.ticketMint)?P(q)().token_list.find(i=>i.address==e.raffle.account.ticketMint).symbol:e.raffle.account.ticketMint),1)]),_:1}),t(Q,{class:"text-orange-9",caption:""},{default:s(()=>[A("Ticket-Mint")]),_:1}),t(Q,{class:"q-pt-md text-overline"},{default:s(()=>{var i;return[A(W((i=P(q)().token_list.find(d=>d.address==e.raffle.account.prizeMint))==null?void 0:i.name)+" "+W(P(q)().token_list.find(d=>d.address==e.raffle.account.prizeMint)?P(q)().token_list.find(d=>d.address==e.raffle.account.prizeMint).symbol:e.raffle.account.prizeMint),1)]}),_:1}),t(Q,{class:"text-orange-9",caption:""},{default:s(()=>[A("Prize-Mint")]),_:1})]),_:1})]),_:1}),e.raffle.account.randomness!=null?(v(),h(G,{key:0,clickable:""},{default:s(()=>[t(E,{avatar:""},{default:s(()=>{var i,d;return[t(ba,{style:{width:"100px"},seed:(d=(i=e.raffle.account)==null?void 0:i.winner)==null?void 0:d.toString()},null,8,["seed"])]}),_:1}),t(E,null,{default:s(()=>[t(Q,{class:"text-h6",l:""},{default:s(()=>[A("Winner")]),_:1}),t(Q,{class:"text-orange-9",caption:""},{default:s(()=>{var i;return[A(W(b.format_address((i=e.raffle.account.winner)==null?void 0:i.toString())),1)]}),_:1})]),_:1})]),_:1})):$("",!0)]),_:1})]),_:1}),t(ne),t(Dt,{icon:"info",label:"Details"},{default:s(()=>[t(me,{flat:""},{default:s(()=>[t(M,null,{default:s(()=>[t(ma,{accounts:l.value},null,8,["accounts"])]),_:1}),t(M,null,{default:s(()=>[t(ha,{entrants:n.value},null,8,["entrants"])]),_:1}),t(M,null,{default:s(()=>[t(Ta,{raffle:e.raffle,entrants:n.value,class:"q-pb-md"},null,8,["raffle","entrants"])]),_:1})]),_:1})]),_:1}),t(ne),e.is_admin?(v(),h(M,{key:0},{default:s(()=>[Object.keys(e.raffle.account.state)[0]=="created"?(v(),h(Yt,{key:0,raffle:e.raffle},null,8,["raffle"])):$("",!0)]),_:1})):$("",!0),Object.keys(e.raffle.account.state)[0]=="running"&&!e.is_admin?(v(),h(st,{key:1},{default:s(()=>[t(aa,{raffle:e.raffle,tickets:c.value},null,8,["raffle","tickets"])]),_:1})):$("",!0),e.is_admin?(v(),h(M,{key:2,class:"col"},{default:s(()=>[$a,w("div",qa,[Object.keys(e.raffle.account.state)[0]=="full"?(v(),h(sa,{key:0,raffle:e.raffle},null,8,["raffle"])):$("",!0),Object.keys(e.raffle.account.state)[0]=="claimprize"||Object.keys(e.raffle.account.state)[0]=="ready"?(v(),h(ca,{key:1,raffle:e.raffle},null,8,["raffle"])):$("",!0),Object.keys(e.raffle.account.state)[0]=="claimtickets"?(v(),h(fa,{key:2,raffle:e.raffle},null,8,["raffle"])):$("",!0),Object.keys(e.raffle.account.state)[0]=="ready"||Object.keys(e.raffle.account.state)[0]=="running"||Object.keys(e.raffle.account.state)[0]=="paused"?(v(),h(Pa,{key:3,raffle:e.raffle},null,8,["raffle"])):$("",!0),Object.keys(e.raffle.account.state)[0]=="created"||Object.keys(e.raffle.account.state)[0]=="done"?(v(),h(da,{key:4,raffle:e.raffle},null,8,["raffle"])):$("",!0)])]),_:1})):$("",!0)]),_:1}))}}),Oa={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},Ne=C({__name:"RaffleGrid",props:{is_admin:{type:Boolean,default:!1},raffles:{type:[],default:[]},count:{type:Number,default:0}},setup(e){const o=e,c=R(()=>Re().screen.gt.xs?"example-masonry-table-grid example-masonry-table-grid--"+(Re().screen.gt.sm?"3":"2"):null),l=R(()=>[0]),a=y({rowsPerPage:0});return(n,r)=>(v(),h(Ae,{grid:"","card-container-class":c.value,rows:o.raffles,"row-key":"name",filter:n.filter,"hide-header":"",pagination:a.value,"onUpdate:pagination":r[0]||(r[0]=u=>a.value=u),"rows-per-page-options":l.value},{item:s(u=>[w("div",Oa,[t(Ca,{is_admin:e.is_admin,raffle:u.row},null,8,["is_admin","raffle"])])]),_:1},8,["card-container-class","rows","filter","pagination","rows-per-page-options"]))}}),Ra=w("p",{class:"text-h5"},"Raffle",-1),Ba=w("p",{class:"text-h5"},"Tickets",-1),Va={class:"row justify-center"},Ea=w("p",{class:"text-h5"},"Whitelist",-1),Ma={class:"col q-gutter-y-sm"},La=C({__name:"RaffleCreateRaffle",setup(e){const o=y(),c=y(),l=y(),a=y(),n=y(),r=y(),u=y([]);he(()=>f()),F(()=>Be().whitelists,()=>f());function f(){Be().whitelists.forEach(i=>{u.value.push({label:"Crew",value:i.publicKey.toString()})}),u.value.push({label:"none",value:null}),r.value=u.value.find(i=>i.label=="Crew")}async function g(){var oe,B,se,N;const i=(oe=z())==null?void 0:oe.pg_raffle.value,d=(B=z())==null?void 0:B.pg_whitelist.value,_=new _e(window.crypto.getRandomValues(new Uint8Array(8)));let[k,O]=x.findProgramAddressSync([U("raffle"),U(o.value),_.toArrayLike(bt.Buffer).reverse()],i==null?void 0:i.programId),[K,ce]=x.findProgramAddressSync([Xe.toBuffer(),U((se=r.value)==null?void 0:se.label)],d==null?void 0:d.programId);const ue=await D().connection.getParsedAccountInfo(new x(n.value.value));try{const H=await(i==null?void 0:i.methods.initialize(o.value,c.value,new _e(a.value*Math.pow(10,(N=ue.value)==null?void 0:N.data.parsed.info.decimals)),l.value,_).accountsPartial({creator:S().publicKey.value,raffle:k,ticketsMint:new x(n.value.value),whitelist:K}).rpc());console.log(H),await X(H)&&(await T().update_raffles(),await T().send_discord_webhook(ht.RAFFLE_CREATE,o.value,c.value,l.value,a.value))}catch(H){Z.create({color:"red",message:`${H}`,timeout:5e3})}}const b=y([]);return y(le().token_accounts.filter(i=>i.account.data.parsed.info.tokenAmount.uiAmount>0).flatMap(i=>i.account.data.parsed.info.mint)).value.forEach(i=>{var _,k;const d=((_=q().token_list.find(O=>O.address==i))==null?void 0:_.name)??i+" ["+((k=q().token_list.find(O=>O.address==i))==null?void 0:k.symbol)??"]";b.value.push({label:d,value:i})}),(i,d)=>(v(),h(me,{square:"",flat:"",class:"col q-pa-sm",style:{"max-width":"800px"}},{default:s(()=>[t(M,{class:"q-gutter-y-md"},{default:s(()=>[Ra,t(re,{filled:"",square:"",modelValue:o.value,"onUpdate:modelValue":d[0]||(d[0]=_=>o.value=_),type:"text",label:"Name"},null,8,["modelValue"]),t(re,{filled:"",square:"",modelValue:c.value,"onUpdate:modelValue":d[1]||(d[1]=_=>c.value=_),type:"text",label:"Description"},null,8,["modelValue"])]),_:1}),t(ne),t(M,{class:"q-gutter-y-md"},{default:s(()=>[Ba,w("div",Va,[t(Pe,{class:"col",filled:"",square:"",modelValue:n.value,"onUpdate:modelValue":d[2]||(d[2]=_=>n.value=_),clearable:"","use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",behavior:"menu",label:"Select Ticket by mint",options:b.value,style:{width:"250px"}},{"no-option":s(()=>[t(G,null,{default:s(()=>[t(E,{class:"text-grey"},{default:s(()=>[A(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"]),t(L,{icon:"refresh",color:"primary",square:"",onClick:d[3]||(d[3]=_=>P(le)().update_accounts())})]),t(re,{filled:"",square:"",modelValue:l.value,"onUpdate:modelValue":d[4]||(d[4]=_=>l.value=_),type:"number",label:"Tickets"},null,8,["modelValue"]),t(re,{filled:"",square:"",type:"number",modelValue:a.value,"onUpdate:modelValue":d[5]||(d[5]=_=>a.value=_),label:"Ticket Price"},null,8,["modelValue"])]),_:1}),t(M,{class:"q-gutter-y-md"},{default:s(()=>[Ea,w("div",Ma,[t(Pe,{class:"full-width",filled:"",square:"",modelValue:r.value,"onUpdate:modelValue":d[6]||(d[6]=_=>r.value=_),clearable:"","use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",behavior:"menu",label:"Whitelist selcted",options:u.value,style:{width:"250px"}},{"no-option":s(()=>[t(G,null,{default:s(()=>[t(E,{class:"text-grey"},{default:s(()=>[A(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])])]),_:1}),t(ne),t(M,{class:"row justify-end"},{default:s(()=>[t(L,{icon:"send",class:"row",color:"primary",onClick:d[7]||(d[7]=_=>g()),label:"Create"})]),_:1})]),_:1}))}}),Ka={class:"row shadow-2"},Qa={key:0,class:"row"},za={key:1,class:"q-mx-md"},ja={key:1,class:"row justify-center"},on=C({__name:"RafflePage",setup(e){const o=y("raffle");he(async()=>{await le().update_accounts(),T().raffles.length||await T().update_raffles()}),ye(()=>{clearInterval(c.value)}),F(()=>S().publicKey.value,async()=>{await le().update_accounts(),await T().update_raffles()});const c=y();return(l,a)=>P(S)().publicKey.value?(v(),h(qe,{key:1,class:"col"},{default:s(()=>[w("div",Ka,[t(ut,{modelValue:o.value,"onUpdate:modelValue":a[0]||(a[0]=n=>o.value=n),"no-caps":"","outside-arrows":"","mobile-arrows":"",class:"col bg-dark"},{default:s(()=>[t(Te,{name:"raffle",label:"Raffle"}),P(q)().is_admin?(v(),h(Te,{key:0,name:"create",label:"Create"})):$("",!0),P(q)().is_admin?(v(),h(Te,{key:1,name:"manage",label:"Manage"})):$("",!0)]),_:1},8,["modelValue"]),t(L,{flat:"",class:"bg-dark",icon:"refresh",onClick:a[1]||(a[1]=n=>P(T)().update_raffles().then(()=>{}))})]),P(T)().is_loading?(v(),Y("div",Qa,[t(be),t(St,{class:"row",color:"primary",size:"10rem"}),t(be)])):$("",!0),P(T)().raffles&&!P(T)().is_loading?(v(),Y("div",za,[o.value==="raffle"?(v(),h(Ne,{key:0,raffles:P(T)().get_running_raffles,is_admin:!1},null,8,["raffles"])):$("",!0),o.value==="create"?(v(),Y("div",ja,[t(La,{class:"q-mt-xl"})])):$("",!0),o.value==="manage"?(v(),h(Ne,{key:2,raffles:P(T)().raffles,is_admin:P(q)().is_admin},null,8,["raffles","is_admin"])):$("",!0)])):$("",!0)]),_:1})):(v(),h(qe,{key:0,class:"row items-center justify-center bg-image"},{default:s(()=>[t(P(kt),{dark:""})]),_:1}))}});export{on as default};
