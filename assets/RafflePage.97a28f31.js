import{a as ie,Q as ot}from"./QTabs.d83651d4.js";import{aF as T,bZ as me,dj as rt,dk as it,dl as ct,de as R,au as S,J as v,b1 as g,ak as U,al as y,as as t,cl as Q,cQ as K,P as w,co as L,cS as A,cr as N,dm as pe,cU as W,ah as I,bs as ae,aT as xe,cc as Se,c7 as Te,bC as ut,aC as Me,b_ as ze,cd as ft,a1 as V,V as x,cP as fe,ar as P,bx as i,aX as le,bz as dt,a6 as Ie,cY as G,dn as mt,ai as k,dp as pt,cZ as gt,c_ as ge,b9 as vt,aj as b,dq as yt,cn as X,dr as ce,cR as ue,cq as te}from"./index.b0a38399.js";import{Q as ne}from"./QSpace.9d0d76b7.js";import{Q as kt}from"./QPage.e5b99808.js";import{f as Be,Q as _t,a as ve,b as ht,c as bt}from"./calcAmountToTransfer.ed42678b.js";import{Q as je}from"./QImg.bc5a6c9d.js";import{Q as q}from"./QCardSection.e589723b.js";import{Q as D}from"./QSeparator.1abe5adc.js";import{x as wt,u as xt,l as St,y as Ae,z as Tt,e as At,m as Pt,A as $t,B as Ct,f as qt,n as Rt,C as Pe,D as Qt,c as $e,g as Ot,E as Ce,F as Vt,Q as J,i as E,j as z}from"./QMenu.068c630c.js";import{Q as Mt}from"./QList.c2991f8e.js";import{Q as ee,u as zt,a as It}from"./QCard.d17163be.js";import{Q as Ee}from"./QCardActions.88921ff9.js";import{Q as F}from"./QInput.90b3701c.js";import{h as B}from"./handleTransaction.c1227c9c.js";import{_ as De,c as Ue}from"./TokenSelectDropdown.0b6fcba6.js";import{a as Bt,u as jt}from"./rtl.739636a7.js";import{c as Et,Q as Dt}from"./QSelect.9075d8ef.js";import{C as Ut}from"./ClosePopup.208d76b3.js";import{Q as qe}from"./QBadge.e49d1ed2.js";import{t as Ne}from"./token.4b9a6fc0.js";import{g as Le}from"./extensionType.6a048882.js";import{f as de}from"./format_address.d3022ffc.js";import{_ as Nt}from"./plugin-vue_export-helper.21dcd24c.js";import"./uid.42677368.js";import"./QSlideTransition.9f2b3878.js";import"./use-checkbox.3f2471cb.js";import"./use-form.ef812b45.js";import"./use-key-composition.5f186173.js";import"./vaultTransactionCreate.040d622d.js";import"./errors.825970a3.js";import"./web3.bcbf98fa.js";import"./bigint.a75a84d6.js";const Lt=[T("rect",{x:"0",y:"0",width:"100",height:"100",fill:"none"}),T("g",{transform:"translate(25 25)"},[T("rect",{x:"-20",y:"-20",width:"40",height:"40",fill:"currentColor",opacity:"0.9"},[T("animateTransform",{attributeName:"transform",type:"scale",from:"1.5",to:"1",repeatCount:"indefinite",begin:"0s",dur:"1s",calcMode:"spline",keySplines:"0.2 0.8 0.2 0.8",keyTimes:"0;1"})])]),T("g",{transform:"translate(75 25)"},[T("rect",{x:"-20",y:"-20",width:"40",height:"40",fill:"currentColor",opacity:"0.8"},[T("animateTransform",{attributeName:"transform",type:"scale",from:"1.5",to:"1",repeatCount:"indefinite",begin:"0.1s",dur:"1s",calcMode:"spline",keySplines:"0.2 0.8 0.2 0.8",keyTimes:"0;1"})])]),T("g",{transform:"translate(25 75)"},[T("rect",{x:"-20",y:"-20",width:"40",height:"40",fill:"currentColor",opacity:"0.7"},[T("animateTransform",{attributeName:"transform",type:"scale",from:"1.5",to:"1",repeatCount:"indefinite",begin:"0.3s",dur:"1s",calcMode:"spline",keySplines:"0.2 0.8 0.2 0.8",keyTimes:"0;1"})])]),T("g",{transform:"translate(75 75)"},[T("rect",{x:"-20",y:"-20",width:"40",height:"40",fill:"currentColor",opacity:"0.6"},[T("animateTransform",{attributeName:"transform",type:"scale",from:"1.5",to:"1",repeatCount:"indefinite",begin:"0.2s",dur:"1s",calcMode:"spline",keySplines:"0.2 0.8 0.2 0.8",keyTimes:"0;1"})])])];var Kt=me({name:"QSpinnerCube",props:rt,setup(e){const{cSize:a,classes:r}=it(e);return()=>T("svg",{class:r.value,width:a.value,height:a.value,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid"},Lt)}});const $=ct("raffleStore",{state:()=>({raffles:[]}),getters:{getRunningRaffles(e){return e.raffles.filter(a=>Object.keys(a.account.state)[0]=="running"||Object.keys(a.account.state)[0]=="full"||Object.keys(a.account.state)[0]=="claimprize")}},actions:{async updateStore(){if(R())try{const e=R().pg_raffle.value;this.raffles=await(e==null?void 0:e.account.raffle.all()),console.log("[Updated] RaffleStore")}catch(e){console.error(e)}}}}),Wt={class:"col q-pa-sm"},Ht=y("p",{class:"text-overline"},"Add a prize:",-1),Ft={class:"col q-gutter-y-sm"},Gt={class:"row"},Yt=S({__name:"RafflePrepare",props:["raffle"],setup(e){const a=v(1),r=v(""),o=v(""),n=e;v([]);async function l(){var s,c,m,d;try{const u=new K,f=(s=R())==null?void 0:s.pg_raffle.value,p=new w(o.value.mint),_=(await L().connection.getParsedTokenAccountsByOwner(A(),{mint:p})).value[0].pubkey,O=new w(n.raffle.publicKey.toString()),h=await L().connection.getParsedAccountInfo(p);console.log((c=h.value)==null?void 0:c.data.parsed.info.decimals),r.value=((m=N().token_list.find(M=>M.address==p))==null?void 0:m.logoURI)??"",u.add(await(f==null?void 0:f.methods.prepare(new pe(a.value*Math.pow(10,(d=h.value)==null?void 0:d.data.parsed.info.decimals)),r.value).accountsPartial({creator:A(),raffle:O,from:_,prizeMint:p}).instruction())),await B(u,"[Raffle] prepare"),await $().updateStore()}catch(u){W.create({color:"red",message:`${u}`,timeout:5e3})}}return(s,c)=>(g(),U("div",Wt,[Ht,y("div",Ft,[t(De,{label:"","textbox-label":"Select prize",onToken_account_selected:c[0]||(c[0]=m=>o.value=m)}),y("div",Gt,[t(F,{class:"col",filled:"",square:"",modelValue:a.value,"onUpdate:modelValue":c[1]||(c[1]=m=>a.value=m),type:"number",label:"Count"},null,8,["modelValue"]),t(Q,{filled:"",square:"",class:"col-2",color:"primary",icon:"send",onClick:c[2]||(c[2]=m=>l())})])])]))}});var Zt=me({name:"QTooltip",inheritAttrs:!1,props:{...wt,...xt,...St,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{default:"jump-down"},transitionHide:{default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:Ae},self:{type:String,default:"top middle",validator:Ae},offset:{type:Array,default:()=>[14,14],validator:Tt},scrollTarget:{default:void 0},delay:{type:Number,default:0},hideDelay:{type:Number,default:0}},emits:[...At],setup(e,{slots:a,emit:r,attrs:o}){let n,l;const s=Me(),{proxy:{$q:c}}=s,m=v(null),d=v(!1),u=I(()=>Ce(e.anchor,c.lang.rtl)),f=I(()=>Ce(e.self,c.lang.rtl)),p=I(()=>e.persistent!==!0),{registerTick:_,removeTick:O}=Bt(),{registerTimeout:h}=jt(),{transitionProps:M,transitionStyle:He}=Pt(e),{localScrollTarget:ye,changeScrollEvent:Fe,unconfigureScrollTarget:Ge}=$t(e,be),{anchorEl:j,canShow:Ye,anchorEvents:Y}=Ct({showing:d,configureAnchorEl:nt}),{show:Ze,hide:oe}=qt({showing:d,canShow:Ye,handleShow:Xe,handleHide:et,hideOnRouteChange:p,processOnMount:!0});Object.assign(Y,{delayShow:tt,delayHide:at});const{showPortal:ke,hidePortal:_e,renderPortal:Je}=Rt(s,m,st,"tooltip");if(c.platform.is.mobile===!0){const C={anchorEl:j,innerRef:m,onClickOutside(H){return oe(H),H.target.classList.contains("q-dialog__backdrop")&&ft(H),!0}},re=I(()=>e.modelValue===null&&e.persistent!==!0&&d.value===!0);ae(re,H=>{(H===!0?Vt:Pe)(C)}),xe(()=>{Pe(C)})}function Xe(C){ke(),_(()=>{l=new MutationObserver(()=>Z()),l.observe(m.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),Z(),be()}),n===void 0&&(n=ae(()=>c.screen.width+"|"+c.screen.height+"|"+e.self+"|"+e.anchor+"|"+c.lang.rtl,Z)),h(()=>{ke(!0),r("show",C)},e.transitionDuration)}function et(C){O(),_e(),he(),h(()=>{_e(!0),r("hide",C)},e.transitionDuration)}function he(){l!==void 0&&(l.disconnect(),l=void 0),n!==void 0&&(n(),n=void 0),Ge(),Se(Y,"tooltipTemp")}function Z(){Qt({targetEl:m.value,offset:e.offset,anchorEl:j.value,anchorOrigin:u.value,selfOrigin:f.value,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function tt(C){if(c.platform.is.mobile===!0){$e(),document.body.classList.add("non-selectable");const re=j.value,H=["touchmove","touchcancel","touchend","click"].map(we=>[re,we,"delayHide","passiveCapture"]);Te(Y,"tooltipTemp",H)}h(()=>{Ze(C)},e.delay)}function at(C){c.platform.is.mobile===!0&&(Se(Y,"tooltipTemp"),$e(),setTimeout(()=>{document.body.classList.remove("non-selectable")},10)),h(()=>{oe(C)},e.hideDelay)}function nt(){if(e.noParentEvent===!0||j.value===null)return;const C=c.platform.is.mobile===!0?[[j.value,"touchstart","delayShow","passive"]]:[[j.value,"mouseenter","delayShow","passive"],[j.value,"mouseleave","delayHide","passive"]];Te(Y,"anchor",C)}function be(){if(j.value!==null||e.scrollTarget!==void 0){ye.value=Ot(j.value,e.scrollTarget);const C=e.noParentEvent===!0?Z:oe;Fe(ye.value,C)}}function lt(){return d.value===!0?T("div",{...o,ref:m,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",o.class],style:[o.style,He.value],role:"tooltip"},ze(a.default)):null}function st(){return T(ut,M.value,lt)}return xe(he),Object.assign(s.proxy,{updatePosition:Z}),Je}});const Jt={class:"col q-pa-sm q-gutter-y-sm"},Xt=y("p",{class:"text-overline"},"Buy Ticket(s)",-1),ea={class:"row"},ta={class:"row"},aa={class:"col row q-gutter-x-xs text-weight-light"},na=y("p",null,"Available:",-1),la={class:"text-caption text-right text-weight-thin"},sa=S({__name:"RaffleBuyTicket",props:["raffle","tickets"],setup(e){const a=v(),r=e;async function o(){var f,p,_;const n=new K,l=(f=R())==null?void 0:f.pg_raffle.value,s=(p=R())==null?void 0:p.pg_whitelist.value,c=new w(r.raffle.account.ticketMint.toString()),m=(await L().connection.getParsedTokenAccountsByOwner(A(),{mint:c})).value[0].pubkey,d=new w(r.raffle.publicKey.toString());let u=Be();try{n.add(await(l==null?void 0:l.methods.buyTickets(new pe(a.value)).accountsPartial({signer:A(),raffle:d,entrant:A(),ticketsMint:c,from:m,whitelist:u,whitelistEntry:w.findProgramAddressSync([(_=A())==null?void 0:_.toBytes(),u.toBytes()],s==null?void 0:s.programId)[0],whitelistProgram:s==null?void 0:s.programId}).instruction())),await B(n,"[Raffle] buy ticket"),await $().updateStore()}catch(O){W.create({color:"danger",message:`${O}`,timeout:5e3})}}return(n,l)=>{var s,c,m,d;return g(),U("div",Jt,[Xt,y("div",ea,[t(F,{square:"",filled:"",outlined:"",type:"number",class:"col",label:"Amount",modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=u=>a.value=u)},null,8,["modelValue"]),t(Q,{square:"",disable:!a.value,color:"primary",icon:"send",onClick:l[1]||(l[1]=u=>o())},null,8,["disable"])]),y("div",ta,[y("div",aa,[na,y("p",null,V((c=(s=x(fe)().accounts)==null?void 0:s.find(u=>u.mint==e.raffle.account.ticketMint.toString()))==null?void 0:c.uiAmount),1),y("p",null,V((d=(m=x(fe)().accounts)==null?void 0:m.find(u=>u.mint==e.raffle.account.ticketMint.toString()))==null?void 0:d.info.symbol),1)]),y("p",la,[P(" 0.001\u25CE fee "),t(Zt,{anchor:"bottom right",self:"top middle"},{default:i(()=>[P(" cover deployment costs ")]),_:1})])])])}}}),oa=y("source",{src:"Burningticket.mp4",type:"video/mp4"},null,-1),ra=S({__name:"BurningTicket",setup(e){const a=v();return le(()=>{a.value.playbackRate=.3,console.log(a.value)}),(r,o)=>(g(),U("video",{ref_key:"ticket_burning",ref:a,autoplay:"",playbackspeed:"0.1"},[oa,P(" Your browser does not support the video tag. ")],512))}}),ia=y("div",{class:"text-h6 text-center"},"Drawing...",-1),ca=S({__name:"RaffleRevealWinner",props:["raffle","is_admin"],setup(e){v();const a=e,r=v(!1);ae(()=>r.value,()=>{r.value==!1&&$().updateStore()});async function o(){var n;try{const l=new K,s=(n=R())==null?void 0:n.pg_raffle.value,c=new w(a.raffle.publicKey.toString());let[m,d]=w.findProgramAddressSync([G("tickets"),c.toBytes()],s==null?void 0:s.programId);l.add(await(s==null?void 0:s.methods.revealWinners().accounts({raffle:c,tickets:m,recentBlockHashes:mt}).instruction())),await B(l,"[Raffle] reveal winner"),r.value=!0}catch(l){W.create({color:"red",message:`${l}`,timeout:5e3})}}return(n,l)=>(g(),U(Ie,null,[t(Q,{square:"",class:"row",color:"primary",icon:"send",label:"Reveal Winner",onClick:l[0]||(l[0]=s=>o())}),t(Et,{maximized:!0,modelValue:r.value,"onUpdate:modelValue":l[2]||(l[2]=s=>r.value=s)},{default:i(()=>[t(ee,{flat:"",square:"",class:""},{default:i(()=>[t(q,null,{default:i(()=>[ia]),_:1}),t(q,{class:"q-pt-none row"},{default:i(()=>[t(ne),t(ra),t(ne)]),_:1}),t(Ee,{align:"right"},{default:i(()=>[dt(t(Q,{flat:"",label:"close",color:"primary",onClick:l[1]||(l[1]=s=>x($)().update_raffles())},null,512),[[Ut]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),ua={class:"absolute-full flex flex-center"};var Ke=(e=>(e.created="orange",e.ready="orange",e.paused="pink",e.full="purple",e.claimprize="purple",e.claimtickets="purple",e.running="primary",e))(Ke||{});const fa=S({__name:"RaffleStateBadge",props:["raffle","tickets"],setup(e){const a=e,r=I(()=>{var o,n;return((o=a.tickets)==null?void 0:o.sold)/((n=a.tickets)==null?void 0:n.total)});return(o,n)=>Object.keys(e.raffle.account.state)[0]=="running"?(g(),k(_t,{key:0,size:"25px",value:r.value,color:"primary"},{default:i(()=>{var l,s;return[y("div",ua,[t(qe,{color:"black","text-color":"primary",label:`Tickets: ${(l=e.tickets)==null?void 0:l.sold}/${(s=e.tickets)==null?void 0:s.total}`},null,8,["label"])])]}),_:1},8,["value"])):(g(),k(qe,{key:1,color:Ke[Object.keys(e.raffle.account.state)[0]],class:"text-h6 justify-center full-width"},{default:i(()=>[P(V(Object.keys(e.raffle.account.state)[0].toUpperCase()),1)]),_:1},8,["color"]))}}),se=new w(pt.address);function da(e,a){return w.findProgramAddressSync([G("raffle"),G(e),a.toArrayLike(gt.Buffer).reverse()],se)[0]}function ma(e){return w.findProgramAddressSync([G("tickets"),e.toBytes()],se)[0]}function We(e){return w.findProgramAddressSync([G("vaultPrize"),e.toBytes()],se)[0]}function pa(e){return w.findProgramAddressSync([G("vaultTickets"),e.toBytes()],se)[0]}const ga=S({__name:"RaffleClaimPrize",props:["raffle","is_admin"],setup(e){const a=e;async function r(){var o;try{let n=new K;const l=(o=R())==null?void 0:o.pg_raffle.value,s=new w(a.raffle.account.prizeMint.toString()),c=new w(a.raffle.account.winner.toString()),m=await Le(s,c,!0,ge,Ne.ASSOCIATED_PROGRAM_ID);await L().connection.getAccountInfo(m)===null&&n.add(Ue(A(),m,c,s));const d=new w(a.raffle.publicKey.toString()),u=We(d);n.add(await(l==null?void 0:l.methods.claimPrize().accountsPartial({raffle:d,prizeMint:s,prizeVault:u,to:m}).instruction())),await B(n,"[Raffle] Claim Prize"),await $().updateStore()}catch(n){W.create({color:"red",message:`${n}`,timeout:5e3,position:"bottom-right"})}}return(o,n)=>(g(),k(Q,{color:"primary",icon:"send",label:"Claim Prize",onClick:n[0]||(n[0]=l=>r())}))}});async function va(e){try{return!!await L().connection.getAccountInfo(e)}catch(a){return console.error("Error checking account:",a),!1}}const ya=S({__name:"RaffleClose",props:["raffle"],setup(e){const a=e;async function r(){var o;try{const n=new K,l=(o=R())==null?void 0:o.pg_raffle.value;let s=a.raffle.publicKey;const c=ma(s),m=pa(s);let d=We(s);await va(d)||(d=null),n.add(await(l==null?void 0:l.methods.close().accountsPartial({creator:A(),raffle:s,tickets:c,ticketsVault:m,prizeVault:d}).instruction())),await B(n,"[Raffle] close"),await $().updateStore()}catch(n){W.create({color:"red",message:`${n}`,timeout:5e3})}}return(o,n)=>(g(),k(Q,{square:"",color:"primary",icon:"send",label:"Close Raffle",onClick:n[0]||(n[0]=l=>r())}))}}),ka=S({__name:"RaffleClaimTickets",props:["raffle","is_admin"],setup(e){const a=e;async function r(){var o;try{const n=new K,l=(o=R())==null?void 0:o.pg_raffle.value,s=new w(a.raffle.account.ticketMint.toString()),c=await Le(s,A(),!0,ge,Ne.ASSOCIATED_PROGRAM_ID);await L().connection.getAccountInfo(c)===null&&n.add(Ue(A(),c,A(),s)),n.add(await(l==null?void 0:l.methods.claimTickets().accountsPartial({creator:A(),raffle:a.raffle.publicKey,ticketsMint:s,to:c}).instruction())),await B(n,"[Raffle Claim Tickets]"),await $().updateStore()}catch(n){W.create({color:"red",message:`${n}`,timeout:5e3,position:"bottom-right"})}}return(o,n)=>(g(),k(Q,{color:"primary",icon:"send",label:"Claim Tickets",onClick:n[0]||(n[0]=l=>r())}))}}),_a=S({__name:"AccountsTable",props:["accounts"],setup(e){const a=v({rowsPerPage:0}),r=v([{name:"mint",required:!0,label:"Mint",align:"left",field:"mint",field:o=>{var n,l;return((n=N().token_list.find(s=>{var c;return s.address==((c=o.mint)==null?void 0:c.toString())}))==null?void 0:n.name)??((l=o.mint)==null?void 0:l.toString())},sortable:!0},{name:"calories",align:"right",label:"Amount",field:o=>o.tokenAmount.uiAmount,sortable:!0}]);return(o,n)=>{var l,s;return g(),k(ve,{square:"",dense:"",class:"col",title:"Accounts",rows:(s=(l=e.accounts)==null?void 0:l.value)==null?void 0:s.map(c=>c.account.data.parsed.info),columns:r.value,"row-key":"mint","hide-bottom":"",flat:"",pagination:a.value,"onUpdate:pagination":n[0]||(n[0]=c=>a.value=c),"rows-per-page-options":[0]},null,8,["rows","columns","pagination"])}}}),Re=9,ha=95,ba=45,Qe=5;function wa(e){return e.split("").reduce((a,r)=>(a^r.charCodeAt(0))*-Qe,Qe)>>>2}function xa(e="",a=ha,r=ba,o=wa){const n=o(e),l=n%Re*(360/Re);return[...Array(e?25:0)].reduce((s,c,m)=>n&1<<m%15?s+`<rect x="${m>14?7-~~(m/5):~~(m/5)}" y="${m%5}" width="1" height="1"/>`:s,`<svg viewBox="-1.5 -1.5 8 8" xmlns="http://www.w3.org/2000/svg" fill="hsl(${l} ${a}% ${r}%)">`)+"</svg>"}const Sa=["innerHTML"],Ta=S({__name:"IconFromSeed",props:{seed:{type:String,default:"default"}},setup(e){const r=v(xa(e.seed));return(o,n)=>(g(),U("div",{innerHTML:r.value},null,8,Sa))}}),Aa=["text","rect","circle","QBtn","QBadge","QChip","QToolbar","QCheckbox","QRadio","QToggle","QSlider","QRange","QInput","QAvatar"],Pa=["wave","pulse","pulse-x","pulse-y","fade","blink","none"];var $a=me({name:"QSkeleton",props:{...zt,tag:{type:String,default:"div"},type:{type:String,validator:e=>Aa.includes(e),default:"rect"},animation:{type:String,validator:e=>Pa.includes(e),default:"wave"},animationSpeed:{type:[String,Number],default:1500},square:Boolean,bordered:Boolean,size:String,width:String,height:String},setup(e,{slots:a}){const r=Me(),o=It(e,r.proxy.$q),n=I(()=>{const s=e.size!==void 0?[e.size,e.size]:[e.width,e.height];return{"--q-skeleton-speed":`${e.animationSpeed}ms`,width:s[0],height:s[1]}}),l=I(()=>`q-skeleton q-skeleton--${o.value===!0?"dark":"light"} q-skeleton--type-${e.type}`+(e.animation!=="none"?` q-skeleton--anim q-skeleton--anim-${e.animation}`:"")+(e.square===!0?" q-skeleton--square":"")+(e.bordered===!0?" q-skeleton--bordered":""));return()=>T(e.tag,{class:l.value,style:n.value},ze(a.default))}});const Ca=S({__name:"Apex_TicketsChart",props:["data_value","data_label"],setup(e){const a=e,r=I(()=>a.data_value?a.data_value:[44,55,41,17,15]),o=I(()=>a.data_label?{legend:{labels:{colors:"white"},position:"left"},theme:{palette:"palette3"},labels:a.data_label}:{labels:["Apple","Mango","Orange","Watermelon"]});return(n,l)=>{const s=vt("apexchart");return e.data_value&&e.data_label?(g(),k(s,{key:0,height:"200px",type:"donut",options:o.value,series:r.value},null,8,["options","series"])):b("",!0)}}}),qa=S({__name:"TicketsTable",props:["entrants"],setup(e){const a=e,r=v({rowsPerPage:0});v();const o=v([{name:"wallet",required:!0,label:"Wallet",align:"left",field:m=>de(m.address),sortable:!0},{name:"amount",align:"right",label:"Amount",field:"amount",sortable:!0}]),n=v(),l=v(),s=v(!0);le(async()=>{await c()}),ae(()=>a.entrants,async()=>{await c()});async function c(){var d,u;n.value=(d=a.entrants)==null?void 0:d.map(f=>f.amount);const m=(u=a.entrants)==null?void 0:u.flatMap(f=>de(f.address));l.value=m,s.value=!1}return(m,d)=>(g(),U(Ie,null,[t(ve,{square:"",dense:"",class:"col",title:"Tickets",rows:e.entrants,columns:o.value,"row-key":"mint","hide-bottom":"",flat:"",pagination:r.value,"onUpdate:pagination":d[0]||(d[0]=u=>r.value=u),"rows-per-page-options":[0]},null,8,["rows","columns","pagination"]),s.value?(g(),k($a,{key:0,type:"QInput"})):b("",!0),t(Ca,{data_value:n.value,data_label:l.value},null,8,["data_value","data_label"])],64))}}),Ra={};function Qa(e,a){return g(),k(yt,{size:"xs"},{default:i(()=>[t(je,{src:"solscan.png"})]),_:1})}var Oe=Nt(Ra,[["render",Qa]]);const Oa=y("div",{class:"col q-gutter-y-sm"},[y("div",null,"Raffle account"),y("div",null,"Entrants account"),y("div",null,"Use Whitelist?")],-1),Va={class:"col q-gutter-y-sm"},Ma=S({__name:"RaffleLinks",props:["raffle","entrants"],setup(e){const a=e;return v({rowsPerPage:0}),(r,o)=>(g(),k(ee,{flat:"",square:"",class:"row items-center q-pa-md"},{default:i(()=>[Oa,y("div",Va,[t(Q,{class:"full-width",size:"xs",square:"",color:"primary",href:"https://solscan.io/account/"+a.raffle.publicKey,target:"_blank"},{default:i(()=>[t(Oe)]),_:1},8,["href"]),t(Q,{class:"full-width",square:"",size:"xs",color:"primary",href:"https://solscan.io/account/"+a.raffle.account.entrants,target:"_blank"},{default:i(()=>[t(Oe)]),_:1},8,["href"]),e.raffle.account.useWhitelist?(g(),k(X,{key:0,name:"check"})):(g(),k(X,{key:1,name:"clear"}))])]),_:1}))}}),za=S({__name:"RaffleToggleMode",props:["raffle"],setup(e){const a=e;async function r(){var o;try{const n=new K,l=(o=R())==null?void 0:o.pg_raffle.value;let s=await(l==null?void 0:l.account.raffle.fetch(a.raffle.publicKey));console.log(s),console.log(Object.keys(s.state)[0]);let c;switch(Object.keys(s.state)[0]){case"ready":n.add(await(l==null?void 0:l.methods.enable().accountsPartial({creator:A(),raffle:a.raffle.publicKey}).instruction())),await B(n,"[Raffle] enable");break;case"paused":n.add(await(l==null?void 0:l.methods.enable().accountsPartial({creator:A(),raffle:a.raffle.publicKey}).instruction())),await B(n,"[Raffle] enable");break;case"running":n.add(await(l==null?void 0:l.methods.disable().accountsPartial({creator:A(),raffle:a.raffle.publicKey}).instruction())),await B(n,"[Raffle] disable");break}await $().updateStore()}catch(n){W.create({color:"red",message:`${n}`,timeout:5e3})}}return(o,n)=>(g(),k(Q,{icon:"send",label:"Start/Pause",square:"",color:"primary",onClick:n[0]||(n[0]=l=>r())}))}}),Ia={class:"text-h5 q-mt-sm q-mb-xs"},Ba={class:"text-caption text-grey"},ja=y("p",{class:"text-overline"},"Actions",-1),Ea={class:"col row justify-end q-mx-sm"},Da=S({__name:"RaffleCard",props:["raffle","is_admin"],setup(e){const a=e,r=v(),o=v(),n=v();async function l(){const{pg_raffle:u}=R();r.value=await u.value.account.tickets.fetch(a.raffle.account.tickets),console.log(r.value)}async function s(){o.value=await L().connection.getParsedTokenAccountsByOwner(a.raffle.publicKey,{programId:ge})}async function c(){const{pg_raffle:u}=R(),f=await u.value.account.tickets.getAccountInfo(a.raffle.account.tickets);let p=[];for(let h=0;h<r.value.total;h++){let M=m(f.data,h);p.push(M)}const O=p.map(h=>h.toString()).reduce((h,M)=>({...h,[M]:(h[M]||0)+1}),{});n.value=Object.entries(O).flatMap(h=>({address:h[0],amount:h[1]}))}function m(u,f){const p=16+32*f,_=p+32,O=u.slice(p,_);return new w(O)}le(async()=>{await ce(l),await ce(s),await ce(c)});function d(){var u;return a.raffle.account.url?a.raffle.account.url:(console.log(N().token_list.find(f=>f.address===a.raffle.account.prizeMint.toString())),((u=N().token_list.find(f=>f.address===a.raffle.account.prizeMint.toString()))==null?void 0:u.logoURI)??"snb_icon.svg")}return(u,f)=>(g(),k(ee,{square:"",flat:""},{default:i(()=>[t(je,{height:"200px",src:d()},null,8,["src"]),t(q,null,{default:i(()=>[t(fa,{raffle:e.raffle,tickets:r.value},null,8,["raffle","tickets"]),y("div",Ia,V(e.raffle.account.name),1),y("div",Ba,V(e.raffle.account.description),1)]),_:1}),t(D),t(q,null,{default:i(()=>[t(Mt,null,{default:i(()=>[t(J,{clickable:""},{default:i(()=>[t(E,{avatar:""},{default:i(()=>[t(X,{color:"primary",name:"functions"})]),_:1}),t(E,null,{default:i(()=>[t(z,{class:"text-h6"},{default:i(()=>{var p;return[P(V((p=r.value)==null?void 0:p.total)+" Tickets",1)]}),_:1}),t(z,{class:"text-accent",caption:""},{default:i(()=>[P("Total tickets")]),_:1})]),_:1})]),_:1}),t(J,{clickable:""},{default:i(()=>[t(E,{avatar:""},{default:i(()=>[t(X,{color:"red",name:"paid"})]),_:1}),t(E,null,{default:i(()=>[t(z,{class:"text-h6"},{default:i(()=>{var p;return[P(V((e.raffle.account.ticketPrice.toNumber()*Math.pow(10,-e.raffle.account.ticketDecimals)).toFixed(2))+" "+V((p=x(ue)().tokenList.find(_=>_.address==e.raffle.account.ticketMint.toString()))==null?void 0:p.symbol),1)]}),_:1}),t(z,{class:"text-accent",caption:""},{default:i(()=>[P("Price per ticket")]),_:1})]),_:1})]),_:1}),t(J,{clickable:""},{default:i(()=>[t(E,{avatar:""},{default:i(()=>[t(X,{color:"amber",name:"local_movies"})]),_:1}),t(E,{class:"q-gutter-y-md"},{default:i(()=>[y("div",null,[t(z,{class:"q-pt-md text-overline"},{default:i(()=>{var p;return[P(V(((p=x(ue)().tokenList.find(_=>_.address==e.raffle.account.prizeMint.toString()))==null?void 0:p.name)??e.raffle.account.ticketMint.toString()),1)]}),_:1}),t(z,{class:"text-accent",caption:""},{default:i(()=>[P("Prize-Mint")]),_:1})]),y("div",null,[t(z,{class:"text-overline"},{default:i(()=>{var p;return[P(V(((p=x(ue)().tokenList.find(_=>_.address==e.raffle.account.ticketMint.toString()))==null?void 0:p.name)??e.raffle.account.ticketMint.toString()),1)]}),_:1}),t(z,{class:"text-accent",caption:""},{default:i(()=>[P("Ticket-Mint")]),_:1})])]),_:1})]),_:1}),e.raffle.account.randomness!=null?(g(),k(J,{key:0,clickable:""},{default:i(()=>[t(E,{avatar:""},{default:i(()=>{var p,_;return[t(Ta,{style:{width:"100px"},seed:(_=(p=e.raffle.account)==null?void 0:p.winner)==null?void 0:_.toString()},null,8,["seed"])]}),_:1}),t(E,null,{default:i(()=>[t(z,{class:"text-h6",l:""},{default:i(()=>[P("Winner")]),_:1}),t(z,{class:"text-orange-9",caption:""},{default:i(()=>{var p;return[P(V(x(de)((p=e.raffle.account.winner)==null?void 0:p.toString())),1)]}),_:1})]),_:1})]),_:1})):b("",!0)]),_:1})]),_:1}),t(D),t(ht,{icon:"info",label:"Details"},{default:i(()=>[t(ee,{flat:""},{default:i(()=>[t(D),t(q,null,{default:i(()=>[t(_a,{accounts:o.value},null,8,["accounts"])]),_:1}),t(D),t(q,null,{default:i(()=>[t(qa,{entrants:n.value},null,8,["entrants"])]),_:1}),t(D),t(q,null,{default:i(()=>[t(Ma,{raffle:e.raffle,entrants:n.value,class:"q-pb-md"},null,8,["raffle","entrants"])]),_:1})]),_:1})]),_:1}),t(D),e.is_admin?(g(),k(q,{key:0},{default:i(()=>[Object.keys(e.raffle.account.state)[0]=="created"?(g(),k(Yt,{key:0,raffle:e.raffle},null,8,["raffle"])):b("",!0)]),_:1})):b("",!0),Object.keys(e.raffle.account.state)[0]=="running"&&!e.is_admin?(g(),k(Ee,{key:1},{default:i(()=>[t(sa,{raffle:e.raffle,tickets:r.value},null,8,["raffle","tickets"])]),_:1})):b("",!0),e.is_admin?(g(),k(q,{key:2,class:"col"},{default:i(()=>[ja,y("div",Ea,[Object.keys(e.raffle.account.state)[0]=="full"?(g(),k(ca,{key:0,raffle:e.raffle},null,8,["raffle"])):b("",!0),Object.keys(e.raffle.account.state)[0]=="claimprize"||Object.keys(e.raffle.account.state)[0]=="ready"?(g(),k(ga,{key:1,raffle:e.raffle},null,8,["raffle"])):b("",!0),Object.keys(e.raffle.account.state)[0]=="claimtickets"?(g(),k(ka,{key:2,raffle:e.raffle},null,8,["raffle"])):b("",!0),Object.keys(e.raffle.account.state)[0]=="ready"||Object.keys(e.raffle.account.state)[0]=="running"||Object.keys(e.raffle.account.state)[0]=="paused"?(g(),k(za,{key:3,raffle:e.raffle},null,8,["raffle"])):b("",!0),Object.keys(e.raffle.account.state)[0]=="created"||Object.keys(e.raffle.account.state)[0]=="done"?(g(),k(ya,{key:4,raffle:e.raffle},null,8,["raffle"])):b("",!0)])]),_:1})):b("",!0)]),_:1}))}}),Ua={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},Ve=S({__name:"RaffleGrid",props:{is_admin:{type:Boolean,default:!1},raffles:{type:[],default:[]},count:{type:Number,default:0}},setup(e){const a=e,r=I(()=>[0]),o=v({rowsPerPage:0});return(n,l)=>(g(),k(ve,{grid:"",rows:a.raffles,"row-key":"name","hide-header":"",pagination:o.value,"onUpdate:pagination":l[0]||(l[0]=s=>o.value=s),"rows-per-page-options":r.value},{item:i(s=>[y("div",Ua,[t(Da,{is_admin:e.is_admin,raffle:s.row},null,8,["is_admin","raffle"])])]),_:1},8,["rows","pagination","rows-per-page-options"]))}}),Na=y("p",{class:"text-h5"},"Raffle",-1),La=y("p",{class:"text-h5"},"Tickets",-1),Ka={class:""},Wa=y("p",{class:"text-h5"},"Whitelist",-1),Ha={class:"col q-gutter-y-sm"},Fa=S({__name:"RaffleCreateRaffle",setup(e){const a=v(),r=v(),o=v(),n=v(),l=v();async function s(){var d,u;try{const f=new K,p=(d=R())==null?void 0:d.pg_raffle.value,_=new pe(window.crypto.getRandomValues(new Uint8Array(8))),O=da(a.value,_),h=Be(),M=await L().connection.getParsedAccountInfo(new w(l.value.mint));f.add(await(p==null?void 0:p.methods.initialize(a.value,r.value,bt(n.value,(u=M.value)==null?void 0:u.data.parsed.info.decimals),o.value,_).accountsPartial({creator:A(),raffle:O,ticketsMint:new w(l.value.mint),whitelist:te().whitelistSelected.publicKey}).instruction())),await B(f,"[Raffle] Create"),await $().updateStore()}catch(f){W.create({color:"red",message:`${f}`,timeout:5e3})}}const c=v([]);return v(fe().accounts.filter(d=>d.account.data.parsed.info.tokenAmount.uiAmount>0).flatMap(d=>d.account.data.parsed.info.mint)).value.forEach(d=>{var f,p;const u=((f=N().token_list.find(_=>_.address==d))==null?void 0:f.name)??d+" ["+((p=N().token_list.find(_=>_.address==d))==null?void 0:p.symbol)??"]";c.value.push({label:u,value:d})}),(d,u)=>(g(),k(ee,{square:"",flat:"",class:"col q-pa-sm",style:{"max-width":"800px"}},{default:i(()=>[t(q,{class:"q-gutter-y-md"},{default:i(()=>[Na,t(F,{filled:"",square:"",modelValue:a.value,"onUpdate:modelValue":u[0]||(u[0]=f=>a.value=f),type:"text",label:"Name"},null,8,["modelValue"]),t(F,{filled:"",square:"",modelValue:r.value,"onUpdate:modelValue":u[1]||(u[1]=f=>r.value=f),type:"text",label:"Description"},null,8,["modelValue"])]),_:1}),t(D),t(q,{class:"q-gutter-y-md"},{default:i(()=>[La,y("div",Ka,[t(De,{label:"","textbox-label":"Token",onToken_account_selected:u[2]||(u[2]=f=>l.value=f)})]),t(F,{filled:"",square:"",modelValue:o.value,"onUpdate:modelValue":u[3]||(u[3]=f=>o.value=f),type:"number",label:"Tickets Count"},null,8,["modelValue"]),t(F,{filled:"",square:"",type:"number",modelValue:n.value,"onUpdate:modelValue":u[4]||(u[4]=f=>n.value=f),label:"Ticket Price"},null,8,["modelValue"])]),_:1}),t(D),t(q,{class:"q-gutter-y-md"},{default:i(()=>[Wa,y("div",Ha,[t(Dt,{class:"full-width",filled:"",square:"",modelValue:x(te)().whitelistSelected,"onUpdate:modelValue":u[5]||(u[5]=f=>x(te)().whitelistSelected=f),clearable:"","use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",behavior:"menu","option-label":f=>f.account.name,label:"Whitelist selcted",options:x(te)().whitelists,style:{width:"250px"}},{"no-option":i(()=>[t(J,null,{default:i(()=>[t(E,{class:"text-grey"},{default:i(()=>[P(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","option-label","options"])])]),_:1}),t(D),t(q,{class:"row justify-end"},{default:i(()=>[t(Q,{icon:"send",square:"",class:"row",color:"primary",onClick:u[6]||(u[6]=f=>s()),label:"Create"})]),_:1})]),_:1}))}}),Ga={class:"row shadow-2"},Ya={key:0,class:"row"},Za={key:1,class:""},Ja={key:1,class:"row justify-center"},Qn=S({__name:"RafflePage",setup(e){const a=v("raffle");return le(async()=>{await $().updateStore()}),(r,o)=>(g(),k(kt,{class:"col bg-black"},{default:i(()=>[y("div",Ga,[t(ot,{modelValue:a.value,"onUpdate:modelValue":o[0]||(o[0]=n=>a.value=n),"no-caps":"","outside-arrows":"","mobile-arrows":"",class:"col bg-dark"},{default:i(()=>[t(ie,{name:"raffle",label:"Raffle"}),x(N)().is_admin?(g(),k(ie,{key:0,name:"create",label:"Create"})):b("",!0),x(N)().is_admin?(g(),k(ie,{key:1,name:"manage",label:"Manage"})):b("",!0)]),_:1},8,["modelValue"]),t(Q,{flat:"",class:"bg-dark",icon:"refresh",onClick:o[1]||(o[1]=n=>x($)().updateStore())})]),x($)().raffles.length==0?(g(),U("div",Ya,[t(ne),t(Kt,{class:"row",color:"primary",size:"10rem"}),t(ne)])):b("",!0),x($)().raffles.length>0?(g(),U("div",Za,[a.value==="raffle"?(g(),k(Ve,{key:0,raffles:x($)().getRunningRaffles,is_admin:!1},null,8,["raffles"])):b("",!0),a.value==="create"?(g(),U("div",Ja,[t(Fa,{class:"q-mt-xl"})])):b("",!0),a.value==="manage"?(g(),k(Ve,{key:2,raffles:x($)().raffles,is_admin:x(N)().is_admin},null,8,["raffles","is_admin"])):b("",!0)])):b("",!0)]),_:1}))}});export{Qn as default};
