import{cU as F,cT as N,au as B,J as p,b1 as C,ak as $,as as n,bx as v,ar as Q,cm as D,cZ as T,cX as Le,df as Ce,dg as W,aX as R,a6 as te,b7 as le,bz as O,ai as z,a1 as ae,P as G,bZ as Me,aU as Ue,ah as q,bs as ke,aF as w,aC as De,aQ as Re,cM as Oe,ct as je,co as ee,cd as we,bT as He,cC as xe,aj as Xe,al as Je}from"./index.e3ff99be.js";import{Q as Ze}from"./QCardSection.321be64b.js";import{Q as pe}from"./QSeparator.1b2bd38a.js";import{Q as Ye,a as P}from"./QTabs.dee7cd49.js";import{Q as Ge,a as E}from"./QTabPanels.6f5e21bd.js";import{u as et,a as tt,Q as lt}from"./QCard.67de6af8.js";import{Q as at}from"./QPage.c561ded1.js";import{Q as re}from"./QInput.0c966333.js";import{h as j}from"./handle_confirmation.32d1bee1.js";import{Q as ne}from"./QMenu.b61c66f5.js";import{a as ie,Q as oe}from"./QItem.f4668556.js";import{Q as ce}from"./QList.9f7f4e9a.js";import{Q as se}from"./QBtnDropdown.9a15f147.js";import{C as ue}from"./ClosePopup.71be89c3.js";import{Q as rt,a as nt}from"./QSlideTransition.2e9ad7ea.js";import"./uid.42677368.js";import"./rtl.fb727fdd.js";import"./touch.3df10340.js";import"./use-key-composition.6d629472.js";import"./use-form.cfebe8b0.js";import"./use-checkbox.08e24c2c.js";function H(){F().publicKey.value||N.create({color:"yellow",message:"Wallet not connected!",timeout:5e3})}const it={class:"row"},ot=B({__name:"CreateWhitelist",setup(l){const c=p("");async function f(){H();const{pg_whitelist:y}=W();let[s,k]=T.findProgramAddressSync([F().publicKey.value.toBytes(),Le(c.value)],y.value.programId);try{const _=await y.value.methods.initialize(c.value).accounts({whitelist:s,systemProgram:Ce.programId}).rpc();console.log(_),await j(_)}catch(_){N.create({color:"red",message:`${_}`,timeout:5e3})}}return(y,s)=>(C(),$("div",it,[n(re,{label:"New whitelist name",filled:"",class:"col",modelValue:c.value,"onUpdate:modelValue":s[0]||(s[0]=k=>c.value=k)},null,8,["modelValue"]),n(D,{disable:c.value.length==0,square:"",color:"primary",onClick:s[1]||(s[1]=k=>f())},{default:v(()=>[Q("Create")]),_:1},8,["disable"])]))}}),ct={class:"row"},st=B({__name:"AddAddressToWhitelist",setup(l){const{pg_whitelist:c}=W(),f=p(""),y=p(),s=p();R(async()=>{y.value=await c.value.account.whitelist.all()});async function k(){H();const _=new G(s.value.publicKey.toString()),[u,h]=T.findProgramAddressSync([new G(f.value).toBytes(),_.toBytes()],c.value.programId);try{const o=new G(f.value),K=await c.value.methods.addToWhitelist(o).accounts({entry:u,whitelist:_,authority:F().publicKey.value,systemProgram:Ce.programId}).rpc();console.log(K),await j(K)}catch(o){N.create({color:"red",message:`${o}`,timeout:5e3})}}return(_,u)=>{var h;return C(),$("div",ct,[n(se,{color:"primary",square:"",label:((h=s.value)==null?void 0:h.account.name)??"please select a whitelist"},{default:v(()=>[n(ce,null,{default:v(()=>[(C(!0),$(te,null,le(y.value,o=>O((C(),z(oe,{clickable:"",key:o,onClick:K=>s.value=o},{default:v(()=>[n(ie,null,{default:v(()=>[n(ne,null,{default:v(()=>[Q(ae(o==null?void 0:o.account.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[ue]])),128))]),_:1})]),_:1},8,["label"]),n(re,{class:"col",filled:"",modelValue:f.value,"onUpdate:modelValue":u[0]||(u[0]=o=>f.value=o),label:"Address to be added"},null,8,["modelValue"]),n(D,{disable:f.value.length==0,square:"",color:"primary",onClick:u[1]||(u[1]=o=>k())},{default:v(()=>[Q("Add")]),_:1},8,["disable"])])}}}),ut=["none","strict","leaf","leaf-filtered"];var dt=Me({name:"QTree",props:{...et,nodes:{type:Array,required:!0},nodeKey:{type:String,required:!0},labelKey:{type:String,default:"label"},childrenKey:{type:String,default:"children"},dense:Boolean,color:String,controlColor:String,textColor:String,selectedColor:String,icon:String,tickStrategy:{type:String,default:"none",validator:l=>ut.includes(l)},ticked:Array,expanded:Array,selected:{},noSelectionUnset:Boolean,defaultExpandAll:Boolean,accordion:Boolean,filter:String,filterMethod:Function,duration:Number,noConnectors:Boolean,noTransition:Boolean,noNodesLabel:String,noResultsLabel:String},emits:["update:expanded","update:ticked","update:selected","lazyLoad","afterShow","afterHide"],setup(l,{slots:c,emit:f}){const{proxy:y}=De(),{$q:s}=y,k=tt(l,s),_=p({}),u=p(l.ticked||[]),h=p(l.expanded||[]);let o={};Ue(()=>{o={}});const K=q(()=>`q-tree q-tree--${l.dense===!0?"dense":"standard"}`+(l.noConnectors===!0?" q-tree--no-connectors":"")+(k.value===!0?" q-tree--dark":"")+(l.color!==void 0?` text-${l.color}`:"")),de=q(()=>l.selected!==void 0),Se=q(()=>l.icon||s.iconSet.tree.icon),fe=q(()=>l.controlColor||l.color),I=q(()=>l.textColor!==void 0?` text-${l.textColor}`:""),Ke=q(()=>{const t=l.selectedColor||l.color;return t?` text-${t}`:""}),qe=q(()=>l.filterMethod!==void 0?l.filterMethod:(t,a)=>{const e=a.toLowerCase();return t[l.labelKey]&&t[l.labelKey].toLowerCase().indexOf(e)>-1}),S=q(()=>{const t={},a=(e,i)=>{const r=e.tickStrategy||(i?i.tickStrategy:l.tickStrategy),m=e[l.nodeKey],b=e[l.childrenKey]&&Array.isArray(e[l.childrenKey])&&e[l.childrenKey].length!==0,A=e.disabled!==!0&&de.value===!0&&e.selectable!==!1,x=e.disabled!==!0&&e.expandable!==!1,ze=r!=="none",U=r==="strict",be=r==="leaf-filtered",Z=r==="leaf"||r==="leaf-filtered";let Y=e.disabled!==!0&&e.tickable!==!1;Z===!0&&Y===!0&&i&&i.tickable!==!0&&(Y=!1);let V=e.lazy;V===!0&&_.value[m]!==void 0&&Array.isArray(e[l.childrenKey])===!0&&(V=_.value[m]);const d={key:m,parent:i,isParent:b,lazy:V,disabled:e.disabled,link:e.disabled!==!0&&(A===!0||x===!0&&(b===!0||V===!0)),children:[],matchesFilter:l.filter?qe.value(e,l.filter):!0,selected:m===l.selected&&A===!0,selectable:A,expanded:b===!0?h.value.includes(m):!1,expandable:x,noTick:e.noTick===!0||U!==!0&&V&&V!=="loaded",tickable:Y,tickStrategy:r,hasTicking:ze,strictTicking:U,leafFilteredTicking:be,leafTicking:Z,ticked:U===!0?u.value.includes(m):b===!0?!1:u.value.includes(m)};if(t[m]=d,b===!0&&(d.children=e[l.childrenKey].map(g=>a(g,d)),l.filter&&(d.matchesFilter!==!0?d.matchesFilter=d.children.some(g=>g.matchesFilter):d.noTick!==!0&&d.disabled!==!0&&d.tickable===!0&&be===!0&&d.children.every(g=>g.matchesFilter!==!0||g.noTick===!0||g.tickable!==!0)===!0&&(d.tickable=!1)),d.matchesFilter===!0&&(d.noTick!==!0&&U!==!0&&d.children.every(g=>g.noTick)===!0&&(d.noTick=!0),Z))){if(d.ticked=!1,d.indeterminate=d.children.some(g=>g.indeterminate===!0),d.tickable=d.tickable===!0&&d.children.some(g=>g.tickable),d.indeterminate!==!0){const g=d.children.reduce((ge,Ie)=>Ie.ticked===!0?ge+1:ge,0);g===d.children.length?d.ticked=!0:g>0&&(d.indeterminate=!0)}d.indeterminate===!0&&(d.indeterminateNextState=d.children.every(g=>g.tickable!==!0||g.ticked!==!0))}return d};return l.nodes.forEach(e=>a(e,null)),t});ke(()=>l.ticked,t=>{u.value=t}),ke(()=>l.expanded,t=>{h.value=t});function L(t){const a=[].reduce,e=(i,r)=>{if(i||!r)return i;if(Array.isArray(r)===!0)return a.call(Object(r),e,i);if(r[l.nodeKey]===t)return r;if(r[l.childrenKey])return e(null,r[l.childrenKey])};return e(null,l.nodes)}function Te(){return u.value.map(t=>L(t))}function $e(){return h.value.map(t=>L(t))}function Qe(t){return t&&S.value[t]?S.value[t].expanded:!1}function Ae(){l.expanded!==void 0?f("update:expanded",[]):h.value=[]}function ve(){const t=[],a=e=>{e[l.childrenKey]&&e[l.childrenKey].length!==0&&e.expandable!==!1&&e.disabled!==!0&&(t.push(e[l.nodeKey]),e[l.childrenKey].forEach(a))};l.nodes.forEach(a),l.expanded!==void 0?f("update:expanded",t):h.value=t}function X(t,a,e=L(t),i=S.value[t]){if(i.lazy&&i.lazy!=="loaded"){if(i.lazy==="loading")return;_.value[t]="loading",Array.isArray(e[l.childrenKey])!==!0&&(e[l.childrenKey]=[]),f("lazyLoad",{node:e,key:t,done:r=>{_.value[t]="loaded",e[l.childrenKey]=Array.isArray(r)===!0?r:[],Re(()=>{const m=S.value[t];m&&m.isParent===!0&&me(t,!0)})},fail:()=>{delete _.value[t],e[l.childrenKey].length===0&&delete e[l.childrenKey]}})}else i.isParent===!0&&i.expandable===!0&&me(t,a)}function me(t,a){let e=h.value;const i=l.expanded!==void 0;if(i===!0&&(e=e.slice()),a){if(l.accordion&&S.value[t]){const r=[];S.value[t].parent?S.value[t].parent.children.forEach(m=>{m.key!==t&&m.expandable===!0&&r.push(m.key)}):l.nodes.forEach(m=>{const b=m[l.nodeKey];b!==t&&r.push(b)}),r.length!==0&&(e=e.filter(m=>r.includes(m)===!1))}e=e.concat([t]).filter((r,m,b)=>b.indexOf(r)===m)}else e=e.filter(r=>r!==t);i===!0?f("update:expanded",e):h.value=e}function Ve(t){return t&&S.value[t]?S.value[t].ticked:!1}function M(t,a){let e=u.value;const i=l.ticked!==void 0;i===!0&&(e=e.slice()),a?e=e.concat(t).filter((r,m,b)=>b.indexOf(r)===m):e=e.filter(r=>t.includes(r)===!1),i===!0&&f("update:ticked",e)}function Be(t,a,e){const i={tree:y,node:t,key:e,color:l.color,dark:k.value};return xe(i,"expanded",()=>a.expanded,r=>{r!==a.expanded&&X(e,r)}),xe(i,"ticked",()=>a.ticked,r=>{r!==a.ticked&&M([e],r)}),i}function _e(t){return(l.filter?t.filter(a=>S.value[a[l.nodeKey]].matchesFilter):t).map(a=>Ne(a))}function Pe(t){if(t.icon!==void 0)return w(ee,{class:"q-tree__icon q-mr-sm",name:t.icon,color:t.iconColor});const a=t.img||t.avatar;if(a)return w("img",{class:`q-tree__${t.img?"img":"avatar"} q-mr-sm`,src:a})}function Ee(){f("afterShow")}function Fe(){f("afterHide")}function Ne(t){const a=t[l.nodeKey],e=S.value[a],i=t.header&&c[`header-${t.header}`]||c["default-header"],r=e.isParent===!0?_e(t[l.childrenKey]):[],m=r.length!==0||e.lazy&&e.lazy!=="loaded";let b=t.body&&c[`body-${t.body}`]||c["default-body"];const A=i!==void 0||b!==void 0?Be(t,e,a):null;return b!==void 0&&(b=w("div",{class:"q-tree__node-body relative-position"},[w("div",{class:I.value},[b(A)])])),w("div",{key:a,class:`q-tree__node relative-position q-tree__node--${m===!0?"parent":"child"}`},[w("div",{class:"q-tree__node-header relative-position row no-wrap items-center"+(e.link===!0?" q-tree__node--link q-hoverable q-focusable":"")+(e.selected===!0?" q-tree__node--selected":"")+(e.disabled===!0?" q-tree__node--disabled":""),tabindex:e.link===!0?0:-1,ariaExpanded:r.length>0?e.expanded:null,role:"treeitem",onClick:x=>{he(t,e,x)},onKeypress(x){Oe(x)!==!0&&(x.keyCode===13?he(t,e,x,!0):x.keyCode===32&&J(t,e,x,!0))}},[w("div",{class:"q-focus-helper",tabindex:-1,ref:x=>{o[e.key]=x}}),e.lazy==="loading"?w(je,{class:"q-tree__spinner",color:fe.value}):m===!0?w(ee,{class:"q-tree__arrow"+(e.expanded===!0?" q-tree__arrow--rotate":""),name:Se.value,onClick(x){J(t,e,x)}}):null,e.hasTicking===!0&&e.noTick!==!0?w(rt,{class:"q-tree__tickbox",modelValue:e.indeterminate===!0?null:e.ticked,color:fe.value,dark:k.value,dense:!0,keepColor:!0,disable:e.tickable!==!0,onKeydown:we,"onUpdate:modelValue":x=>{We(e,x)}}):null,w("div",{class:"q-tree__node-header-content col row no-wrap items-center"+(e.selected===!0?Ke.value:I.value)},[i?i(A):[Pe(t),w("div",t[l.labelKey])]])]),m===!0?l.noTransition===!0?e.expanded===!0?w("div",{class:"q-tree__node-collapsible"+I.value,key:`${a}__q`},[b,w("div",{class:"q-tree__children"+(e.disabled===!0?" q-tree__node--disabled":""),role:"group"},r)]):null:w(nt,{duration:l.duration,onShow:Ee,onHide:Fe},()=>O(w("div",{class:"q-tree__node-collapsible"+I.value,key:`${a}__q`},[b,w("div",{class:"q-tree__children"+(e.disabled===!0?" q-tree__node--disabled":""),role:"group"},r)]),[[He,e.expanded]])):b])}function ye(t){const a=o[t];a&&a.focus()}function he(t,a,e,i){i!==!0&&a.selectable!==!1&&ye(a.key),de.value&&a.selectable?l.noSelectionUnset===!1?f("update:selected",a.key!==l.selected?a.key:null):a.key!==l.selected&&f("update:selected",a.key===void 0?null:a.key):J(t,a,e,i),typeof t.handler=="function"&&t.handler(t)}function J(t,a,e,i){e!==void 0&&we(e),i!==!0&&a.selectable!==!1&&ye(a.key),X(a.key,!a.expanded,t,a)}function We(t,a){if(t.indeterminate===!0&&(a=t.indeterminateNextState),t.strictTicking)M([t.key],a);else if(t.leafTicking){const e=[],i=r=>{r.isParent?(a!==!0&&r.noTick!==!0&&r.tickable===!0&&e.push(r.key),r.leafTicking===!0&&r.children.forEach(i)):r.noTick!==!0&&r.tickable===!0&&(r.leafFilteredTicking!==!0||r.matchesFilter===!0)&&e.push(r.key)};i(t),M(e,a)}}return l.defaultExpandAll===!0&&ve(),Object.assign(y,{getNodeByKey:L,getTickedNodes:Te,getExpandedNodes:$e,isExpanded:Qe,collapseAll:Ae,expandAll:ve,setExpanded:X,isTicked:Ve,setTicked:M}),()=>{const t=_e(l.nodes);return w("div",{class:K.value,role:"tree"},t.length===0?l.filter?l.noResultsLabel||s.lang.tree.noResults:l.noNodesLabel||s.lang.tree.noNodes:t)}}});const ft={class:"row q-gutter-x-md"},vt=B({__name:"ViewWhitelist",setup(l){const c=p(),f=p();R(async()=>{const{pg_whitelist:s}=W();c.value=await s.value.account.whitelist.all(),f.value=await s.value.account.whitelistEntry.all()});const y=q(()=>{var s;return(s=c==null?void 0:c.value)==null?void 0:s.map(k=>{var _,u;return{label:`${k.account.name} | ${k.publicKey.toString()}`,children:(u=(_=f.value)==null?void 0:_.filter(h=>h.account.parent.toString()===k.publicKey.toString()))==null?void 0:u.flatMap(h=>({label:`Member: ${h.account.whitelisted.toString()}  |  Account: ${h.publicKey.toString()} `}))}})});return(s,k)=>(C(),$("div",ft,[y.value?(C(),z(dt,{key:0,nodes:y.value,"node-key":"label","selected-color":"primary","default-expand-all":""},null,8,["nodes"])):Xe("",!0)]))}}),mt={class:"row"},_t=B({__name:"RemoveAddressFromWhitelist",setup(l){const{pg_whitelist:c}=W(),f=p(""),y=p(),s=p();R(async()=>{y.value=await c.value.account.whitelist.all()});async function k(){H();const _=new T(s.value.publicKey),[u,h]=T.findProgramAddressSync([new T(f.value).toBytes(),_.toBytes()],c.value.programId);try{console.log(c.value.methods);const o=new T(f.value),K=await c.value.methods.removeFromWhitelist(o).accounts({entry:u,whitelist:_,authority:F().publicKey.value}).rpc();console.log(K),await j(K)}catch(o){N.create({color:"red",message:`${o}`,timeout:5e3})}}return(_,u)=>{var h;return C(),$("div",mt,[n(se,{color:"primary",square:"",label:((h=s.value)==null?void 0:h.account.name)??"please select a whitelist"},{default:v(()=>[n(ce,null,{default:v(()=>[(C(!0),$(te,null,le(y.value,o=>O((C(),z(oe,{clickable:"",key:o,onClick:K=>s.value=o},{default:v(()=>[n(ie,null,{default:v(()=>[n(ne,null,{default:v(()=>[Q(ae(o==null?void 0:o.account.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[ue]])),128))]),_:1})]),_:1},8,["label"]),n(re,{class:"col",filled:"",modelValue:f.value,"onUpdate:modelValue":u[0]||(u[0]=o=>f.value=o),label:"Address to be removed"},null,8,["modelValue"]),n(D,{disable:f.value.length==0,square:"",color:"primary",onClick:u[1]||(u[1]=o=>k())},{default:v(()=>[Q("Remove")]),_:1},8,["disable"])])}}}),yt={class:"row"},ht=B({__name:"DeleteWhitelist",setup(l){const{pg_whitelist:c}=W(),f=p("3x5vrFFTspsicxrYHMA8SNVW71RMhVkALemXrJFfeQo1"),y=p(),s=p();R(async()=>{y.value=await c.value.account.whitelist.all()});async function k(){H();const _=new T(s.value.publicKey);T.findProgramAddressSync([new T(f.value).toBytes(),_.toBytes()],c.value.programId);try{const u=await c.value.methods.deleteWhitelist(s.value.account.name).accounts({whitelist:_,authority:F().publicKey.value}).rpc();console.log(u),await j(u)}catch(u){N.create({color:"red",message:`${u}`,timeout:5e3})}}return(_,u)=>{var h;return C(),$("div",yt,[n(se,{square:"",color:"primary",label:((h=s.value)==null?void 0:h.account.name)??"please select a whitelist"},{default:v(()=>[n(ce,null,{default:v(()=>[(C(!0),$(te,null,le(y.value,o=>O((C(),z(oe,{clickable:"",key:o,onClick:K=>s.value=o},{default:v(()=>[n(ie,null,{default:v(()=>[n(ne,null,{default:v(()=>[Q(ae(o==null?void 0:o.account.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[ue]])),128))]),_:1})]),_:1},8,["label"]),n(D,{square:"",color:"primary",onClick:u[0]||(u[0]=o=>k())},{default:v(()=>[Q("Delete")]),_:1})])}}}),bt=Je("div",{class:"col text-h6"},"Whitelists Manager",-1),It=B({__name:"WhitelistPage",setup(l){const c=p("view");return(f,y)=>(C(),z(at,{class:"bg-black"},{default:v(()=>[n(lt,{flat:""},{default:v(()=>[n(Ze,{class:"row items-center q-gutter-x-md"},{default:v(()=>[n(ee,{name:"contrast",size:"md"}),bt]),_:1}),n(pe),n(Ye,{"no-caps":"","outside-arrows":"","mobile-arrows":"",modelValue:c.value,"onUpdate:modelValue":y[0]||(y[0]=s=>c.value=s),class:"shadow-2 bg-dark",align:"justify"},{default:v(()=>[n(P,{name:"create",label:"Create Whitelist"}),n(P,{name:"add",label:"Add Address to Whitelist"}),n(P,{name:"remove",label:"Remove address from Whitelist"}),n(P,{name:"delete",label:"Delete Whitelist"}),n(P,{name:"view",label:"View "})]),_:1},8,["modelValue"]),n(pe),n(Ge,{dark:"",modelValue:c.value,"onUpdate:modelValue":y[1]||(y[1]=s=>c.value=s),animated:""},{default:v(()=>[n(E,{name:"create"},{default:v(()=>[n(ot)]),_:1}),n(E,{name:"add"},{default:v(()=>[n(st)]),_:1}),n(E,{name:"remove"},{default:v(()=>[n(_t)]),_:1}),n(E,{name:"delete"},{default:v(()=>[n(ht)]),_:1}),n(E,{name:"view"},{default:v(()=>[n(vt)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}))}});export{It as default};
