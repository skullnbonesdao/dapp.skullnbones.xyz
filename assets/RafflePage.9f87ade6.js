import{Q as Te}from"./QPage.cb6ac2b5.js";import{Q as L,a as ue,b as tt}from"./QInput.17c6bdc6.js";import{au as C,J as p,cm as h,b1 as _,ak as D,al as P,as as t,bx as o,ar as w,cj as E,aj as A,P as g,co as $,cK as T,cU as Z,cL as ge,cV as ze,cJ as N,cM as O,bZ as at,ah as F,bs as de,aT as Se,cb as Pe,c6 as Ae,aF as $e,bC as nt,aC as lt,cg as ot,cc as st,cW as R,cX as se,cY as fe,cZ as Oe,aX as ve,ai as k,bz as me,c_ as rt,V as S,c$ as it,d0 as Ke,d1 as ct,a1 as Q,cl as oe,bT as Ce,a6 as ut,d2 as ne,d3 as dt,ck as ft}from"./index.97899ba2.js";import{Q as re}from"./QSpace.38092221.js";import{u as ee,Q as Ue,a as mt,b as pt,t as Le,c as _e,f as De,d as gt}from"./format_address.6131726a.js";import{Q as Ie}from"./QImg.19e5d04f.js";import{T as U,Q as ye,a as j}from"./constants.1e209da8.js";import{m as Y,n as z,y as vt,f as _t,p as yt,z as Ve,A as bt,h as wt,v as kt,i as ht,B as xt,D as Tt,E as St,j as Pt,F as At,G as Re,H as $t,c as qe,g as Ct,I as Be,J as It,C as Vt,l as Rt,o as M}from"./ClosePopup.4fd6ed1e.js";import{h as W,a as Ee}from"./QSlideTransition.4ba5368d.js";import{Q as pe}from"./QCardActions.c3c5b3c4.js";import{Q as le}from"./QBadge.d8bc2d2f.js";import{g as Ne,c as We}from"./index.c46df6fb.js";import{_ as qt}from"./IconFromSeed.c3805f91.js";import{Q as Me}from"./QSeparator.d8be2725.js";import"./use-prevent-scroll.3da76905.js";const Bt={key:0,class:"col q-pa-sm"},Et=P("p",{class:"text-overline"},"Add a prize:",-1),Mt={class:"col q-gutter-y-sm"},Qt={class:"row"},zt=C({__name:"RaffleAddPrize",props:["raffle","is_admin"],setup(e){const l=p(1),u=p(""),s=p(""),a=e,n=p([]);p(ee().token_accounts.filter(f=>f.account.data.parsed.info.tokenAmount.uiAmount>0).flatMap(f=>f.account.data.parsed.info.mint)).value.forEach(f=>{var c,i;return n.value.push({label:((c=h().token_list.find(m=>m.address==f))==null?void 0:c.name)+" ["+((i=h().token_list.find(m=>m.address==f))==null?void 0:i.symbol)+"]",value:f})});async function d(){var b,B,K;const{pg_raffle:f}=O(),c=new g(s.value.value),i=(await h().connection.getParsedTokenAccountsByOwner($().publicKey.value,{mint:c})).value[0].pubkey,m=new g(a.raffle.publicKey.toString());let[v,y]=g.findProgramAddressSync([T("vault"),m.toBytes()],f.value.programId);const x=await h().connection.getParsedAccountInfo(c);console.log((b=x.value)==null?void 0:b.data.parsed.info.decimals);try{const V=await f.value.methods.addPrize(new Z(l.value*Math.pow(10,(B=x.value)==null?void 0:B.data.parsed.info.decimals)),new Z((K=x.value)==null?void 0:K.data.parsed.info.decimals),u.value).accounts({raffle:m,creator:$().publicKey.value,from:i,prizeVault:v,prizeMint:c,systemProgram:ge.programId,tokenProgram:U,rent:ze}).rpc();console.log(V),await W(V)}catch(V){N.create({color:"red",message:`${V}`,timeout:5e3})}}return(f,c)=>e.is_admin&&e.raffle.account.prizeTokenMint.toString()=="11111111111111111111111111111111"?(_(),D("div",Bt,[Et,P("div",Mt,[t(Ue,{class:"full-width",filled:"",square:"",modelValue:s.value,"onUpdate:modelValue":c[0]||(c[0]=i=>s.value=i),clearable:"","use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",behavior:"menu",label:"Select Ticket by mint",options:n.value,onFilter:f.filterFn,style:{width:"250px"}},{"no-option":o(()=>[t(Y,null,{default:o(()=>[t(z,{class:"text-grey"},{default:o(()=>[w(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter"]),P("div",Qt,[t(L,{class:"col",filled:"",square:"",modelValue:l.value,"onUpdate:modelValue":c[1]||(c[1]=i=>l.value=i),type:"number",label:"Count"},null,8,["modelValue"]),t(E,{filled:"",square:"",class:"col-2",color:"primary",icon:"send",onClick:c[2]||(c[2]=i=>d())})])])])):A("",!0)}});var Ot=at({name:"QTooltip",inheritAttrs:!1,props:{...vt,..._t,...yt,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{default:"jump-down"},transitionHide:{default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:Ve},self:{type:String,default:"top middle",validator:Ve},offset:{type:Array,default:()=>[14,14],validator:bt},scrollTarget:{default:void 0},delay:{type:Number,default:0},hideDelay:{type:Number,default:0}},emits:[...wt],setup(e,{slots:l,emit:u,attrs:s}){let a,n;const r=lt(),{proxy:{$q:d}}=r,f=p(null),c=p(!1),i=F(()=>Be(e.anchor,d.lang.rtl)),m=F(()=>Be(e.self,d.lang.rtl)),v=F(()=>e.persistent!==!0),{registerTick:y,removeTick:x}=kt(),{registerTimeout:b}=ht(),{transitionProps:B,transitionStyle:K}=xt(e),{localScrollTarget:V,changeScrollEvent:te,unconfigureScrollTarget:ae}=Tt(e,he),{anchorEl:q,canShow:G,anchorEvents:J}=St({showing:c,configureAnchorEl:Xe}),{show:He,hide:ie}=Pt({showing:c,canShow:G,handleShow:je,handleHide:Ge,hideOnRouteChange:v,processOnMount:!0});Object.assign(J,{delayShow:Ye,delayHide:Je});const{showPortal:be,hidePortal:we,renderPortal:Fe}=At(r,f,et,"tooltip");if(d.platform.is.mobile===!0){const I={anchorEl:q,innerRef:f,onClickOutside(H){return ie(H),H.target.classList.contains("q-dialog__backdrop")&&st(H),!0}},ce=F(()=>e.modelValue===null&&e.persistent!==!0&&c.value===!0);de(ce,H=>{(H===!0?It:Re)(I)}),Se(()=>{Re(I)})}function je(I){be(),y(()=>{n=new MutationObserver(()=>X()),n.observe(f.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),X(),he()}),a===void 0&&(a=de(()=>d.screen.width+"|"+d.screen.height+"|"+e.self+"|"+e.anchor+"|"+d.lang.rtl,X)),b(()=>{be(!0),u("show",I)},e.transitionDuration)}function Ge(I){x(),we(),ke(),b(()=>{we(!0),u("hide",I)},e.transitionDuration)}function ke(){n!==void 0&&(n.disconnect(),n=void 0),a!==void 0&&(a(),a=void 0),ae(),Pe(J,"tooltipTemp")}function X(){$t({targetEl:f.value,offset:e.offset,anchorEl:q.value,anchorOrigin:i.value,selfOrigin:m.value,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function Ye(I){if(d.platform.is.mobile===!0){qe(),document.body.classList.add("non-selectable");const ce=q.value,H=["touchmove","touchcancel","touchend","click"].map(xe=>[ce,xe,"delayHide","passiveCapture"]);Ae(J,"tooltipTemp",H)}b(()=>{He(I)},e.delay)}function Je(I){d.platform.is.mobile===!0&&(Pe(J,"tooltipTemp"),qe(),setTimeout(()=>{document.body.classList.remove("non-selectable")},10)),b(()=>{ie(I)},e.hideDelay)}function Xe(){if(e.noParentEvent===!0||q.value===null)return;const I=d.platform.is.mobile===!0?[[q.value,"touchstart","delayShow","passive"]]:[[q.value,"mouseenter","delayShow","passive"],[q.value,"mouseleave","delayHide","passive"]];Ae(J,"anchor",I)}function he(){if(q.value!==null||e.scrollTarget!==void 0){V.value=Ct(q.value,e.scrollTarget);const I=e.noParentEvent===!0?X:ie;te(V.value,I)}}function Ze(){return c.value===!0?$e("div",{...s,ref:f,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",s.class],style:[s.style,K.value],role:"tooltip"},ot(l.default)):null}function et(){return $e(nt,B.value,Ze)}return Se(ke),Object.assign(r.proxy,{updatePosition:X}),Fe}});const Kt={key:0,class:"col q-pa-sm q-gutter-y-sm"},Ut=P("p",{class:"text-overline"},"Buy Ticket(s)",-1),Lt={class:"row"},Dt={class:"text-caption text-right text-weight-thin"},Nt=C({__name:"RaffleBuyTicket",props:["raffle","is_admin","entrants"],setup(e){const l=p(),u=e;async function s(){var K;await R().update_raffles(),await ee().update_accounts();const{pg_raffle:a,pg_whitelist:n}=O(),r=new g(u.raffle.account.ticketTokenMint.toString()),d=(await h().connection.getParsedTokenAccountsByOwner($().publicKey.value,{mint:r})).value[0].pubkey,f=new g(u.raffle.publicKey.toString());let[c,i]=g.findProgramAddressSync([T("entrants"),f.toBytes()],a.value.programId),[m,v]=g.findProgramAddressSync([T("proceeds"),f.toBytes()],a.value.programId),[y,x]=g.findProgramAddressSync([se.toBuffer(),T(fe)],n.value.programId);const[b,B]=g.findProgramAddressSync([$().publicKey.value.toBytes(),y.toBytes()],n.value.programId);try{const V=await a.value.methods.buyTickets(new Z(l.value),fe,se).accounts({raffle:f,entrants:c,proceeds:m,proceedsMint:r,from:d,transferAuth:$().publicKey.value,tokenProgram:U,whitelist:y,entry:b,whitelistProgram:n.value.programId,feeAccount:Oe,systemProgram:ge.programId}).rpc();console.log(V),await W(V)&&(await R().send_buy_message_discord(u.raffle.account.name.toString(),`${parseInt(u.entrants.total.toString())+parseInt(l.value.toString())}/${(K=u.entrants)==null?void 0:K.max}`,l.value),await R().update_raffles(),await ee().update_accounts())}catch(V){N.create({color:"red",message:`${V}`,timeout:5e3})}}return(a,n)=>{var r,d,f;return!e.is_admin&&!((r=e.raffle)!=null&&r.account.randomness)&&((d=e.entrants)==null?void 0:d.total)!=((f=e.entrants)==null?void 0:f.max)?(_(),D("div",Kt,[Ut,P("div",Lt,[t(L,{square:"",filled:"",outlined:"",type:"number",class:"col",label:"Amount",modelValue:l.value,"onUpdate:modelValue":n[0]||(n[0]=c=>l.value=c)},null,8,["modelValue"]),t(E,{square:"",color:"primary",icon:"send",onClick:n[1]||(n[1]=c=>{s().then(()=>{console.log("done sending!")})})})]),P("p",Dt,[w(" 0.001\u25CE fee "),t(Ot,{anchor:"bottom right",self:"top middle"},{default:o(()=>[w(" cover deployment costs ")]),_:1})])])):A("",!0)}}}),Wt=P("source",{src:"Burningticket.mp4",type:"video/mp4"},null,-1),Ht=C({__name:"BurningTicket",setup(e){const l=p();return ve(()=>{l.value.playbackRate=.3,console.log(l.value)}),(u,s)=>(_(),D("video",{ref_key:"ticket_burning",ref:l,autoplay:"",playbackspeed:"0.1"},[Wt,w(" Your browser does not support the video tag. ")],512))}}),Ft={class:"row"},jt=P("div",{class:"text-h6 text-center"},"Drawing...",-1),Gt=C({__name:"RaffleRevealWinner",props:["raffle","is_admin"],setup(e){p();const l=e,u=p(!1);async function s(){const{pg_raffle:a,pg_whitelist:n}=O(),r=new g(l.raffle.publicKey.toString());let[d,f]=g.findProgramAddressSync([T("entrants"),r.toBytes()],a.value.programId);try{const c=await a.value.methods.revealWinners().accounts({raffle:r,entrants:d,recentBlockHashes:rt}).rpc();u.value=!0,console.log(c),await W(c),await R().update_raffles(),u.value=!1}catch(c){N.create({color:"red",message:`${c}`,timeout:5e3})}}return(a,n)=>{var r;return _(),D("div",Ft,[e.is_admin&&e.raffle.account.isRunning&&((r=e.raffle.account)==null?void 0:r.randomness)===null?(_(),k(E,{key:0,square:"",class:"row",color:"primary",label:"Reveal Winner",onClick:n[0]||(n[0]=d=>s())})):A("",!0),t(mt,{maximized:!0,modelValue:u.value,"onUpdate:modelValue":n[1]||(n[1]=d=>u.value=d)},{default:o(()=>[t(ye,{flat:"",square:"",class:""},{default:o(()=>[t(j,null,{default:o(()=>[jt]),_:1}),t(j,{class:"q-pt-none row"},{default:o(()=>[t(re),t(Ht),t(re)]),_:1}),t(pe,{align:"right"},{default:o(()=>[me(t(E,{flat:"",label:"close",color:"primary"},null,512),[[Vt]])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),Yt={class:"absolute-full flex flex-center"},Jt=C({__name:"RaffleStateBadge",props:["raffle","entrants"],setup(e){const l=e,u=F(()=>{var s,a;return((s=l.entrants)==null?void 0:s.total)/((a=l.entrants)==null?void 0:a.max)});return(s,a)=>{var n,r;return e.raffle.account.isClaimed?(_(),k(le,{key:0,color:"cyan",class:"text-caption text-md"},{default:o(()=>[w(" ready-to-close ")]),_:1})):e.raffle.account.isRunning&&e.raffle.account.randomness?(_(),k(le,{key:1,color:"yellow",class:"text-caption text-md text-black"},{default:o(()=>[w(" claimable ")]),_:1})):e.raffle.account.isRunning&&((n=e.entrants)==null?void 0:n.total)==((r=e.entrants)==null?void 0:r.max)?(_(),k(le,{key:2,color:"orange",class:"text-caption text-md text-black"},{default:o(()=>[w("waiting for draw")]),_:1})):e.raffle.account.isRunning?(_(),k(pt,{key:3,size:"25px",value:u.value,color:"primary"},{default:o(()=>{var d,f;return[P("div",Yt,[t(le,{color:"black","text-color":"primary",label:`Tickets: ${(d=e.entrants)==null?void 0:d.total}/${(f=e.entrants)==null?void 0:f.max}`},null,8,["label"])])]}),_:1},8,["value"])):A("",!0)}}}),Xt=C({__name:"RaffleClaimPrize",props:["raffle","is_admin"],setup(e){const l=e;async function u(){const{pg_raffle:s}=O(),a=new g(l.raffle.account.prizeTokenMint.toString()),n=new g(l.raffle.account.winner.toString()),r=await Ne(a,n,!0,U,Le.ASSOCIATED_PROGRAM_ID);if(await h().connection.getAccountInfo(r)===null){let v=new Ke;v.add(We($().publicKey.value,r,n,a)),await $().sendTransaction(v,h().connection)}const d=new g(l.raffle.publicKey.toString());let[f,c]=g.findProgramAddressSync([T("entrants"),d.toBytes()],s.value.programId),[i,m]=g.findProgramAddressSync([T("vault"),d.toBytes()],s.value.programId);console.log(l.raffle.account.name);try{const v=await s.value.methods.claimPrize(l.raffle.account.name).accounts({creator:se,raffle:d,entrants:f,prizeVault:i,prizeMint:a,to:r,tokenProgram:U}).rpc();console.log(v),await W(v)}catch(v){N.create({color:"red",message:`${v}`,timeout:5e3})}}return(s,a)=>e.raffle.account.winner!=S(it)&&e.is_admin?(_(),k(E,{key:0,color:"primary",label:"Claim Prize",onClick:a[0]||(a[0]=n=>u())})):A("",!0)}}),Zt=C({__name:"RaffleClose",props:["raffle","is_admin"],setup(e){const l=e;async function u(){const{pg_raffle:s}=O();let[a,n]=g.findProgramAddressSync([T("raffle"),T(l.raffle.account.name)],s.value.programId),[r,d]=g.findProgramAddressSync([T("entrants"),a.toBytes()],s.value.programId),[f,c]=g.findProgramAddressSync([T("proceeds"),a.toBytes()],s.value.programId),[i,m]=g.findProgramAddressSync([T("vault"),a.toBytes()],s.value.programId);try{const v=await s.value.methods.closeRaffle(l.raffle.account.name).accounts({creator:$().publicKey.value,entrants:r,raffle:a,proceeds:f,prizeVault:i,tokenProgram:U}).rpc();console.log(v),await W(v)}catch(v){N.create({color:"red",message:`${v}`,timeout:5e3})}}return(s,a)=>e.is_admin&&(!e.raffle.account.isRunning||e.raffle.account.isClaimed)?(_(),k(E,{key:0,square:"",color:"primary",onClick:a[0]||(a[0]=n=>u())},{default:o(()=>[w("Close Raffle")]),_:1})):A("",!0)}}),ea=C({__name:"RaffleCollectProceeds",props:["raffle","is_admin"],setup(e){p(),p();const l=e;async function u(){const{pg_raffle:s}=O(),a=new g(l.raffle.account.ticketTokenMint.toString()),n=await Ne(a,$().publicKey.value,!0,U,Le.ASSOCIATED_PROGRAM_ID);if(await h().connection.getAccountInfo(n)===null){let i=new Ke;i.add(We($().publicKey.value,n,$().publicKey.value,a)),await $().sendTransaction(i,h().connection)}let[r,d]=g.findProgramAddressSync([T("raffle"),T(l.raffle.account.name)],s.value.programId),[f,c]=g.findProgramAddressSync([T("proceeds"),r.toBytes()],s.value.programId);try{const i=await s.value.methods.collectProceeds(l.raffle.account.name).accounts({creator:$().publicKey.value,raffle:r,proceeds:f,proceedsMint:a,to:n,tokenProgram:U}).rpc();console.log(i),await W(i)}catch(i){N.create({color:"red",message:`${i}`,timeout:5e3})}}return(s,a)=>l.is_admin&&e.raffle.account.isClaimed?(_(),k(E,{key:0,color:"primary",onClick:a[0]||(a[0]=n=>u())},{default:o(()=>[w("Collect Proceeds")]),_:1})):A("",!0)}}),ta=C({__name:"AccountsTable",props:["accounts"],setup(e){const l=p({rowsPerPage:0}),u=p([{name:"mint",required:!0,label:"Mint",align:"left",field:"mint",field:s=>{var a;return((a=h().token_list.find(n=>{var r;return n.address==((r=s.mint)==null?void 0:r.toString())}))==null?void 0:a.name)??""},sortable:!0},{name:"calories",align:"right",label:"Amount",field:s=>s.tokenAmount.uiAmount,sortable:!0}]);return(s,a)=>{var n,r;return _(),k(_e,{dense:"",bordered:"",class:"col",title:"Accounts",rows:(r=(n=e.accounts)==null?void 0:n.value)==null?void 0:r.map(d=>d.account.data.parsed.info),columns:u.value,"row-key":"mint","hide-bottom":"",flat:"",pagination:l.value,"onUpdate:pagination":a[0]||(a[0]=d=>l.value=d),"rows-per-page-options":[0]},null,8,["rows","columns","pagination"])}}}),aa={key:0,class:"q-pa-sm"},na={class:"row"},la=C({__name:"RaffleEditImageUrl",props:["raffle","is_admin"],setup(e){p(1);const l=p("");p();const u=e;async function s(){const{pg_raffle:a}=O(),n=new g(u.raffle.publicKey.toString());try{const r=await a.value.methods.editUrl(l.value).accounts({raffle:n,creator:$().publicKey.value}).rpc();console.log(r),await W(r)}catch(r){N.create({color:"red",message:`${r}`,timeout:5e3})}}return(a,n)=>e.is_admin&&e.raffle.account.prizeTokenMint.toString()!="11111111111111111111111111111111"?(_(),D("div",aa,[P("div",na,[t(L,{square:"",filled:"",class:"col",outlined:"",maxlength:"100",modelValue:l.value,"onUpdate:modelValue":n[0]||(n[0]=r=>l.value=r),type:"text",label:"Image-URL"},null,8,["modelValue"]),t(E,{square:"",icon:"send",color:"primary",onClick:n[1]||(n[1]=r=>s())})])])):A("",!0)}}),oa=C({__name:"TicketsTable",props:["entrads"],setup(e){const l=p({rowsPerPage:0});p();const u=p([{name:"wallet",required:!0,label:"Wallet",align:"left",field:s=>De(s.address),sortable:!0},{name:"amount",align:"right",label:"Amount",field:"amount",sortable:!0}]);return(s,a)=>(_(),k(_e,{dense:"",bordered:"",class:"col",title:"Tickets",rows:e.entrads,columns:u.value,"row-key":"mint","hide-bottom":"",flat:"",pagination:l.value,"onUpdate:pagination":a[0]||(a[0]=n=>l.value=n),"rows-per-page-options":[0]},null,8,["rows","columns","pagination"]))}}),sa={class:"text-h5 q-mt-sm q-mb-xs"},ra={class:"text-caption text-grey"},ia=C({__name:"RaffleCard",props:["raffle","is_admin"],setup(e){const l=e,u=p(),s=p(),a=p(!1);async function n(){const{pg_raffle:i}=O();u.value=await i.value.account.entrants.fetch(l.raffle.account.entrants),s.value=await h().connection.getParsedTokenAccountsByOwner(l.raffle.publicKey,{programId:U})}const r=p();async function d(){const{pg_raffle:i}=O(),m=await i.value.account.entrants.getAccountInfo(new g("GzCeuKQ4MVMHodAjrHQJDZKyX9QoDDUg45c4Ec5a261T"));let v=[];for(let b=0;b<u.value.total;b++){let B=f(m.data,b);v.push(B)}const y=v.map(b=>b.toString());console.log(y);const x=y.reduce((b,B)=>({...b,[B]:(b[B]||0)+1}),{});console.log(x),r.value=Object.entries(x).flatMap(b=>({address:b[0],amount:b[1]}))}function f(i,m){const v=16+32*m,y=v+32,x=i.slice(v,y);return new g(x)}ve(async()=>{await n(),await d()});const{_updateCount:c}=ct(R());return de(c,async()=>{await n()}),(i,m)=>(_(),D(ut,null,[w(Q(u.value)+" ",1),t(ye,{square:"",flat:""},{default:o(()=>{var v;return[e.raffle.account.url?(_(),k(Ie,{key:0,height:"200px",src:e.raffle.account.url},null,8,["src"])):(_(),k(Ie,{key:1,height:"200px",src:(v=S(h)().token_list.find(y=>y.address==e.raffle.account.prizeTokenMint))==null?void 0:v.logoURI},null,8,["src"])),t(j,null,{default:o(()=>[t(Jt,{raffle:e.raffle,entrants:u.value},null,8,["raffle","entrants"]),P("div",sa,Q(e.raffle.account.name),1),P("div",ra,Q(e.raffle.account.description),1)]),_:1}),t(j,null,{default:o(()=>[t(Rt,null,{default:o(()=>[t(Y,{clickable:""},{default:o(()=>[t(z,{avatar:""},{default:o(()=>[t(oe,{color:"primary",name:"functions"})]),_:1}),t(z,null,{default:o(()=>[t(M,{class:"text-h6"},{default:o(()=>{var y;return[w(Q((y=u.value)==null?void 0:y.max),1)]}),_:1}),t(M,{class:"text-orange-9",caption:""},{default:o(()=>[w("Total tickets")]),_:1})]),_:1})]),_:1}),t(Y,{clickable:""},{default:o(()=>[t(z,{avatar:""},{default:o(()=>[t(oe,{color:"red",name:"paid"})]),_:1}),t(z,null,{default:o(()=>[t(M,{class:"text-h6"},{default:o(()=>[w(Q((e.raffle.account.ticketPrice.toNumber()*Math.pow(10,-e.raffle.account.ticketDecimals)).toFixed(2)),1)]),_:1}),t(M,{class:"text-orange-9",caption:""},{default:o(()=>[w("Price per ticket")]),_:1})]),_:1})]),_:1}),t(Y,{clickable:""},{default:o(()=>[t(z,{avatar:""},{default:o(()=>[t(oe,{color:"amber",name:"local_movies"})]),_:1}),t(z,null,{default:o(()=>[t(M,{class:"text-overline"},{default:o(()=>{var y;return[w(Q((y=S(h)().token_list.find(x=>x.address==e.raffle.account.ticketTokenMint))==null?void 0:y.symbol),1)]}),_:1}),t(M,{class:"text-orange-9",caption:""},{default:o(()=>[w("Ticket-Mint")]),_:1}),t(M,{class:"q-pt-md text-overline"},{default:o(()=>{var y,x;return[w(Q((y=S(h)().token_list.find(b=>b.address==e.raffle.account.prizeTokenMint))==null?void 0:y.name)+" ["+Q((x=S(h)().token_list.find(b=>b.address==e.raffle.account.prizeTokenMint))==null?void 0:x.symbol)+"] ",1)]}),_:1}),t(M,{class:"text-orange-9",caption:""},{default:o(()=>[w("Prize-Mint")]),_:1})]),_:1})]),_:1}),e.raffle.account.randomness!=null?(_(),k(Y,{key:0,clickable:""},{default:o(()=>[t(z,{avatar:""},{default:o(()=>{var y,x;return[t(qt,{style:{width:"100px"},seed:(x=(y=e.raffle.account)==null?void 0:y.winner)==null?void 0:x.toString()},null,8,["seed"])]}),_:1}),t(z,null,{default:o(()=>[t(M,{class:"text-h6",l:""},{default:o(()=>[w("Winner")]),_:1}),t(M,{class:"text-orange-9",caption:""},{default:o(()=>[w(Q(S(De)(e.raffle.account.winner.toString())),1)]),_:1})]),_:1})]),_:1})):A("",!0)]),_:1})]),_:1}),t(E,{class:"full-width",icon:a.value?"expand_less":" expand_more",onClick:m[0]||(m[0]=y=>a.value=!a.value)},null,8,["icon"]),t(Ee,null,{default:o(()=>[me(t(ta,{accounts:s.value},null,8,["accounts"]),[[Ce,a.value]])]),_:1}),t(Ee,null,{default:o(()=>[me(t(oa,{entrads:r.value},null,8,["entrads"]),[[Ce,a.value]])]),_:1}),t(zt,{raffle:e.raffle,is_admin:e.is_admin},null,8,["raffle","is_admin"]),t(la,{class:"q-mx-sm",raffle:e.raffle,is_admin:e.is_admin},null,8,["raffle","is_admin"]),t(pe,{class:"row q-gutter-y-sm justify-center q-mx-sm"},{default:o(()=>[t(Gt,{raffle:e.raffle,is_admin:e.is_admin},null,8,["raffle","is_admin"]),t(Xt,{raffle:e.raffle,is_admin:e.is_admin},null,8,["raffle","is_admin"]),t(ea,{raffle:e.raffle,is_admin:e.is_admin},null,8,["raffle","is_admin"]),t(Zt,{raffle:e.raffle,is_admin:e.is_admin},null,8,["raffle","is_admin"])]),_:1}),t(pe,null,{default:o(()=>[t(Nt,{raffle:e.raffle,is_admin:e.is_admin,entrants:u.value},null,8,["raffle","is_admin","entrants"])]),_:1})]}),_:1})],64))}}),ca={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},Qe=C({__name:"RaffleGrid",props:{is_admin:{type:Boolean,default:!1},raffles:{type:[],default:[]},count:{type:Number,default:0}},setup(e){const l=e,u=F(()=>ne().screen.gt.xs?"example-masonry-table-grid example-masonry-table-grid--"+(ne().screen.gt.sm?"3":"2"):null),s=F(()=>ne().screen.gt.xs?ne().screen.gt.sm?[3,6,9]:[3,6]:[3]),a=p();return(n,r)=>(_(),k(_e,{grid:"","card-container-class":u.value,rows:l.raffles,"row-key":"name",filter:n.filter,"hide-header":"",pagination:a.value,"onUpdate:pagination":r[1]||(r[1]=d=>a.value=d),"rows-per-page-options":s.value},{"top-right":o(()=>[w(Q()+" ",1),t(L,{borderless:"",dense:"",debounce:"300",modelValue:n.filter,"onUpdate:modelValue":r[0]||(r[0]=d=>n.filter=d),placeholder:"Search"},{append:o(()=>[t(oe,{name:"search"})]),_:1},8,["modelValue"])]),item:o(d=>[P("div",ca,[t(ia,{is_admin:e.is_admin,raffle:d.row},null,8,["is_admin","raffle"])])]),_:1},8,["card-container-class","rows","filter","pagination","rows-per-page-options"]))}}),ua=P("p",{class:"text-h5"},"Raffle",-1),da=P("p",{class:"text-h5"},"Tickets",-1),fa={class:"row justify-center"},ma=C({__name:"RaffleCreateRaffle",setup(e){const l=p(),u=p(),s=p(),a=p(),n=p();async function r(){var ae,q;const{pg_raffle:c,pg_whitelist:i}=O();let[m,v]=g.findProgramAddressSync([T("raffle"),T(l.value)],c.value.programId),[y,x]=g.findProgramAddressSync([T("entrants"),m.toBytes()],c.value.programId),[b,B]=g.findProgramAddressSync([T("proceeds"),m.toBytes()],c.value.programId),[K,V]=g.findProgramAddressSync([se.toBuffer(),T(fe)],i.value.programId);const te=await h().connection.getParsedAccountInfo(new g(n.value.value));try{const G=await c.value.methods.createRaffle(l.value,u.value,new Z(a.value*Math.pow(10,(ae=te.value)==null?void 0:ae.data.parsed.info.decimals)),new Z((q=te.value)==null?void 0:q.data.parsed.info.decimals),s.value).accounts({raffle:m,entrants:y,creator:$().publicKey.value,proceeds:b,proceedsMint:new g(n.value.value),tokenProgram:U,rent:ze,whitelist:K,feeAccount:Oe,systemProgram:ge.programId}).rpc();console.log(G),await W(G)&&await R().send_discord_webhook(dt.RAFFLE_CREATE,l.value,u.value,s.value,a.value)}catch(G){N.create({color:"red",message:`${G}`,timeout:5e3})}}const d=p([]);return p(ee().token_accounts.filter(c=>c.account.data.parsed.info.tokenAmount.uiAmount>0).flatMap(c=>c.account.data.parsed.info.mint)).value.forEach(c=>{var i,m;return d.value.push({label:((i=h().token_list.find(v=>v.address==c))==null?void 0:i.name)+" ["+((m=h().token_list.find(v=>v.address==c))==null?void 0:m.symbol)+"]",value:c})}),(c,i)=>(_(),k(ye,{square:"",flat:"",class:"col q-pa-sm"},{default:o(()=>[t(j,{class:"q-gutter-y-md"},{default:o(()=>[ua,t(L,{filled:"",square:"",modelValue:l.value,"onUpdate:modelValue":i[0]||(i[0]=m=>l.value=m),type:"text",label:"Name"},null,8,["modelValue"]),t(L,{filled:"",square:"",modelValue:u.value,"onUpdate:modelValue":i[1]||(i[1]=m=>u.value=m),type:"text",label:"Description"},null,8,["modelValue"])]),_:1}),t(Me),t(j,{class:"q-gutter-y-md"},{default:o(()=>[da,P("div",fa,[t(Ue,{class:"col",filled:"",square:"",modelValue:n.value,"onUpdate:modelValue":i[2]||(i[2]=m=>n.value=m),clearable:"","use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",behavior:"menu",label:"Select Ticket by mint",options:d.value,onFilter:c.filterFn,style:{width:"250px"}},{"no-option":o(()=>[t(Y,null,{default:o(()=>[t(z,{class:"text-grey"},{default:o(()=>[w(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter"])]),t(L,{filled:"",square:"",modelValue:s.value,"onUpdate:modelValue":i[3]||(i[3]=m=>s.value=m),type:"number",label:"Tickets"},null,8,["modelValue"]),t(L,{filled:"",square:"",type:"number",modelValue:a.value,"onUpdate:modelValue":i[4]||(i[4]=m=>a.value=m),label:"Ticket Price"},null,8,["modelValue"])]),_:1}),t(Me),t(j,null,{default:o(()=>[t(E,{class:"row",color:"primary",onClick:i[5]||(i[5]=m=>r())},{default:o(()=>[w("Create")]),_:1})]),_:1})]),_:1}))}}),pa={class:"row shadow-2"},ga={key:0,class:"row"},va={key:1,class:"q-mx-md q-mt-md"},Ra=C({__name:"RafflePage",setup(e){const l=p("raffle");return ve(async()=>{await R().update_raffles(),await ee().update_accounts()}),(u,s)=>S($)().publicKey.value?(_(),k(Te,{key:1,class:"col"},{default:o(()=>[P("div",pa,[t(tt,{modelValue:l.value,"onUpdate:modelValue":s[0]||(s[0]=a=>l.value=a),"no-caps":"","outside-arrows":"","mobile-arrows":"",class:"col"},{default:o(()=>[t(ue,{name:"raffle",label:"Raffle"}),S(h)().is_admin?(_(),k(ue,{key:0,name:"create",label:"Create"})):A("",!0),S(h)().is_admin?(_(),k(ue,{key:1,name:"manage",label:"Manage"})):A("",!0)]),_:1},8,["modelValue"]),t(E,{flat:"",icon:"refresh",onClick:s[1]||(s[1]=a=>S(R)().update_raffles().then(()=>{}))})]),S(R)().is_loading?(_(),D("div",ga,[t(re),t(gt,{class:"row",color:"primary",size:"10rem"}),t(re)])):A("",!0),S(R)().raffles&&!S(R)().is_loading?(_(),D("div",va,[l.value==="raffle"?(_(),k(Qe,{key:0,raffles:S(R)().get_running_raffles,is_admin:!1},null,8,["raffles"])):A("",!0),l.value==="create"?(_(),k(ma,{key:1})):A("",!0),l.value==="manage"?(_(),k(Qe,{key:2,raffles:S(R)().raffles,is_admin:S(h)().is_admin},null,8,["raffles","is_admin"])):A("",!0)])):A("",!0)]),_:1})):(_(),k(Te,{key:0,class:"row items-center justify-center"},{default:o(()=>[t(S(ft),{dark:""})]),_:1}))}});export{Ra as default};
