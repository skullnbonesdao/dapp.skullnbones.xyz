import{a as ue,Q as rt}from"./QTabs.d751e0da.js";import{aF as T,bZ as me,dj as it,dk as ct,dl as ut,de as Q,au as x,J as v,b1 as m,ak as j,al as g,as as t,cl as O,cP as K,P as _,co as W,cR as $,cr as F,dm as pe,cT as E,ah as M,bs as te,aT as xe,cc as Se,c7 as Te,bC as ft,aC as Ie,b_ as Be,cd as dt,ar as C,bx as c,V as b,cm as mt,cU as pt,aX as le,bz as vt,a6 as je,cX as Y,dn as yt,ai as y,a1 as D,dp as gt,cY as kt,cZ as ve,b9 as ht,aj as w,dq as wt,cn as ee,dr as se,cQ as fe,c_ as bt,cq as oe}from"./index.4721e351.js";import{Q as ae}from"./QSpace.5d0ae9dc.js";import{Q as _t}from"./QPage.7c1976cc.js";import{f as Ee,Q as xt,a as ye,b as $e,c as St}from"./calcAmountToTransfer.20bab1e4.js";import{Q as Ue}from"./QImg.4ec0a146.js";import{Q as V}from"./QCardSection.e7848005.js";import{Q as B}from"./QSeparator.74bfb807.js";import{Q as J,a as N}from"./QItem.cba83b08.js";import{v as Tt,u as $t,j as At,w as Ae,x as Pt,e as Ct,k as qt,y as Rt,z as Qt,f as Vt,l as Ot,A as Pe,B as Mt,c as Ce,g as zt,C as qe,D as It,Q as I}from"./QMenu.081dbadb.js";import{Q as Bt}from"./QList.e77e4065.js";import{Q as ne,u as jt,a as Et}from"./QCard.4bb5403c.js";import{Q as De}from"./QCardActions.e87ea4f4.js";import{Q as L}from"./QInput.01791add.js";import{h as z}from"./handleTransaction.9580924e.js";import{_ as Ne,c as Le}from"./TokenSelectDropdown.addd5878.js";import{a as Ut,u as Dt}from"./rtl.235e815a.js";import{_ as Nt}from"./AccountBalance.f1cf9e01.js";import{c as Lt,Q as Kt}from"./QSelect.d3f1f906.js";import{C as Wt}from"./ClosePopup.8b4cc187.js";import{Q as Re}from"./QBadge.2ade2561.js";import{t as Ke}from"./token.d4101545.js";import{g as We}from"./extensionType.c4664b51.js";import{f as de}from"./format_address.d3022ffc.js";import{_ as Ht}from"./plugin-vue_export-helper.21dcd24c.js";import"./uid.42677368.js";import"./QSlideTransition.411f1ed0.js";import"./use-checkbox.aebcc91d.js";import"./use-form.4703a45f.js";import"./use-key-composition.5c234a38.js";import"./vaultTransactionCreate.7be7a381.js";import"./errors.825970a3.js";import"./web3.750add45.js";import"./bigint.126cd852.js";const Ft=[T("rect",{x:"0",y:"0",width:"100",height:"100",fill:"none"}),T("g",{transform:"translate(25 25)"},[T("rect",{x:"-20",y:"-20",width:"40",height:"40",fill:"currentColor",opacity:"0.9"},[T("animateTransform",{attributeName:"transform",type:"scale",from:"1.5",to:"1",repeatCount:"indefinite",begin:"0s",dur:"1s",calcMode:"spline",keySplines:"0.2 0.8 0.2 0.8",keyTimes:"0;1"})])]),T("g",{transform:"translate(75 25)"},[T("rect",{x:"-20",y:"-20",width:"40",height:"40",fill:"currentColor",opacity:"0.8"},[T("animateTransform",{attributeName:"transform",type:"scale",from:"1.5",to:"1",repeatCount:"indefinite",begin:"0.1s",dur:"1s",calcMode:"spline",keySplines:"0.2 0.8 0.2 0.8",keyTimes:"0;1"})])]),T("g",{transform:"translate(25 75)"},[T("rect",{x:"-20",y:"-20",width:"40",height:"40",fill:"currentColor",opacity:"0.7"},[T("animateTransform",{attributeName:"transform",type:"scale",from:"1.5",to:"1",repeatCount:"indefinite",begin:"0.3s",dur:"1s",calcMode:"spline",keySplines:"0.2 0.8 0.2 0.8",keyTimes:"0;1"})])]),T("g",{transform:"translate(75 75)"},[T("rect",{x:"-20",y:"-20",width:"40",height:"40",fill:"currentColor",opacity:"0.6"},[T("animateTransform",{attributeName:"transform",type:"scale",from:"1.5",to:"1",repeatCount:"indefinite",begin:"0.2s",dur:"1s",calcMode:"spline",keySplines:"0.2 0.8 0.2 0.8",keyTimes:"0;1"})])])];var Gt=me({name:"QSpinnerCube",props:it,setup(e){const{cSize:a,classes:i}=ct(e);return()=>T("svg",{class:i.value,width:a.value,height:a.value,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid"},Ft)}});const A=ut("raffleStore",{state:()=>({raffles:[]}),getters:{getRunningRaffles(e){return e.raffles.filter(a=>Object.keys(a.account.state)[0]=="running"||Object.keys(a.account.state)[0]=="full"||Object.keys(a.account.state)[0]=="claimprize")}},actions:{async updateStore(){if(Q())try{const e=Q().pg_raffle.value;this.raffles=await(e==null?void 0:e.account.raffle.all()),console.log("[Updated] RaffleStore")}catch(e){console.error(e)}}}}),Yt={class:"col q-pa-sm"},Xt=g("p",{class:"text-overline"},"Add a prize:",-1),Zt={class:"col q-gutter-y-sm"},Jt={class:"row"},ea=x({__name:"RafflePrepare",props:["raffle"],setup(e){const a=v(1),i=v(""),o=v(""),n=e;v([]);async function l(){var s,r,d,p;try{const u=new K,f=(s=Q())==null?void 0:s.pg_raffle.value,k=new _(o.value.mint),h=(await W().connection.getParsedTokenAccountsByOwner($(),{mint:k})).value[0].pubkey,P=new _(n.raffle.publicKey.toString()),q=await W().connection.getParsedAccountInfo(k);console.log((r=q.value)==null?void 0:r.data.parsed.info.decimals),i.value=((d=F().token_list.find(S=>S.address==k))==null?void 0:d.logoURI)??"",u.add(await(f==null?void 0:f.methods.prepare(new pe(a.value*Math.pow(10,(p=q.value)==null?void 0:p.data.parsed.info.decimals)),i.value).accountsPartial({creator:$(),raffle:P,from:h,prizeMint:k}).instruction())),await z(u,"[Raffle] prepare"),await A().updateStore()}catch(u){E.create({color:"red",message:`${u}`,timeout:5e3})}}return(s,r)=>(m(),j("div",Yt,[Xt,g("div",Zt,[t(Ne,{label:"","textbox-label":"Select prize",onToken_account_selected:r[0]||(r[0]=d=>o.value=d)}),g("div",Jt,[t(L,{class:"col",filled:"",square:"",modelValue:a.value,"onUpdate:modelValue":r[1]||(r[1]=d=>a.value=d),type:"number",label:"Count"},null,8,["modelValue"]),t(O,{filled:"",square:"",class:"col-2",color:"primary",icon:"send",onClick:r[2]||(r[2]=d=>l())})])])]))}});var ta=me({name:"QTooltip",inheritAttrs:!1,props:{...Tt,...$t,...At,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{default:"jump-down"},transitionHide:{default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:Ae},self:{type:String,default:"top middle",validator:Ae},offset:{type:Array,default:()=>[14,14],validator:Pt},scrollTarget:{default:void 0},delay:{type:Number,default:0},hideDelay:{type:Number,default:0}},emits:[...Ct],setup(e,{slots:a,emit:i,attrs:o}){let n,l;const s=Ie(),{proxy:{$q:r}}=s,d=v(null),p=v(!1),u=M(()=>qe(e.anchor,r.lang.rtl)),f=M(()=>qe(e.self,r.lang.rtl)),k=M(()=>e.persistent!==!0),{registerTick:h,removeTick:P}=Ut(),{registerTimeout:q}=Dt(),{transitionProps:S,transitionStyle:G}=qt(e),{localScrollTarget:ge,changeScrollEvent:Ge,unconfigureScrollTarget:Ye}=Rt(e,be),{anchorEl:U,canShow:Xe,anchorEvents:X}=Qt({showing:p,configureAnchorEl:lt}),{show:Ze,hide:ie}=Vt({showing:p,canShow:Xe,handleShow:et,handleHide:tt,hideOnRouteChange:k,processOnMount:!0});Object.assign(X,{delayShow:at,delayHide:nt});const{showPortal:ke,hidePortal:he,renderPortal:Je}=Ot(s,d,ot,"tooltip");if(r.platform.is.mobile===!0){const R={anchorEl:U,innerRef:d,onClickOutside(H){return ie(H),H.target.classList.contains("q-dialog__backdrop")&&dt(H),!0}},ce=M(()=>e.modelValue===null&&e.persistent!==!0&&p.value===!0);te(ce,H=>{(H===!0?It:Pe)(R)}),xe(()=>{Pe(R)})}function et(R){ke(),h(()=>{l=new MutationObserver(()=>Z()),l.observe(d.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),Z(),be()}),n===void 0&&(n=te(()=>r.screen.width+"|"+r.screen.height+"|"+e.self+"|"+e.anchor+"|"+r.lang.rtl,Z)),q(()=>{ke(!0),i("show",R)},e.transitionDuration)}function tt(R){P(),he(),we(),q(()=>{he(!0),i("hide",R)},e.transitionDuration)}function we(){l!==void 0&&(l.disconnect(),l=void 0),n!==void 0&&(n(),n=void 0),Ye(),Se(X,"tooltipTemp")}function Z(){Mt({targetEl:d.value,offset:e.offset,anchorEl:U.value,anchorOrigin:u.value,selfOrigin:f.value,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function at(R){if(r.platform.is.mobile===!0){Ce(),document.body.classList.add("non-selectable");const ce=U.value,H=["touchmove","touchcancel","touchend","click"].map(_e=>[ce,_e,"delayHide","passiveCapture"]);Te(X,"tooltipTemp",H)}q(()=>{Ze(R)},e.delay)}function nt(R){r.platform.is.mobile===!0&&(Se(X,"tooltipTemp"),Ce(),setTimeout(()=>{document.body.classList.remove("non-selectable")},10)),q(()=>{ie(R)},e.hideDelay)}function lt(){if(e.noParentEvent===!0||U.value===null)return;const R=r.platform.is.mobile===!0?[[U.value,"touchstart","delayShow","passive"]]:[[U.value,"mouseenter","delayShow","passive"],[U.value,"mouseleave","delayHide","passive"]];Te(X,"anchor",R)}function be(){if(U.value!==null||e.scrollTarget!==void 0){ge.value=zt(U.value,e.scrollTarget);const R=e.noParentEvent===!0?Z:ie;Ge(ge.value,R)}}function st(){return p.value===!0?T("div",{...o,ref:d,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",o.class],style:[o.style,G.value],role:"tooltip"},Be(a.default)):null}function ot(){return T(ft,S.value,st)}return xe(we),Object.assign(s.proxy,{updatePosition:Z}),Je}});const aa={key:0,class:"col q-pa-sm q-gutter-y-sm"},na=g("p",{class:"text-overline"},"Buy Ticket(s)",-1),la={class:"row"},sa={class:"row"},oa={class:"text-caption text-right text-weight-thin"},ra={class:"col"},ia={key:1,class:"row full-width justify-center"},ca=x({__name:"RaffleBuyTicket",props:["raffle","tickets"],setup(e){const a=v(),i=e,o=M(()=>!pt().publicKey.value);async function n(){var k,h,P;const l=new K,s=(k=Q())==null?void 0:k.pg_raffle.value,r=(h=Q())==null?void 0:h.pg_whitelist.value,d=new _(i.raffle.account.ticketMint.toString()),p=(await W().connection.getParsedTokenAccountsByOwner($(),{mint:d})).value[0].pubkey,u=new _(i.raffle.publicKey.toString());let f=Ee();try{l.add(await(s==null?void 0:s.methods.buyTickets(new pe(a.value)).accountsPartial({signer:$(),raffle:u,entrant:$(),ticketsMint:d,from:p,whitelist:f,whitelistEntry:_.findProgramAddressSync([(P=$())==null?void 0:P.toBytes(),f.toBytes()],r==null?void 0:r.programId)[0],whitelistProgram:r==null?void 0:r.programId}).instruction())),await z(l,"[Raffle] buy ticket"),await A().updateStore()}catch(q){E.create({color:"danger",message:`${q}`,timeout:5e3})}}return(l,s)=>o.value?(m(),j("div",ia,[t(b(mt),{class:"",dark:""})])):(m(),j("div",aa,[na,g("div",la,[t(L,{square:"",filled:"",outlined:"",type:"number",class:"col",label:"Amount",modelValue:a.value,"onUpdate:modelValue":s[0]||(s[0]=r=>a.value=r)},null,8,["modelValue"]),t(O,{square:"",disable:!a.value,color:"primary",icon:"send",onClick:s[1]||(s[1]=r=>n())},null,8,["disable"])]),g("div",sa,[t(ae),g("p",oa,[C(" 0.001\u25CE fee "),t(ta,{anchor:"bottom right",self:"top middle"},{default:c(()=>[C(" cover deployment costs ")]),_:1})])]),g("div",ra,[t(Nt,{mint:e.raffle.account.ticketMint},null,8,["mint"])])]))}}),ua=g("source",{src:"Burningticket.mp4",type:"video/mp4"},null,-1),fa=x({__name:"BurningTicket",setup(e){const a=v();return le(()=>{a.value.playbackRate=.3,console.log(a.value)}),(i,o)=>(m(),j("video",{ref_key:"ticket_burning",ref:a,autoplay:"",playbackspeed:"0.1"},[ua,C(" Your browser does not support the video tag. ")],512))}}),da=g("div",{class:"text-h6 text-center"},"Drawing...",-1),ma=x({__name:"RaffleRevealWinner",props:["raffle","is_admin"],setup(e){v();const a=e,i=v(!1);te(()=>i.value,()=>{i.value==!1&&A().updateStore()});async function o(){var n;try{const l=new K,s=(n=Q())==null?void 0:n.pg_raffle.value,r=new _(a.raffle.publicKey.toString());let[d,p]=_.findProgramAddressSync([Y("tickets"),r.toBytes()],s==null?void 0:s.programId);l.add(await(s==null?void 0:s.methods.revealWinners().accounts({raffle:r,tickets:d,recentBlockHashes:yt}).instruction())),await z(l,"[Raffle] reveal winner"),i.value=!0}catch(l){E.create({color:"red",message:`${l}`,timeout:5e3})}}return(n,l)=>(m(),j(je,null,[t(O,{square:"",class:"row",color:"primary",icon:"send",label:"Reveal Winner",onClick:l[0]||(l[0]=s=>o())}),t(Lt,{maximized:!0,modelValue:i.value,"onUpdate:modelValue":l[2]||(l[2]=s=>i.value=s)},{default:c(()=>[t(ne,{flat:"",square:"",class:""},{default:c(()=>[t(V,null,{default:c(()=>[da]),_:1}),t(V,{class:"q-pt-none row"},{default:c(()=>[t(ae),t(fa),t(ae)]),_:1}),t(De,{align:"right"},{default:c(()=>[vt(t(O,{flat:"",label:"close",color:"primary",onClick:l[1]||(l[1]=s=>b(A)().update_raffles())},null,512),[[Wt]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),pa={class:"absolute-full flex flex-center"};var He=(e=>(e.created="orange",e.ready="orange",e.paused="pink",e.full="purple",e.claimprize="purple",e.claimtickets="purple",e.running="primary",e))(He||{});const va=x({__name:"RaffleStateBadge",props:["raffle","tickets"],setup(e){const a=e,i=M(()=>{var o,n;return((o=a.tickets)==null?void 0:o.sold)/((n=a.tickets)==null?void 0:n.total)});return(o,n)=>Object.keys(e.raffle.account.state)[0]=="running"?(m(),y(xt,{key:0,size:"25px",value:i.value,color:"primary"},{default:c(()=>{var l,s;return[g("div",pa,[t(Re,{color:"black","text-color":"primary",label:`Tickets: ${(l=e.tickets)==null?void 0:l.sold}/${(s=e.tickets)==null?void 0:s.total}`},null,8,["label"])])]}),_:1},8,["value"])):(m(),y(Re,{key:1,color:He[Object.keys(e.raffle.account.state)[0]],class:"text-h6 justify-center full-width"},{default:c(()=>[C(D(Object.keys(e.raffle.account.state)[0].toUpperCase()),1)]),_:1},8,["color"]))}}),re=new _(gt.address);function ya(e,a){return _.findProgramAddressSync([Y("raffle"),Y(e),a.toArrayLike(kt.Buffer).reverse()],re)[0]}function ga(e){return _.findProgramAddressSync([Y("tickets"),e.toBytes()],re)[0]}function Fe(e){return _.findProgramAddressSync([Y("vaultPrize"),e.toBytes()],re)[0]}function ka(e){return _.findProgramAddressSync([Y("vaultTickets"),e.toBytes()],re)[0]}const ha=x({__name:"RaffleClaimPrize",props:["raffle","is_admin"],setup(e){const a=e;async function i(){var o;try{let n=new K;const l=(o=Q())==null?void 0:o.pg_raffle.value,s=new _(a.raffle.account.prizeMint.toString()),r=new _(a.raffle.account.winner.toString()),d=await We(s,r,!0,ve,Ke.ASSOCIATED_PROGRAM_ID);await W().connection.getAccountInfo(d)===null&&n.add(Le($(),d,r,s));const p=new _(a.raffle.publicKey.toString()),u=Fe(p);n.add(await(l==null?void 0:l.methods.claimPrize().accountsPartial({raffle:p,prizeMint:s,prizeVault:u,to:d}).instruction())),await z(n,"[Raffle] Claim Prize"),await A().updateStore()}catch(n){E.create({color:"red",message:`${n}`,timeout:5e3,position:"bottom-right"})}}return(o,n)=>(m(),y(O,{color:"primary",icon:"send",label:"Claim Prize",onClick:n[0]||(n[0]=l=>i())}))}});async function wa(e){try{return!!await W().connection.getAccountInfo(e)}catch(a){return console.error("Error checking account:",a),!1}}const ba=x({__name:"RaffleClose",props:["raffle"],setup(e){const a=e;async function i(){var o;try{const n=new K,l=(o=Q())==null?void 0:o.pg_raffle.value;let s=a.raffle.publicKey;const r=ga(s),d=ka(s);let p=Fe(s);await wa(p)||(p=null),n.add(await(l==null?void 0:l.methods.close().accountsPartial({creator:$(),raffle:s,tickets:r,ticketsVault:d,prizeVault:p}).instruction())),await z(n,"[Raffle] close"),await A().updateStore()}catch(n){E.create({color:"red",message:`${n}`,timeout:5e3})}}return(o,n)=>(m(),y(O,{square:"",color:"primary",icon:"send",label:"Close Raffle",onClick:n[0]||(n[0]=l=>i())}))}}),_a=x({__name:"RaffleClaimTickets",props:["raffle","is_admin"],setup(e){const a=e;async function i(){var o;try{const n=new K,l=(o=Q())==null?void 0:o.pg_raffle.value,s=new _(a.raffle.account.ticketMint.toString()),r=await We(s,$(),!0,ve,Ke.ASSOCIATED_PROGRAM_ID);await W().connection.getAccountInfo(r)===null&&n.add(Le($(),r,$(),s)),n.add(await(l==null?void 0:l.methods.claimTickets().accountsPartial({creator:$(),raffle:a.raffle.publicKey,ticketsMint:s,to:r}).instruction())),await z(n,"[Raffle Claim Tickets]"),await A().updateStore()}catch(n){E.create({color:"red",message:`${n}`,timeout:5e3,position:"bottom-right"})}}return(o,n)=>(m(),y(O,{color:"primary",icon:"send",label:"Claim Tickets",onClick:n[0]||(n[0]=l=>i())}))}}),xa=x({__name:"AccountsTable",props:["accounts"],setup(e){const a=v({rowsPerPage:0}),i=v([{name:"mint",required:!0,label:"Mint",align:"left",field:"mint",field:o=>{var n,l;return((n=F().token_list.find(s=>{var r;return s.address==((r=o.mint)==null?void 0:r.toString())}))==null?void 0:n.name)??((l=o.mint)==null?void 0:l.toString())},sortable:!0},{name:"calories",align:"right",label:"Amount",field:o=>o.tokenAmount.uiAmount,sortable:!0}]);return(o,n)=>{var l,s;return m(),y(ye,{square:"",dense:"",class:"col",title:"Accounts",rows:(s=(l=e.accounts)==null?void 0:l.value)==null?void 0:s.map(r=>r.account.data.parsed.info),columns:i.value,"row-key":"mint","hide-bottom":"",flat:"",pagination:a.value,"onUpdate:pagination":n[0]||(n[0]=r=>a.value=r),"rows-per-page-options":[0]},null,8,["rows","columns","pagination"])}}}),Qe=9,Sa=95,Ta=45,Ve=5;function $a(e){return e.split("").reduce((a,i)=>(a^i.charCodeAt(0))*-Ve,Ve)>>>2}function Aa(e="",a=Sa,i=Ta,o=$a){const n=o(e),l=n%Qe*(360/Qe);return[...Array(e?25:0)].reduce((s,r,d)=>n&1<<d%15?s+`<rect x="${d>14?7-~~(d/5):~~(d/5)}" y="${d%5}" width="1" height="1"/>`:s,`<svg viewBox="-1.5 -1.5 8 8" xmlns="http://www.w3.org/2000/svg" fill="hsl(${l} ${a}% ${i}%)">`)+"</svg>"}const Pa=["innerHTML"],Ca=x({__name:"IconFromSeed",props:{seed:{type:String,default:"default"}},setup(e){const i=v(Aa(e.seed));return(o,n)=>(m(),j("div",{innerHTML:i.value},null,8,Pa))}}),qa=["text","rect","circle","QBtn","QBadge","QChip","QToolbar","QCheckbox","QRadio","QToggle","QSlider","QRange","QInput","QAvatar"],Ra=["wave","pulse","pulse-x","pulse-y","fade","blink","none"];var Qa=me({name:"QSkeleton",props:{...jt,tag:{type:String,default:"div"},type:{type:String,validator:e=>qa.includes(e),default:"rect"},animation:{type:String,validator:e=>Ra.includes(e),default:"wave"},animationSpeed:{type:[String,Number],default:1500},square:Boolean,bordered:Boolean,size:String,width:String,height:String},setup(e,{slots:a}){const i=Ie(),o=Et(e,i.proxy.$q),n=M(()=>{const s=e.size!==void 0?[e.size,e.size]:[e.width,e.height];return{"--q-skeleton-speed":`${e.animationSpeed}ms`,width:s[0],height:s[1]}}),l=M(()=>`q-skeleton q-skeleton--${o.value===!0?"dark":"light"} q-skeleton--type-${e.type}`+(e.animation!=="none"?` q-skeleton--anim q-skeleton--anim-${e.animation}`:"")+(e.square===!0?" q-skeleton--square":"")+(e.bordered===!0?" q-skeleton--bordered":""));return()=>T(e.tag,{class:l.value,style:n.value},Be(a.default))}});const Va=x({__name:"Apex_TicketsChart",props:["data_value","data_label"],setup(e){const a=e,i=M(()=>a.data_value?a.data_value:[44,55,41,17,15]),o=M(()=>a.data_label?{legend:{labels:{colors:"white"},position:"left"},theme:{palette:"palette3"},labels:a.data_label}:{labels:["Apple","Mango","Orange","Watermelon"]});return(n,l)=>{const s=ht("apexchart");return e.data_value&&e.data_label?(m(),y(s,{key:0,height:"200px",type:"donut",options:o.value,series:i.value},null,8,["options","series"])):w("",!0)}}}),Oa=x({__name:"TicketsTable",props:["raffle","ticketsAccount"],setup(e){const a=e,i=v({rowsPerPage:0}),o=v();le(async()=>{console.log(a.raffle),await n()}),te(()=>a.ticketsAccount,async()=>{await n(),await u()});async function n(){if(!a.ticketsAccount)return;const{pg_raffle:f}=Q(),k=await f.value.account.tickets.getAccountInfo(a.raffle.account.tickets);let h=[];for(let S=0;S<a.ticketsAccount.total;S++){let G=l(k.data,S);h.push(G)}const q=h.map(S=>S.toString()).reduce((S,G)=>({...S,[G]:(S[G]||0)+1}),{});o.value=Object.entries(q).flatMap(S=>({address:S[0],amount:S[1]}))}function l(f,k){const h=16+32*k,P=h+32,q=f.slice(h,P);return new _(q)}v();const s=v([{name:"wallet",required:!0,label:"Wallet",align:"left",field:f=>de(f.address),sortable:!0},{name:"amount",align:"right",label:"Amount",field:"amount",sortable:!0}]),r=v(),d=v(),p=v(!0);async function u(){var k,h;r.value=(k=o.value)==null?void 0:k.map(P=>P.amount);const f=(h=o.value)==null?void 0:h.flatMap(P=>de(P.address));d.value=f,p.value=!1}return(f,k)=>(m(),j(je,null,[t(ye,{square:"",dense:"",class:"col",title:"Tickets",rows:o.value,columns:s.value,"row-key":"mint","hide-bottom":"",flat:"",pagination:i.value,"onUpdate:pagination":k[0]||(k[0]=h=>i.value=h),"rows-per-page-options":[0]},null,8,["rows","columns","pagination"]),p.value?(m(),y(Qa,{key:0,type:"QInput"})):w("",!0),t(Va,{data_value:r.value,data_label:d.value},null,8,["data_value","data_label"])],64))}}),Ma={};function za(e,a){return m(),y(wt,{size:"xs"},{default:c(()=>[t(Ue,{src:"solscan.png"})]),_:1})}var Oe=Ht(Ma,[["render",za]]);const Ia=g("div",{class:"col q-gutter-y-sm"},[g("div",null,"Raffle account"),g("div",null,"Entrants account"),g("div",null,"Use Whitelist?")],-1),Ba={class:"col q-gutter-y-sm"},ja=x({__name:"RaffleLinks",props:["raffle","entrants"],setup(e){const a=e;return v({rowsPerPage:0}),(i,o)=>(m(),y(ne,{flat:"",square:"",class:"row items-center q-pa-md"},{default:c(()=>[Ia,g("div",Ba,[t(O,{class:"full-width",size:"xs",square:"",color:"primary",href:"https://solscan.io/account/"+a.raffle.publicKey,target:"_blank"},{default:c(()=>[t(Oe)]),_:1},8,["href"]),t(O,{class:"full-width",square:"",size:"xs",color:"primary",href:"https://solscan.io/account/"+a.raffle.account.entrants,target:"_blank"},{default:c(()=>[t(Oe)]),_:1},8,["href"]),e.raffle.account.useWhitelist?(m(),y(ee,{key:0,name:"check"})):(m(),y(ee,{key:1,name:"clear"}))])]),_:1}))}}),Ea=x({__name:"RaffleToggleMode",props:["raffle"],setup(e){const a=e;async function i(){var o;try{const n=new K,l=(o=Q())==null?void 0:o.pg_raffle.value;let s=await(l==null?void 0:l.account.raffle.fetch(a.raffle.publicKey));console.log(s),console.log(Object.keys(s.state)[0]);let r;switch(Object.keys(s.state)[0]){case"ready":n.add(await(l==null?void 0:l.methods.enable().accountsPartial({creator:$(),raffle:a.raffle.publicKey}).instruction())),await z(n,"[Raffle] enable");break;case"paused":n.add(await(l==null?void 0:l.methods.enable().accountsPartial({creator:$(),raffle:a.raffle.publicKey}).instruction())),await z(n,"[Raffle] enable");break;case"running":n.add(await(l==null?void 0:l.methods.disable().accountsPartial({creator:$(),raffle:a.raffle.publicKey}).instruction())),await z(n,"[Raffle] disable");break}await A().updateStore()}catch(n){E.create({color:"red",message:`${n}`,timeout:5e3})}}return(o,n)=>(m(),y(O,{icon:"send",label:"Start/Pause",square:"",color:"primary",onClick:n[0]||(n[0]=l=>i())}))}}),Ua=x({__name:"RaffleEdit",props:["raffle"],setup(e){const a=v(""),i=v(""),o=v(""),n=e;le(()=>{a.value=n.raffle.account.name,i.value=n.raffle.account.description,o.value=n.raffle.account.url});async function l(){var d;const s=new K,r=(d=Q())==null?void 0:d.pg_raffle.value;try{s.add(await(r==null?void 0:r.methods.edit(a.value,i.value,o.value).accountsPartial({creator:$(),raffle:n.raffle.publicKey}).instruction())),await z(s,"[Raffle] update"),await A().updateStore()}catch(p){E.create({color:"danger",message:`${p}`,timeout:5e3})}}return(s,r)=>(m(),j("div",null,[t(L,{square:"",filled:"",label:"Name",modelValue:a.value,"onUpdate:modelValue":r[0]||(r[0]=d=>a.value=d)},null,8,["modelValue"]),t(L,{square:"",filled:"",label:"Description",modelValue:i.value,"onUpdate:modelValue":r[1]||(r[1]=d=>i.value=d)},null,8,["modelValue"]),t(L,{square:"",filled:"",label:"Image-URL",modelValue:o.value,"onUpdate:modelValue":r[2]||(r[2]=d=>o.value=d)},null,8,["modelValue"]),t(O,{square:"",class:"full-width",color:"primary",label:"Update",onClick:r[3]||(r[3]=d=>l())})]))}});async function Me(e){try{await navigator.clipboard.writeText(e),E.create({message:`Clipboard: ${e}`,position:"bottom-right",type:"info"})}catch{alert("Cannot copy")}}const Da={class:"text-h5 q-mt-sm q-mb-xs"},Na={class:"text-caption text-grey"},La=g("p",{class:"text-overline"},"Actions",-1),Ka={class:"col row justify-end q-mx-sm"},Wa=x({__name:"RaffleCard",props:["raffle","is_admin"],setup(e){const a=e,i=v(),o=v(),n=v();async function l(){const{pg_raffle:d}=Q();i.value=await d.value.account.tickets.fetch(a.raffle.account.tickets)}async function s(){o.value=await W().connection.getParsedTokenAccountsByOwner(a.raffle.publicKey,{programId:ve})}le(async()=>{await se(l),await se(s)}),te(()=>a.raffle,async()=>{await se(l),await se(s)});const r=M(()=>a.raffle.account.url.length>0?a.raffle.account.url.toString():"unknown.svg");return(d,p)=>(m(),y(ne,{square:"",flat:""},{default:c(()=>[t(Ue,{height:"200px",src:r.value},null,8,["src"]),t(V,null,{default:c(()=>[t(va,{raffle:e.raffle,tickets:i.value},null,8,["raffle","tickets"]),g("div",Da,D(e.raffle.account.name),1),g("div",Na,D(e.raffle.account.description),1)]),_:1}),t(B),t(V,null,{default:c(()=>[t(Bt,null,{default:c(()=>[t(J,{clickable:""},{default:c(()=>[t(N,{avatar:""},{default:c(()=>[t(ee,{color:"primary",name:"functions"})]),_:1}),t(N,null,{default:c(()=>[t(I,{class:"text-h6"},{default:c(()=>{var u;return[C(D((u=i.value)==null?void 0:u.total)+" Tickets",1)]}),_:1}),t(I,{class:"text-accent",caption:""},{default:c(()=>[C("Total tickets")]),_:1})]),_:1})]),_:1}),t(J,{clickable:""},{default:c(()=>[t(N,{avatar:""},{default:c(()=>[t(ee,{color:"red",name:"paid"})]),_:1}),t(N,null,{default:c(()=>[t(I,{class:"text-h6"},{default:c(()=>{var u;return[C(D((e.raffle.account.ticketPrice.toNumber()*Math.pow(10,-e.raffle.account.ticketDecimals)).toFixed(2))+" "+D((u=b(fe)().tokenList.find(f=>f.address==e.raffle.account.ticketMint.toString()))==null?void 0:u.symbol),1)]}),_:1}),t(I,{class:"text-accent",caption:""},{default:c(()=>[C("Price per ticket")]),_:1})]),_:1})]),_:1}),t(J,{clickable:""},{default:c(()=>[t(N,{avatar:""},{default:c(()=>[t(ee,{color:"amber",name:"local_movies"})]),_:1}),t(N,{class:"q-gutter-y-md"},{default:c(()=>[g("div",{onClick:p[0]||(p[0]=u=>b(Me)(e.raffle.account.prizeMint.toString()))},[t(I,{class:"q-pt-md text-overline"},{default:c(()=>{var u;return[C(D(((u=b(fe)().tokenList.find(f=>f.address==e.raffle.account.prizeMint.toString()))==null?void 0:u.name)??e.raffle.account.ticketMint.toString()),1)]}),_:1}),t(I,{class:"text-accent",caption:""},{default:c(()=>[C("Prize-Mint")]),_:1})]),g("div",{onClick:p[1]||(p[1]=u=>b(Me)(e.raffle.account.ticketMint.toString()))},[t(I,{class:"text-overline"},{default:c(()=>{var u;return[C(D(((u=b(fe)().tokenList.find(f=>f.address==e.raffle.account.ticketMint.toString()))==null?void 0:u.name)??e.raffle.account.ticketMint.toString()),1)]}),_:1}),t(I,{class:"text-accent",caption:""},{default:c(()=>[C("Ticket-Mint")]),_:1})])]),_:1})]),_:1}),e.raffle.account.randomness!=null?(m(),y(J,{key:0,clickable:""},{default:c(()=>[t(N,{avatar:""},{default:c(()=>{var u,f;return[t(Ca,{style:{width:"100px"},seed:(f=(u=e.raffle.account)==null?void 0:u.winner)==null?void 0:f.toString()},null,8,["seed"])]}),_:1}),t(N,null,{default:c(()=>[t(I,{class:"text-h6",l:""},{default:c(()=>[C("Winner")]),_:1}),t(I,{class:"text-orange-9",caption:""},{default:c(()=>{var u;return[C(D(b(de)((u=e.raffle.account.winner)==null?void 0:u.toString())),1)]}),_:1})]),_:1})]),_:1})):w("",!0)]),_:1})]),_:1}),t(B),e.is_admin?(m(),y($e,{key:0,icon:"info",label:"Edit"},{default:c(()=>[t(Ua,{raffle:e.raffle},null,8,["raffle"])]),_:1})):w("",!0),e.is_admin?(m(),y(B,{key:1})):w("",!0),e.is_admin?w("",!0):(m(),y($e,{key:2,icon:"info",label:"Details"},{default:c(()=>[t(ne,{flat:""},{default:c(()=>[t(B),t(V,null,{default:c(()=>[t(xa,{accounts:o.value},null,8,["accounts"])]),_:1}),t(B),t(V,null,{default:c(()=>[t(Oa,{raffle:e.raffle,"tickets-account":i.value},null,8,["raffle","tickets-account"])]),_:1}),t(B),t(V,null,{default:c(()=>[t(ja,{raffle:e.raffle,entrants:n.value,class:"q-pb-md"},null,8,["raffle","entrants"])]),_:1})]),_:1})]),_:1})),t(B),e.is_admin?(m(),y(V,{key:3},{default:c(()=>[Object.keys(e.raffle.account.state)[0]=="created"?(m(),y(ea,{key:0,raffle:e.raffle},null,8,["raffle"])):w("",!0)]),_:1})):w("",!0),Object.keys(e.raffle.account.state)[0]=="running"&&!e.is_admin?(m(),y(De,{key:4},{default:c(()=>[t(ca,{raffle:e.raffle,tickets:i.value},null,8,["raffle","tickets"])]),_:1})):w("",!0),e.is_admin?(m(),y(V,{key:5,class:"col"},{default:c(()=>[La,g("div",Ka,[Object.keys(e.raffle.account.state)[0]=="full"?(m(),y(ma,{key:0,raffle:e.raffle},null,8,["raffle"])):w("",!0),Object.keys(e.raffle.account.state)[0]=="claimprize"||Object.keys(e.raffle.account.state)[0]=="ready"?(m(),y(ha,{key:1,raffle:e.raffle},null,8,["raffle"])):w("",!0),Object.keys(e.raffle.account.state)[0]=="claimtickets"?(m(),y(_a,{key:2,raffle:e.raffle},null,8,["raffle"])):w("",!0),Object.keys(e.raffle.account.state)[0]=="ready"||Object.keys(e.raffle.account.state)[0]=="running"||Object.keys(e.raffle.account.state)[0]=="paused"?(m(),y(Ea,{key:3,raffle:e.raffle},null,8,["raffle"])):w("",!0),Object.keys(e.raffle.account.state)[0]=="created"||Object.keys(e.raffle.account.state)[0]=="done"?(m(),y(ba,{key:4,raffle:e.raffle},null,8,["raffle"])):w("",!0)])]),_:1})):w("",!0)]),_:1}))}}),Ha={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},ze=x({__name:"RaffleGrid",props:{is_admin:{type:Boolean,default:!1},raffles:{type:[],default:[]},count:{type:Number,default:0}},setup(e){const a=e,i=M(()=>[0]),o=v({rowsPerPage:0});return(n,l)=>(m(),y(ye,{grid:"",rows:a.raffles,"row-key":"name","hide-header":"",pagination:o.value,"onUpdate:pagination":l[0]||(l[0]=s=>o.value=s),"rows-per-page-options":i.value},{item:c(s=>[g("div",Ha,[t(Wa,{is_admin:e.is_admin,raffle:s.row},null,8,["is_admin","raffle"])])]),_:1},8,["rows","pagination","rows-per-page-options"]))}}),Fa=g("p",{class:"text-h5"},"Raffle",-1),Ga=g("p",{class:"text-h5"},"Tickets",-1),Ya={class:""},Xa=g("p",{class:"text-h5"},"Whitelist",-1),Za={class:"col q-gutter-y-sm"},Ja=x({__name:"RaffleCreateRaffle",setup(e){const a=v(),i=v(),o=v(),n=v(),l=v();async function s(){var p,u;try{const f=new K,k=(p=Q())==null?void 0:p.pg_raffle.value,h=new pe(window.crypto.getRandomValues(new Uint8Array(8))),P=ya(a.value,h),q=Ee(),S=await W().connection.getParsedAccountInfo(new _(l.value.mint));f.add(await(k==null?void 0:k.methods.initialize(a.value,i.value,St(n.value,(u=S.value)==null?void 0:u.data.parsed.info.decimals),o.value,h).accountsPartial({creator:$(),raffle:P,ticketsMint:new _(l.value.mint),whitelist:oe().whitelistSelected.publicKey}).instruction())),await z(f,"[Raffle] Create"),await A().updateStore()}catch(f){E.create({color:"red",message:`${f}`,timeout:5e3})}}const r=v([]);return v(bt().accounts.filter(p=>p.account.data.parsed.info.tokenAmount.uiAmount>0).flatMap(p=>p.account.data.parsed.info.mint)).value.forEach(p=>{var f,k;const u=((f=F().token_list.find(h=>h.address==p))==null?void 0:f.name)??p+" ["+((k=F().token_list.find(h=>h.address==p))==null?void 0:k.symbol)??"]";r.value.push({label:u,value:p})}),(p,u)=>(m(),y(ne,{square:"",flat:"",class:"col q-pa-sm",style:{"max-width":"800px"}},{default:c(()=>[t(V,{class:"q-gutter-y-md"},{default:c(()=>[Fa,t(L,{filled:"",square:"",modelValue:a.value,"onUpdate:modelValue":u[0]||(u[0]=f=>a.value=f),type:"text",label:"Name"},null,8,["modelValue"]),t(L,{filled:"",square:"",modelValue:i.value,"onUpdate:modelValue":u[1]||(u[1]=f=>i.value=f),type:"text",label:"Description"},null,8,["modelValue"])]),_:1}),t(B),t(V,{class:"q-gutter-y-md"},{default:c(()=>[Ga,g("div",Ya,[t(Ne,{label:"","textbox-label":"Token",onToken_account_selected:u[2]||(u[2]=f=>l.value=f)})]),t(L,{filled:"",square:"",modelValue:o.value,"onUpdate:modelValue":u[3]||(u[3]=f=>o.value=f),type:"number",label:"Tickets Count"},null,8,["modelValue"]),t(L,{filled:"",square:"",type:"number",modelValue:n.value,"onUpdate:modelValue":u[4]||(u[4]=f=>n.value=f),label:"Ticket Price"},null,8,["modelValue"])]),_:1}),t(B),t(V,{class:"q-gutter-y-md"},{default:c(()=>[Xa,g("div",Za,[t(Kt,{class:"full-width",filled:"",square:"",modelValue:b(oe)().whitelistSelected,"onUpdate:modelValue":u[5]||(u[5]=f=>b(oe)().whitelistSelected=f),clearable:"","use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",behavior:"menu","option-label":f=>{var k;return(k=f.account)==null?void 0:k.name},label:"Whitelist selcted",options:b(oe)().whitelists,style:{width:"250px"}},{"no-option":c(()=>[t(J,null,{default:c(()=>[t(N,{class:"text-grey"},{default:c(()=>[C(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","option-label","options"])])]),_:1}),t(B),t(V,{class:"row justify-end"},{default:c(()=>[t(O,{icon:"send",square:"",class:"row",color:"primary",onClick:u[6]||(u[6]=f=>s()),label:"Create"})]),_:1})]),_:1}))}}),en={class:"row shadow-2"},tn={class:""},an={key:0,class:"row"},nn={key:2,class:"row justify-center"},jn=x({__name:"RafflePage",setup(e){const a=v("raffle");return le(async()=>{await A().updateStore()}),(i,o)=>(m(),y(_t,{class:"col bg-black"},{default:c(()=>[g("div",en,[t(rt,{modelValue:a.value,"onUpdate:modelValue":o[0]||(o[0]=n=>a.value=n),"no-caps":"","outside-arrows":"","mobile-arrows":"",class:"col bg-dark"},{default:c(()=>[t(ue,{name:"raffle",label:"Raffle"}),b(F)().is_admin?(m(),y(ue,{key:0,name:"create",label:"Create"})):w("",!0),b(F)().is_admin?(m(),y(ue,{key:1,name:"manage",label:"Manage"})):w("",!0)]),_:1},8,["modelValue"]),t(O,{flat:"",class:"bg-dark",icon:"refresh",onClick:o[1]||(o[1]=n=>b(A)().updateStore())})]),g("div",tn,[a.value==="raffle"&&b(A)().raffles.length==0?(m(),j("div",an,[t(ae),t(Gt,{class:"row",color:"primary",size:"10rem"}),t(ae)])):w("",!0),a.value==="raffle"&&b(A)().raffles.length>0?(m(),y(ze,{key:1,raffles:b(A)().getRunningRaffles,is_admin:!1},null,8,["raffles"])):w("",!0),a.value==="create"?(m(),j("div",nn,[t(Ja,{class:"q-mt-xl"})])):w("",!0),a.value==="manage"?(m(),y(ze,{key:3,raffles:b(A)().raffles,is_admin:b(F)().is_admin},null,8,["raffles","is_admin"])):w("",!0)])]),_:1}))}});export{jn as default};
