import{cU as V,cp as ke,cV as N,au as P,J as p,b1 as C,ak as $,as as n,bx as m,ar as Q,cm as D,dc as T,dd as Me,de as Se,df as W,aX as R,a6 as te,b7 as le,bz as H,ai as z,a1 as ae,P as G,bZ as Ue,aU as De,ah as q,bs as we,aF as w,aC as Re,aQ as He,cN as Oe,ct as je,co as ee,cd as xe,bT as Je,cC as pe,aj as Xe,al as Ye}from"./index.efa60c71.js";import{Q as Ze}from"./QCardSection.bf6bcf0b.js";import{Q as Ce}from"./QSeparator.976f9aad.js";import{Q as Ge,a as E}from"./QTabs.964a47da.js";import{Q as et,a as F}from"./QTabPanels.8933641b.js";import{u as tt,a as lt,Q as at}from"./use-form.f5bcce7a.js";import{Q as rt}from"./QPage.b9f1425f.js";import{Q as re}from"./QInput.ab94e026.js";import{Q as ne}from"./rtl.5064379e.js";import{a as ie,Q as oe}from"./QItem.304158e0.js";import{Q as ce}from"./QList.3fb8efb3.js";import{Q as se}from"./QBtnDropdown.4edca801.js";import{C as ue}from"./ClosePopup.b445c5f3.js";import{Q as nt}from"./QCheckbox.0181a097.js";import{Q as it}from"./QSlideTransition.f1a9b106.js";import"./use-key-composition.1356da64.js";import"./QResizeObserver.c088ddb6.js";import"./touch.3df10340.js";import"./use-checkbox.4553f507.js";async function O(l){const i=V.create({group:!1,timeout:10,spinner:!0,message:"Confirming tx..."}),u=await ke().connection.getLatestBlockhash();return await ke().connection.confirmTransaction({signature:l,blockhash:u.blockhash,lastValidBlockHeight:u.lastValidBlockHeight},"confirmed"),i({icon:"done",spinner:!1,color:"green",badgePosition:"bottom-right",message:"Signature confirmed!",timeout:2500}),!0}function j(){N().publicKey.value||V.create({color:"yellow",message:"Wallet not connected!",timeout:5e3})}const ot={class:"row"},ct=P({__name:"CreateWhitelist",setup(l){const i=p("");async function u(){j();const{pg_whitelist:_}=W();let[s,k]=T.findProgramAddressSync([N().publicKey.value.toBytes(),Me(i.value)],_.value.programId);try{const h=await _.value.methods.initialize(i.value).accounts({whitelist:s,systemProgram:Se.programId}).rpc();console.log(h),await O(h)}catch(h){V.create({color:"red",message:`${h}`,timeout:5e3})}}return(_,s)=>(C(),$("div",ot,[n(re,{label:"New whitelist name",filled:"",class:"col",modelValue:i.value,"onUpdate:modelValue":s[0]||(s[0]=k=>i.value=k)},null,8,["modelValue"]),n(D,{disable:i.value.length==0,square:"",color:"primary",onClick:s[1]||(s[1]=k=>u())},{default:m(()=>[Q("Create")]),_:1},8,["disable"])]))}}),st={class:"row"},ut=P({__name:"AddAddressToWhitelist",setup(l){const{pg_whitelist:i}=W(),u=p(""),_=p(),s=p();R(async()=>{_.value=await i.value.account.whitelist.all()});async function k(){j();const h=new G(s.value.publicKey.toString()),[d,y]=T.findProgramAddressSync([new G(u.value).toBytes(),h.toBytes()],i.value.programId);try{const c=new G(u.value),K=await i.value.methods.addToWhitelist(c).accounts({entry:d,whitelist:h,authority:N().publicKey.value,systemProgram:Se.programId}).rpc();console.log(K),await O(K)}catch(c){V.create({color:"red",message:`${c}`,timeout:5e3})}}return(h,d)=>{var y;return C(),$("div",st,[n(se,{color:"primary",square:"",label:((y=s.value)==null?void 0:y.account.name)??"please select a whitelist"},{default:m(()=>[n(ce,null,{default:m(()=>[(C(!0),$(te,null,le(_.value,c=>H((C(),z(oe,{clickable:"",key:c,onClick:K=>s.value=c},{default:m(()=>[n(ie,null,{default:m(()=>[n(ne,null,{default:m(()=>[Q(ae(c==null?void 0:c.account.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[ue]])),128))]),_:1})]),_:1},8,["label"]),n(re,{class:"col",filled:"",modelValue:u.value,"onUpdate:modelValue":d[0]||(d[0]=c=>u.value=c),label:"Address to be added"},null,8,["modelValue"]),n(D,{disable:u.value.length==0,square:"",color:"primary",onClick:d[1]||(d[1]=c=>k())},{default:m(()=>[Q("Add")]),_:1},8,["disable"])])}}}),dt=["none","strict","leaf","leaf-filtered"];var ft=Ue({name:"QTree",props:{...tt,nodes:{type:Array,required:!0},nodeKey:{type:String,required:!0},labelKey:{type:String,default:"label"},childrenKey:{type:String,default:"children"},dense:Boolean,color:String,controlColor:String,textColor:String,selectedColor:String,icon:String,tickStrategy:{type:String,default:"none",validator:l=>dt.includes(l)},ticked:Array,expanded:Array,selected:{},noSelectionUnset:Boolean,defaultExpandAll:Boolean,accordion:Boolean,filter:String,filterMethod:Function,duration:Number,noConnectors:Boolean,noTransition:Boolean,noNodesLabel:String,noResultsLabel:String},emits:["update:expanded","update:ticked","update:selected","lazyLoad","afterShow","afterHide"],setup(l,{slots:i,emit:u}){const{proxy:_}=Re(),{$q:s}=_,k=lt(l,s),h=p({}),d=p(l.ticked||[]),y=p(l.expanded||[]);let c={};De(()=>{c={}});const K=q(()=>`q-tree q-tree--${l.dense===!0?"dense":"standard"}`+(l.noConnectors===!0?" q-tree--no-connectors":"")+(k.value===!0?" q-tree--dark":"")+(l.color!==void 0?` text-${l.color}`:"")),de=q(()=>l.selected!==void 0),Ke=q(()=>l.icon||s.iconSet.tree.icon),fe=q(()=>l.controlColor||l.color),I=q(()=>l.textColor!==void 0?` text-${l.textColor}`:""),qe=q(()=>{const t=l.selectedColor||l.color;return t?` text-${t}`:""}),Te=q(()=>l.filterMethod!==void 0?l.filterMethod:(t,a)=>{const e=a.toLowerCase();return t[l.labelKey]&&t[l.labelKey].toLowerCase().indexOf(e)>-1}),S=q(()=>{const t={},a=(e,o)=>{const r=e.tickStrategy||(o?o.tickStrategy:l.tickStrategy),v=e[l.nodeKey],b=e[l.childrenKey]&&Array.isArray(e[l.childrenKey])&&e[l.childrenKey].length!==0,A=e.disabled!==!0&&de.value===!0&&e.selectable!==!1,x=e.disabled!==!0&&e.expandable!==!1,Ie=r!=="none",U=r==="strict",be=r==="leaf-filtered",Y=r==="leaf"||r==="leaf-filtered";let Z=e.disabled!==!0&&e.tickable!==!1;Y===!0&&Z===!0&&o&&o.tickable!==!0&&(Z=!1);let B=e.lazy;B===!0&&h.value[v]!==void 0&&Array.isArray(e[l.childrenKey])===!0&&(B=h.value[v]);const f={key:v,parent:o,isParent:b,lazy:B,disabled:e.disabled,link:e.disabled!==!0&&(A===!0||x===!0&&(b===!0||B===!0)),children:[],matchesFilter:l.filter?Te.value(e,l.filter):!0,selected:v===l.selected&&A===!0,selectable:A,expanded:b===!0?y.value.includes(v):!1,expandable:x,noTick:e.noTick===!0||U!==!0&&B&&B!=="loaded",tickable:Z,tickStrategy:r,hasTicking:Ie,strictTicking:U,leafFilteredTicking:be,leafTicking:Y,ticked:U===!0?d.value.includes(v):b===!0?!1:d.value.includes(v)};if(t[v]=f,b===!0&&(f.children=e[l.childrenKey].map(g=>a(g,f)),l.filter&&(f.matchesFilter!==!0?f.matchesFilter=f.children.some(g=>g.matchesFilter):f.noTick!==!0&&f.disabled!==!0&&f.tickable===!0&&be===!0&&f.children.every(g=>g.matchesFilter!==!0||g.noTick===!0||g.tickable!==!0)===!0&&(f.tickable=!1)),f.matchesFilter===!0&&(f.noTick!==!0&&U!==!0&&f.children.every(g=>g.noTick)===!0&&(f.noTick=!0),Y))){if(f.ticked=!1,f.indeterminate=f.children.some(g=>g.indeterminate===!0),f.tickable=f.tickable===!0&&f.children.some(g=>g.tickable),f.indeterminate!==!0){const g=f.children.reduce((ge,Le)=>Le.ticked===!0?ge+1:ge,0);g===f.children.length?f.ticked=!0:g>0&&(f.indeterminate=!0)}f.indeterminate===!0&&(f.indeterminateNextState=f.children.every(g=>g.tickable!==!0||g.ticked!==!0))}return f};return l.nodes.forEach(e=>a(e,null)),t});we(()=>l.ticked,t=>{d.value=t}),we(()=>l.expanded,t=>{y.value=t});function L(t){const a=[].reduce,e=(o,r)=>{if(o||!r)return o;if(Array.isArray(r)===!0)return a.call(Object(r),e,o);if(r[l.nodeKey]===t)return r;if(r[l.childrenKey])return e(null,r[l.childrenKey])};return e(null,l.nodes)}function $e(){return d.value.map(t=>L(t))}function Qe(){return y.value.map(t=>L(t))}function Ae(t){return t&&S.value[t]?S.value[t].expanded:!1}function Be(){l.expanded!==void 0?u("update:expanded",[]):y.value=[]}function me(){const t=[],a=e=>{e[l.childrenKey]&&e[l.childrenKey].length!==0&&e.expandable!==!1&&e.disabled!==!0&&(t.push(e[l.nodeKey]),e[l.childrenKey].forEach(a))};l.nodes.forEach(a),l.expanded!==void 0?u("update:expanded",t):y.value=t}function J(t,a,e=L(t),o=S.value[t]){if(o.lazy&&o.lazy!=="loaded"){if(o.lazy==="loading")return;h.value[t]="loading",Array.isArray(e[l.childrenKey])!==!0&&(e[l.childrenKey]=[]),u("lazyLoad",{node:e,key:t,done:r=>{h.value[t]="loaded",e[l.childrenKey]=Array.isArray(r)===!0?r:[],He(()=>{const v=S.value[t];v&&v.isParent===!0&&ve(t,!0)})},fail:()=>{delete h.value[t],e[l.childrenKey].length===0&&delete e[l.childrenKey]}})}else o.isParent===!0&&o.expandable===!0&&ve(t,a)}function ve(t,a){let e=y.value;const o=l.expanded!==void 0;if(o===!0&&(e=e.slice()),a){if(l.accordion&&S.value[t]){const r=[];S.value[t].parent?S.value[t].parent.children.forEach(v=>{v.key!==t&&v.expandable===!0&&r.push(v.key)}):l.nodes.forEach(v=>{const b=v[l.nodeKey];b!==t&&r.push(b)}),r.length!==0&&(e=e.filter(v=>r.includes(v)===!1))}e=e.concat([t]).filter((r,v,b)=>b.indexOf(r)===v)}else e=e.filter(r=>r!==t);o===!0?u("update:expanded",e):y.value=e}function Ve(t){return t&&S.value[t]?S.value[t].ticked:!1}function M(t,a){let e=d.value;const o=l.ticked!==void 0;o===!0&&(e=e.slice()),a?e=e.concat(t).filter((r,v,b)=>b.indexOf(r)===v):e=e.filter(r=>t.includes(r)===!1),o===!0&&u("update:ticked",e)}function Pe(t,a,e){const o={tree:_,node:t,key:e,color:l.color,dark:k.value};return pe(o,"expanded",()=>a.expanded,r=>{r!==a.expanded&&J(e,r)}),pe(o,"ticked",()=>a.ticked,r=>{r!==a.ticked&&M([e],r)}),o}function he(t){return(l.filter?t.filter(a=>S.value[a[l.nodeKey]].matchesFilter):t).map(a=>We(a))}function Ee(t){if(t.icon!==void 0)return w(ee,{class:"q-tree__icon q-mr-sm",name:t.icon,color:t.iconColor});const a=t.img||t.avatar;if(a)return w("img",{class:`q-tree__${t.img?"img":"avatar"} q-mr-sm`,src:a})}function Fe(){u("afterShow")}function Ne(){u("afterHide")}function We(t){const a=t[l.nodeKey],e=S.value[a],o=t.header&&i[`header-${t.header}`]||i["default-header"],r=e.isParent===!0?he(t[l.childrenKey]):[],v=r.length!==0||e.lazy&&e.lazy!=="loaded";let b=t.body&&i[`body-${t.body}`]||i["default-body"];const A=o!==void 0||b!==void 0?Pe(t,e,a):null;return b!==void 0&&(b=w("div",{class:"q-tree__node-body relative-position"},[w("div",{class:I.value},[b(A)])])),w("div",{key:a,class:`q-tree__node relative-position q-tree__node--${v===!0?"parent":"child"}`},[w("div",{class:"q-tree__node-header relative-position row no-wrap items-center"+(e.link===!0?" q-tree__node--link q-hoverable q-focusable":"")+(e.selected===!0?" q-tree__node--selected":"")+(e.disabled===!0?" q-tree__node--disabled":""),tabindex:e.link===!0?0:-1,ariaExpanded:r.length>0?e.expanded:null,role:"treeitem",onClick:x=>{ye(t,e,x)},onKeypress(x){Oe(x)!==!0&&(x.keyCode===13?ye(t,e,x,!0):x.keyCode===32&&X(t,e,x,!0))}},[w("div",{class:"q-focus-helper",tabindex:-1,ref:x=>{c[e.key]=x}}),e.lazy==="loading"?w(je,{class:"q-tree__spinner",color:fe.value}):v===!0?w(ee,{class:"q-tree__arrow"+(e.expanded===!0?" q-tree__arrow--rotate":""),name:Ke.value,onClick(x){X(t,e,x)}}):null,e.hasTicking===!0&&e.noTick!==!0?w(nt,{class:"q-tree__tickbox",modelValue:e.indeterminate===!0?null:e.ticked,color:fe.value,dark:k.value,dense:!0,keepColor:!0,disable:e.tickable!==!0,onKeydown:xe,"onUpdate:modelValue":x=>{ze(e,x)}}):null,w("div",{class:"q-tree__node-header-content col row no-wrap items-center"+(e.selected===!0?qe.value:I.value)},[o?o(A):[Ee(t),w("div",t[l.labelKey])]])]),v===!0?l.noTransition===!0?e.expanded===!0?w("div",{class:"q-tree__node-collapsible"+I.value,key:`${a}__q`},[b,w("div",{class:"q-tree__children"+(e.disabled===!0?" q-tree__node--disabled":""),role:"group"},r)]):null:w(it,{duration:l.duration,onShow:Fe,onHide:Ne},()=>H(w("div",{class:"q-tree__node-collapsible"+I.value,key:`${a}__q`},[b,w("div",{class:"q-tree__children"+(e.disabled===!0?" q-tree__node--disabled":""),role:"group"},r)]),[[Je,e.expanded]])):b])}function _e(t){const a=c[t];a&&a.focus()}function ye(t,a,e,o){o!==!0&&a.selectable!==!1&&_e(a.key),de.value&&a.selectable?l.noSelectionUnset===!1?u("update:selected",a.key!==l.selected?a.key:null):a.key!==l.selected&&u("update:selected",a.key===void 0?null:a.key):X(t,a,e,o),typeof t.handler=="function"&&t.handler(t)}function X(t,a,e,o){e!==void 0&&xe(e),o!==!0&&a.selectable!==!1&&_e(a.key),J(a.key,!a.expanded,t,a)}function ze(t,a){if(t.indeterminate===!0&&(a=t.indeterminateNextState),t.strictTicking)M([t.key],a);else if(t.leafTicking){const e=[],o=r=>{r.isParent?(a!==!0&&r.noTick!==!0&&r.tickable===!0&&e.push(r.key),r.leafTicking===!0&&r.children.forEach(o)):r.noTick!==!0&&r.tickable===!0&&(r.leafFilteredTicking!==!0||r.matchesFilter===!0)&&e.push(r.key)};o(t),M(e,a)}}return l.defaultExpandAll===!0&&me(),Object.assign(_,{getNodeByKey:L,getTickedNodes:$e,getExpandedNodes:Qe,isExpanded:Ae,collapseAll:Be,expandAll:me,setExpanded:J,isTicked:Ve,setTicked:M}),()=>{const t=he(l.nodes);return w("div",{class:K.value,role:"tree"},t.length===0?l.filter?l.noResultsLabel||s.lang.tree.noResults:l.noNodesLabel||s.lang.tree.noNodes:t)}}});const mt={class:"row q-gutter-x-md"},vt=P({__name:"ViewWhitelist",setup(l){const i=p(),u=p();R(async()=>{const{pg_whitelist:s}=W();i.value=await s.value.account.whitelist.all(),u.value=await s.value.account.whitelistEntry.all()});const _=q(()=>{var s;return(s=i==null?void 0:i.value)==null?void 0:s.map(k=>{var h,d;return{label:`${k.account.name} | ${k.publicKey.toString()}`,children:(d=(h=u.value)==null?void 0:h.filter(y=>y.account.parent.toString()===k.publicKey.toString()))==null?void 0:d.flatMap(y=>({label:`Member: ${y.account.whitelisted.toString()}  |  Account: ${y.publicKey.toString()} `}))}})});return(s,k)=>(C(),$("div",mt,[_.value?(C(),z(ft,{key:0,nodes:_.value,"node-key":"label","selected-color":"primary","default-expand-all":""},null,8,["nodes"])):Xe("",!0)]))}}),ht={class:"row"},_t=P({__name:"RemoveAddressFromWhitelist",setup(l){const{pg_whitelist:i}=W(),u=p(""),_=p(),s=p();R(async()=>{_.value=await i.value.account.whitelist.all()});async function k(){j();const h=new T(s.value.publicKey),[d,y]=T.findProgramAddressSync([new T(u.value).toBytes(),h.toBytes()],i.value.programId);try{console.log(i.value.methods);const c=new T(u.value),K=await i.value.methods.removeFromWhitelist(c).accounts({entry:d,whitelist:h,authority:N().publicKey.value}).rpc();console.log(K),await O(K)}catch(c){V.create({color:"red",message:`${c}`,timeout:5e3})}}return(h,d)=>{var y;return C(),$("div",ht,[n(se,{color:"primary",square:"",label:((y=s.value)==null?void 0:y.account.name)??"please select a whitelist"},{default:m(()=>[n(ce,null,{default:m(()=>[(C(!0),$(te,null,le(_.value,c=>H((C(),z(oe,{clickable:"",key:c,onClick:K=>s.value=c},{default:m(()=>[n(ie,null,{default:m(()=>[n(ne,null,{default:m(()=>[Q(ae(c==null?void 0:c.account.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[ue]])),128))]),_:1})]),_:1},8,["label"]),n(re,{class:"col",filled:"",modelValue:u.value,"onUpdate:modelValue":d[0]||(d[0]=c=>u.value=c),label:"Address to be removed"},null,8,["modelValue"]),n(D,{disable:u.value.length==0,square:"",color:"primary",onClick:d[1]||(d[1]=c=>k())},{default:m(()=>[Q("Remove")]),_:1},8,["disable"])])}}}),yt={class:"row"},bt=P({__name:"DeleteWhitelist",setup(l){const{pg_whitelist:i}=W(),u=p("3x5vrFFTspsicxrYHMA8SNVW71RMhVkALemXrJFfeQo1"),_=p(),s=p();R(async()=>{_.value=await i.value.account.whitelist.all()});async function k(){j();const h=new T(s.value.publicKey);T.findProgramAddressSync([new T(u.value).toBytes(),h.toBytes()],i.value.programId);try{const d=await i.value.methods.deleteWhitelist(s.value.account.name).accounts({whitelist:h,authority:N().publicKey.value}).rpc();console.log(d),await O(d)}catch(d){V.create({color:"red",message:`${d}`,timeout:5e3})}}return(h,d)=>{var y;return C(),$("div",yt,[n(se,{square:"",color:"primary",label:((y=s.value)==null?void 0:y.account.name)??"please select a whitelist"},{default:m(()=>[n(ce,null,{default:m(()=>[(C(!0),$(te,null,le(_.value,c=>H((C(),z(oe,{clickable:"",key:c,onClick:K=>s.value=c},{default:m(()=>[n(ie,null,{default:m(()=>[n(ne,null,{default:m(()=>[Q(ae(c==null?void 0:c.account.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[ue]])),128))]),_:1})]),_:1},8,["label"]),n(D,{square:"",color:"primary",onClick:d[0]||(d[0]=c=>k())},{default:m(()=>[Q("Delete")]),_:1})])}}}),gt=Ye("div",{class:"col text-h6"},"Whitelists Manager",-1),zt=P({__name:"WhitelistPage",setup(l){const i=p("view");return(u,_)=>(C(),z(rt,{class:"bg-black"},{default:m(()=>[n(at,{flat:""},{default:m(()=>[n(Ze,{class:"row items-center q-gutter-x-md"},{default:m(()=>[n(ee,{name:"contrast",size:"md"}),gt]),_:1}),n(Ce),n(Ge,{"no-caps":"","outside-arrows":"","mobile-arrows":"",modelValue:i.value,"onUpdate:modelValue":_[0]||(_[0]=s=>i.value=s),class:"shadow-2 bg-dark",align:"justify"},{default:m(()=>[n(E,{name:"create",label:"Create Whitelist"}),n(E,{name:"add",label:"Add Address to Whitelist"}),n(E,{name:"remove",label:"Remove address from Whitelist"}),n(E,{name:"delete",label:"Delete Whitelist"}),n(E,{name:"view",label:"View "})]),_:1},8,["modelValue"]),n(Ce),n(et,{dark:"",modelValue:i.value,"onUpdate:modelValue":_[1]||(_[1]=s=>i.value=s),animated:""},{default:m(()=>[n(F,{name:"create"},{default:m(()=>[n(ct)]),_:1}),n(F,{name:"add"},{default:m(()=>[n(ut)]),_:1}),n(F,{name:"remove"},{default:m(()=>[n(_t)]),_:1}),n(F,{name:"delete"},{default:m(()=>[n(bt)]),_:1}),n(F,{name:"view"},{default:m(()=>[n(vt)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}))}});export{zt as default};
