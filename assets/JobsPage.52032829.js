import{Q as Y}from"./QSpace.d89096e6.js";import{Q as T}from"./QBadge.b232f986.js";import{Q as K,a as E}from"./QCard.c875dd23.js";import{Q as ee}from"./QSeparator.558d612f.js";import{Q as y}from"./QInput.b7ed1c20.js";import{I as le,C as P}from"./ClosePopup.769fc70f.js";import{bZ as ae,J as w,ah as R,aF as S,aC as te,cB as oe,aQ as ne,cN as ue,ck as D,dT as se,cp as F,au as X,b1 as c,ak as q,as as n,bx as d,ar as C,al as p,bz as O,V as M,a6 as $,aX as re,ei as ie,ai as b,aj as h,b7 as I,bV as N,a1 as k,bU as Q}from"./index.2aa30145.js";import{Q as de}from"./QPage.254b4c0f.js";import{apiJsonBin as j}from"./axios.dc8d477d.js";import{Q as ce,c as me}from"./QSelect.423ba994.js";import{Q as fe}from"./QCardActions.b5d98699.js";function x(e,r=new WeakMap){if(Object(e)!==e)return e;if(r.has(e))return r.get(e);const l=e instanceof Date?new Date(e):e instanceof RegExp?new RegExp(e.source,e.flags):e instanceof Set?new Set:e instanceof Map?new Map:typeof e.constructor!="function"?Object.create(null):e.prototype!==void 0&&typeof e.prototype.constructor=="function"?e:new e.constructor;if(typeof e.constructor=="function"&&typeof e.valueOf=="function"){const i=e.valueOf();if(Object(i)!==i){const m=new e.constructor(i);return r.set(e,m),m}}return r.set(e,l),e instanceof Set?e.forEach(i=>{l.add(x(i,r))}):e instanceof Map&&e.forEach((i,m)=>{l.set(m,x(i,r))}),Object.assign(l,...Object.keys(e).map(i=>({[i]:x(e[i],r)})))}var U=ae({name:"QPopupEdit",props:{modelValue:{required:!0},title:String,buttons:Boolean,labelSet:String,labelCancel:String,color:{type:String,default:"primary"},validate:{type:Function,default:()=>!0},autoSave:Boolean,cover:{type:Boolean,default:!0},disable:Boolean},emits:["update:modelValue","save","cancel","beforeShow","show","beforeHide","hide"],setup(e,{slots:r,emit:l}){const{proxy:i}=te(),{$q:m}=i,a=w(null),o=w(""),s=w("");let g=!1;const _=R(()=>oe({initialValue:o.value,validate:e.validate,set:u,cancel:t,updatePosition:f},"value",()=>s.value,v=>{s.value=v}));function u(){e.validate(s.value)!==!1&&(B()===!0&&(l("save",s.value,o.value),l("update:modelValue",s.value)),J())}function t(){B()===!0&&l("cancel",s.value,o.value),J()}function f(){ne(()=>{a.value.updatePosition()})}function B(){return ue(s.value,o.value)===!1}function J(){g=!0,a.value.hide()}function z(){g=!1,o.value=x(e.modelValue),s.value=x(e.modelValue),l("beforeShow")}function G(){l("show")}function L(){g===!1&&B()===!0&&(e.autoSave===!0&&e.validate(s.value)===!0?(l("save",s.value,o.value),l("update:modelValue",s.value)):l("cancel",s.value,o.value)),l("beforeHide")}function Z(){l("hide")}function W(){const v=r.default!==void 0?[].concat(r.default(_.value)):[];return e.title&&v.unshift(S("div",{class:"q-dialog__title q-mt-sm q-mb-sm"},e.title)),e.buttons===!0&&v.push(S("div",{class:"q-popup-edit__buttons row justify-center no-wrap"},[S(D,{flat:!0,color:e.color,label:e.labelCancel||m.lang.label.cancel,onClick:t}),S(D,{flat:!0,color:e.color,label:e.labelSet||m.lang.label.set,onClick:u})])),v}return Object.assign(i,{set:u,cancel:t,show(v){a.value!==null&&a.value.show(v)},hide(v){a.value!==null&&a.value.hide(v)},updatePosition:f}),()=>{if(e.disable!==!0)return S(le,{ref:a,class:"q-popup-edit",cover:e.cover,onBeforeShow:z,onShow:G,onBeforeHide:L,onHide:Z,onEscapeKey:t},W)}}});const A="66b6b699e41b4d34e41e3c95",pe="$2a$10$pZ6Y26zPmmRlGZDWeqJFwuKB9DQq/sG6y3XJHupLKK.eTmS4lXls6",H={headers:{"X-Access-key":pe,"Content-Type":"application/json"}},V=se("jsonBin",{state:()=>({data:{}}),actions:{add(e){e.timestamp=Math.floor(Date.now()/1e3),V().data.record.push(e)},remove(e){this.data.record=this.data.record.filter(r=>r.timestamp!=e.timestamp)},read(){j.get(`/${A}/latest`,H).then(e=>{this.data=e.data}).catch(function(e){console.error(e)}),console.log("[jsonBin] get")},async update(){F().is_admin&&(j.put(`/${A}`,JSON.stringify(this.data.record),H).then(()=>console.log("send update!")).catch(function(e){console.error(e)}),console.log("[jsonBin] put"))}}}),ve={class:"row"},Ve=X({__name:"CreateNewJobDialog",props:["jobTypes"],setup(e){const r=w(!1),l=w({jobType:0}),i=R(()=>!(l.value.name&&l.value.description));return(m,a)=>(c(),q($,null,[n(D,{round:"",color:"primary",icon:"add",onClick:a[0]||(a[0]=o=>r.value=!0)}),n(me,{modelValue:r.value,"onUpdate:modelValue":a[7]||(a[7]=o=>r.value=o),class:"justify-center","backdrop-filter":"brightness(60%)"},{default:d(()=>[n(K,null,{default:d(()=>[n(E,{class:"row items-center q-pb-none text-h6"},{default:d(()=>[C(" Create new Job ")]),_:1}),n(E,null,{default:d(()=>[n(ce,{modelValue:l.value.jobType,"onUpdate:modelValue":a[1]||(a[1]=o=>l.value.jobType=o),options:e.jobTypes,"option-value":"id","option-label":"name","option-disable":"inactive",label:"JobType","emit-value":"","map-options":""},null,8,["modelValue","options"]),n(y,{modelValue:l.value.name,"onUpdate:modelValue":a[2]||(a[2]=o=>l.value.name=o),label:"Label"},null,8,["modelValue"]),n(y,{modelValue:l.value.description,"onUpdate:modelValue":a[3]||(a[3]=o=>l.value.description=o),label:"Description"},null,8,["modelValue"]),p("div",ve,[n(y,{modelValue:l.value.assigned,"onUpdate:modelValue":a[4]||(a[4]=o=>l.value.assigned=o),label:"Assigned"},null,8,["modelValue"]),n(y,{modelValue:l.value.reward,"onUpdate:modelValue":a[5]||(a[5]=o=>l.value.reward=o),label:"Reward"},null,8,["modelValue"])])]),_:1}),n(fe,{align:"right"},{default:d(()=>[O(n(D,{label:"Close",color:"primary"},null,512),[[P]]),O(n(D,{disable:i.value,label:"Add",color:"primary",onClick:a[6]||(a[6]=o=>M(V)().add(l.value))},null,8,["disable"]),[[P]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),ge={class:"row q-pb-sm"},be={class:"row q-gutter-x-sm"},ye=["onDrop"],we={class:"row items-center q-gutter-x-sm"},_e={class:"col text-h5"},he={class:"text-subtitle1 text-weight-light"},ke={class:"row q-mb-md"},De={class:"text-h6 col"},Se={class:"row q-gutter-x-sm"},Ce={class:"col text-subtitle1 text-weight-light"},Pe=X({__name:"JobsPage",setup(e){re(async()=>{let a=await V().read();console.log(a)});const r=w([{id:0,name:"Todo",description:"This hasn't been completed",color:"green"},{id:1,name:"In Progress",description:"This is actively worked on",color:"yellow-7"},{id:2,name:"Done",description:"This has been completed",color:"purple"}]);ie(()=>V().data.record,()=>{V().update()});const l=w(F().is_admin||!1);function i(a,o){a.dataTransfer.dropEffect="move",a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("itemID",o.timestamp)}function m(a,o){const s=a.dataTransfer.getData("itemID"),g=V().data.record.findIndex(_=>_.timestamp==s);V().data.record[g].jobType=o}return(a,o)=>(c(),b(de,{class:"col q-pa-sm"},{default:d(()=>[p("div",ge,[n(Y),l.value?(c(),b(Ve,{key:0,"job-types":r.value},null,8,["job-types"])):h("",!0)]),p("div",be,[(c(!0),q($,null,I(r.value,s=>{var g,_;return c(),q("div",{class:"col",key:s,onDrop:u=>m(u,s.id),onDragover:o[0]||(o[0]=N(()=>{},["prevent"])),onDragenter:o[1]||(o[1]=N(()=>{},["prevent"]))},[n(K,{flat:"",square:"",class:"q-pa-sm"},{default:d(()=>[p("div",we,[p("div",_e,k(s.name),1),n(T,{rounded:"",color:s.color,"text-color":"black"},null,8,["color"])]),p("div",he,k(s.description),1)]),_:2},1024),n(ee),(c(!0),q($,null,I((_=(g=M(V)().data)==null?void 0:g.record)==null?void 0:_.filter(u=>u.jobType==s.id),u=>(c(),b(K,{flat:"",square:"",class:"q-pa-sm q-mt-sm",key:u.timestamp},{default:d(()=>[n(E,{draggable:l.value,onDragstart:t=>i(t,u)},{default:d(()=>[p("div",ke,[p("div",De,[C(k(u.name)+" ",1),l.value?(c(),b(U,{key:0,modelValue:u.name,"onUpdate:modelValue":t=>u.name=t,"auto-save":""},{default:d(t=>[n(y,{modelValue:t.value,"onUpdate:modelValue":f=>t.value=f,dense:"",autofocus:"",counter:"",onKeyup:Q(t.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue"])):h("",!0)]),l.value?(c(),b(D,{key:0,icon:"delete",color:"red",flat:"",dense:"",size:"xs",onClick:t=>M(V)().remove(u)},null,8,["onClick"])):h("",!0)]),p("div",Se,[p("div",Ce,[C(k(u.description)+" ",1),l.value?(c(),b(U,{key:0,modelValue:u.description,"onUpdate:modelValue":t=>u.description=t,"auto-save":""},{default:d(t=>[n(y,{modelValue:t.value,"onUpdate:modelValue":f=>t.value=f,dense:"",autofocus:"",counter:"",onKeyup:Q(t.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue"])):h("",!0)]),n(T,null,{default:d(()=>[C(k(u.assigned??"-none-")+" ",1),l.value?(c(),b(U,{key:0,modelValue:u.assigned,"onUpdate:modelValue":t=>u.assigned=t,"auto-save":""},{default:d(t=>[n(y,{modelValue:t.value,"onUpdate:modelValue":f=>t.value=f,dense:"",autofocus:"",counter:"",onKeyup:Q(t.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue"])):h("",!0)]),_:2},1024),n(T,{class:"justify-center",color:"grey"},{default:d(()=>[C(k(u.reward??"-none-")+" ",1),l.value?(c(),b(U,{key:0,modelValue:u.reward,"onUpdate:modelValue":t=>u.reward=t,"auto-save":""},{default:d(t=>[n(y,{modelValue:t.value,"onUpdate:modelValue":f=>t.value=f,dense:"",autofocus:"",counter:"",onKeyup:Q(t.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue"])):h("",!0)]),_:2},1024)])]),_:2},1032,["draggable","onDragstart"])]),_:2},1024))),128))],40,ye)}),128))])]),_:1}))}});export{Pe as default};
