import{a as ue,Q as lt}from"./QTabs.e0b3cd0f.js";import{cM as st,dj as O,au as x,J as _,cp as I,b1 as m,ak as B,al as y,as as t,bx as r,ar as S,ck as V,d9 as N,P as b,cn as U,d0 as pe,dc as W,bZ as ot,ah as D,bs as ae,aT as be,cb as xe,c6 as Se,aF as Te,bC as rt,aC as it,cg as ct,cc as ut,dp as ft,df as F,a1 as E,V as A,dq as Ae,aX as se,bz as dt,a6 as Me,dr as mt,ai as k,ds as pt,d6 as vt,dg as ve,b9 as gt,dt as _t,cm as ee,da as fe,aj as T}from"./index.7cdf8e9f.js";import{Q as ne}from"./QSpace.25c604e6.js";import{u as le,Q as yt}from"./globalWallet.880e66e7.js";import{Q as kt}from"./QPage.6bcb6611.js";import{Q as ht,a as ge,f as ze}from"./format_address.9d13cdf3.js";import{Q as je}from"./QImg.46cd42f6.js";import{Q as J,a as q}from"./QInput.8fcf042b.js";import{Q as L}from"./QSeparator.0cd8bf4a.js";import{j as K,k as Q,B as wt,u as bt,n as xt,C as Pe,D as St,e as Tt,o as At,f as Pt,p as $t,E as Rt,F as Ct,h as qt,q as Ot,G as $e,H as Vt,c as Re,g as It,I as Ce,J as Et,l as M}from"./rtl.1f11326d.js";import{Q as Qt}from"./QList.54265523.js";import{Q as te}from"./QCard.56e6b6f3.js";import{Q as Mt,c as zt}from"./calcAmountToTransfer.737c550a.js";import{Q as Be}from"./QCardActions.f95bbf56.js";import{Q as me,c as jt}from"./QSelect.33302e4f.js";import{g as P,h as z}from"./handleTransaction.7997f86e.js";import"./SquadsStore.bb628acc.js";import{C as Bt}from"./ClosePopup.a2425ad9.js";import{Q as qe}from"./QBadge.0d3e7911.js";import{t as Le}from"./token.12badf67.js";import{g as De}from"./extensionType.162e8fa4.js";import{c as Ue}from"./associatedTokenAccount.4721cdf4.js";import{_ as Lt}from"./plugin-vue_export-helper.21dcd24c.js";import{u as Oe}from"./globalWhitelist.df9bd24f.js";import"./assert.f25cfba1.js";import"./index.c6289244.js";import"./QSlideTransition.76f3abc6.js";import"./use-checkbox.2fb52d20.js";import"./pda.d2798453.js";import"./cusper.b4a51056.js";import"./vaultTransactionCreate.66ea4d31.js";import"./errors.bf229580.js";const R=st("raffleStore",{state:()=>({raffles:[]}),getters:{getRunningRaffles(e){return e.raffles.filter(a=>Object.keys(a.account.state)[0]=="running"||Object.keys(a.account.state)[0]=="full"||Object.keys(a.account.state)[0]=="claimprize")}},actions:{async updateStore(){if(O())try{const e=O().pg_raffle.value;this.raffles=await(e==null?void 0:e.account.raffle.all()),console.log("[Updated] RaffleStore")}catch(e){console.error(e)}}}}),Dt={class:"col q-pa-sm"},Ut=y("p",{class:"text-overline"},"Add a prize:",-1),Nt={class:"col q-gutter-y-sm"},Wt={class:"row"},Ht=x({__name:"RafflePrepare",props:["raffle"],setup(e){const a=_(1),i=_(""),s=_(""),n=e,l=_([]);_(le().token_accounts.filter(f=>f.account.data.parsed.info.tokenAmount.uiAmount>0).flatMap(f=>f.account.data.parsed.info.mint)).value.forEach(f=>{var v,p;return l.value.push({label:I().token_list.find(w=>w.address==f)?((v=I().token_list.find(w=>w.address==f))==null?void 0:v.name)+" ["+((p=I().token_list.find(w=>w.address==f))==null?void 0:p.symbol)+"]":f,value:f})});async function c(){var f,v,p,w;try{const u=new N,d=(f=O())==null?void 0:f.pg_raffle.value,g=new b(s.value.value),h=(await U().connection.getParsedTokenAccountsByOwner(P(),{mint:g})).value[0].pubkey,$=new b(n.raffle.publicKey.toString()),G=await U().connection.getParsedAccountInfo(g);console.log((v=G.value)==null?void 0:v.data.parsed.info.decimals),i.value=((p=I().token_list.find(Y=>Y.address==g))==null?void 0:p.logoURI)??"",u.add(await(d==null?void 0:d.methods.prepare(new pe(a.value*Math.pow(10,(w=G.value)==null?void 0:w.data.parsed.info.decimals)),i.value).accountsPartial({creator:P(),raffle:$,from:h,prizeMint:g}).instruction())),await z(u,"[Raffle] prepare"),await R().updateStore()}catch(u){W.create({color:"red",message:`${u}`,timeout:5e3})}}return(f,v)=>(m(),B("div",Dt,[Ut,y("div",Nt,[t(me,{class:"full-width",filled:"",square:"",modelValue:s.value,"onUpdate:modelValue":v[0]||(v[0]=p=>s.value=p),clearable:"","use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",behavior:"menu",label:"Select Ticket by mint",options:l.value,style:{width:"250px"}},{"no-option":r(()=>[t(K,null,{default:r(()=>[t(Q,{class:"text-grey"},{default:r(()=>[S(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"]),y("div",Wt,[t(J,{class:"col",filled:"",square:"",modelValue:a.value,"onUpdate:modelValue":v[1]||(v[1]=p=>a.value=p),type:"number",label:"Count"},null,8,["modelValue"]),t(V,{filled:"",square:"",class:"col-2",color:"primary",icon:"send",onClick:v[2]||(v[2]=p=>c())})])])]))}});var Kt=ot({name:"QTooltip",inheritAttrs:!1,props:{...wt,...bt,...xt,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{default:"jump-down"},transitionHide:{default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:Pe},self:{type:String,default:"top middle",validator:Pe},offset:{type:Array,default:()=>[14,14],validator:St},scrollTarget:{default:void 0},delay:{type:Number,default:0},hideDelay:{type:Number,default:0}},emits:[...Tt],setup(e,{slots:a,emit:i,attrs:s}){let n,l;const o=it(),{proxy:{$q:c}}=o,f=_(null),v=_(!1),p=D(()=>Ce(e.anchor,c.lang.rtl)),w=D(()=>Ce(e.self,c.lang.rtl)),u=D(()=>e.persistent!==!0),{registerTick:d,removeTick:g}=At(),{registerTimeout:h}=Pt(),{transitionProps:$,transitionStyle:G}=$t(e),{localScrollTarget:Y,changeScrollEvent:re,unconfigureScrollTarget:Ke}=Rt(e,he),{anchorEl:j,canShow:Fe,anchorEvents:Z}=Ct({showing:v,configureAnchorEl:tt}),{show:Ge,hide:ie}=qt({showing:v,canShow:Fe,handleShow:Je,handleHide:Ze,hideOnRouteChange:u,processOnMount:!0});Object.assign(Z,{delayShow:Xe,delayHide:et});const{showPortal:_e,hidePortal:ye,renderPortal:Ye}=Ot(o,f,nt,"tooltip");if(c.platform.is.mobile===!0){const C={anchorEl:j,innerRef:f,onClickOutside(H){return ie(H),H.target.classList.contains("q-dialog__backdrop")&&ut(H),!0}},ce=D(()=>e.modelValue===null&&e.persistent!==!0&&v.value===!0);ae(ce,H=>{(H===!0?Et:$e)(C)}),be(()=>{$e(C)})}function Je(C){_e(),d(()=>{l=new MutationObserver(()=>X()),l.observe(f.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),X(),he()}),n===void 0&&(n=ae(()=>c.screen.width+"|"+c.screen.height+"|"+e.self+"|"+e.anchor+"|"+c.lang.rtl,X)),h(()=>{_e(!0),i("show",C)},e.transitionDuration)}function Ze(C){g(),ye(),ke(),h(()=>{ye(!0),i("hide",C)},e.transitionDuration)}function ke(){l!==void 0&&(l.disconnect(),l=void 0),n!==void 0&&(n(),n=void 0),Ke(),xe(Z,"tooltipTemp")}function X(){Vt({targetEl:f.value,offset:e.offset,anchorEl:j.value,anchorOrigin:p.value,selfOrigin:w.value,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function Xe(C){if(c.platform.is.mobile===!0){Re(),document.body.classList.add("non-selectable");const ce=j.value,H=["touchmove","touchcancel","touchend","click"].map(we=>[ce,we,"delayHide","passiveCapture"]);Se(Z,"tooltipTemp",H)}h(()=>{Ge(C)},e.delay)}function et(C){c.platform.is.mobile===!0&&(xe(Z,"tooltipTemp"),Re(),setTimeout(()=>{document.body.classList.remove("non-selectable")},10)),h(()=>{ie(C)},e.hideDelay)}function tt(){if(e.noParentEvent===!0||j.value===null)return;const C=c.platform.is.mobile===!0?[[j.value,"touchstart","delayShow","passive"]]:[[j.value,"mouseenter","delayShow","passive"],[j.value,"mouseleave","delayHide","passive"]];Se(Z,"anchor",C)}function he(){if(j.value!==null||e.scrollTarget!==void 0){Y.value=It(j.value,e.scrollTarget);const C=e.noParentEvent===!0?X:ie;re(Y.value,C)}}function at(){return v.value===!0?Te("div",{...s,ref:f,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",s.class],style:[s.style,G.value],role:"tooltip"},ct(a.default)):null}function nt(){return Te(rt,$.value,at)}return be(ke),Object.assign(o.proxy,{updatePosition:X}),Ye}});const Ft=new b(ft.address),Gt=new b("adm1rpWxyo8u9y2Q2wxxfqaVDLE2gD1N9PbZbbhokTP"),Yt="Crew";function Ne(){return b.findProgramAddressSync([Gt.toBuffer(),F(Yt)],Ft)[0]}const Jt={class:"col q-pa-sm q-gutter-y-sm"},Zt=y("p",{class:"text-overline"},"Buy Ticket(s)",-1),Xt={class:"row"},ea={class:"row"},ta={class:"col row q-gutter-x-xs"},aa=y("p",{class:"text-weight-light"},"Available:",-1),na={class:"text-caption text-right text-weight-thin"},la=x({__name:"RaffleBuyTicket",props:["raffle","tickets"],setup(e){const a=_(),i=e;async function s(){var w,u,d;const n=new N;await le().update_accounts();const l=(w=O())==null?void 0:w.pg_raffle.value,o=(u=O())==null?void 0:u.pg_whitelist.value,c=new b(i.raffle.account.ticketMint.toString()),f=(await U().connection.getParsedTokenAccountsByOwner(P(),{mint:c})).value[0].pubkey,v=new b(i.raffle.publicKey.toString());let p=Ne();try{n.add(await(l==null?void 0:l.methods.buyTickets(new pe(a.value)).accountsPartial({signer:P(),raffle:v,entrant:P(),ticketsMint:c,from:f,whitelist:p,whitelistEntry:b.findProgramAddressSync([(d=P())==null?void 0:d.toBytes(),p.toBytes()],o==null?void 0:o.programId)[0],whitelistProgram:o==null?void 0:o.programId}).instruction())),await z(n,"[Raffle] buy ticket"),await R().updateStore()}catch(g){W.create({color:"danger",message:`${g}`,timeout:5e3})}}return(n,l)=>{var o,c,f,v;return m(),B("div",Jt,[Zt,y("div",Xt,[t(J,{square:"",filled:"",outlined:"",type:"number",class:"col",label:"Amount",modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=p=>a.value=p)},null,8,["modelValue"]),t(V,{square:"",disable:!a.value,color:"primary",icon:"send",onClick:l[1]||(l[1]=p=>s())},null,8,["disable"])]),y("div",ea,[y("div",ta,[aa,y("p",null,E((c=(o=A(Ae)().accounts)==null?void 0:o.find(p=>p.mint==e.raffle.account.ticketMint.toString()))==null?void 0:c.uiAmount),1),y("p",null,E((v=(f=A(Ae)().accounts)==null?void 0:f.find(p=>p.mint==e.raffle.account.ticketMint.toString()))==null?void 0:v.info.symbol),1)]),y("p",na,[S(" 0.001\u25CE fee "),t(Kt,{anchor:"bottom right",self:"top middle"},{default:r(()=>[S(" cover deployment costs ")]),_:1})])])])}}}),sa=y("source",{src:"Burningticket.mp4",type:"video/mp4"},null,-1),oa=x({__name:"BurningTicket",setup(e){const a=_();return se(()=>{a.value.playbackRate=.3,console.log(a.value)}),(i,s)=>(m(),B("video",{ref_key:"ticket_burning",ref:a,autoplay:"",playbackspeed:"0.1"},[sa,S(" Your browser does not support the video tag. ")],512))}}),ra=y("div",{class:"text-h6 text-center"},"Drawing...",-1),ia=x({__name:"RaffleRevealWinner",props:["raffle","is_admin"],setup(e){_();const a=e,i=_(!1);ae(()=>i.value,()=>{i.value==!1&&R().updateStore()});async function s(){var n;try{const l=new N,o=(n=O())==null?void 0:n.pg_raffle.value,c=new b(a.raffle.publicKey.toString());let[f,v]=b.findProgramAddressSync([F("tickets"),c.toBytes()],o==null?void 0:o.programId);l.add(await(o==null?void 0:o.methods.revealWinners().accounts({raffle:c,tickets:f,recentBlockHashes:mt}).instruction())),await z(l,"[Raffle] reveal winner"),i.value=!0}catch(l){W.create({color:"red",message:`${l}`,timeout:5e3})}}return(n,l)=>(m(),B(Me,null,[t(V,{square:"",class:"row",color:"primary",icon:"send",label:"Reveal Winner",onClick:l[0]||(l[0]=o=>s())}),t(jt,{maximized:!0,modelValue:i.value,"onUpdate:modelValue":l[2]||(l[2]=o=>i.value=o)},{default:r(()=>[t(te,{flat:"",square:"",class:""},{default:r(()=>[t(q,null,{default:r(()=>[ra]),_:1}),t(q,{class:"q-pt-none row"},{default:r(()=>[t(ne),t(oa),t(ne)]),_:1}),t(Be,{align:"right"},{default:r(()=>[dt(t(V,{flat:"",label:"close",color:"primary",onClick:l[1]||(l[1]=o=>A(R)().update_raffles())},null,512),[[Bt]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),ca={class:"absolute-full flex flex-center"};var We=(e=>(e.created="orange",e.ready="orange",e.paused="pink",e.full="purple",e.claimprize="purple",e.claimtickets="purple",e.running="primary",e))(We||{});const ua=x({__name:"RaffleStateBadge",props:["raffle","tickets"],setup(e){const a=e,i=D(()=>{var s,n;return((s=a.tickets)==null?void 0:s.sold)/((n=a.tickets)==null?void 0:n.total)});return(s,n)=>Object.keys(e.raffle.account.state)[0]=="running"?(m(),k(ht,{key:0,size:"25px",value:i.value,color:"primary"},{default:r(()=>{var l,o;return[y("div",ca,[t(qe,{color:"black","text-color":"primary",label:`Tickets: ${(l=e.tickets)==null?void 0:l.sold}/${(o=e.tickets)==null?void 0:o.total}`},null,8,["label"])])]}),_:1},8,["value"])):(m(),k(qe,{key:1,color:We[Object.keys(e.raffle.account.state)[0]],class:"text-h6 justify-center full-width"},{default:r(()=>[S(E(Object.keys(e.raffle.account.state)[0].toUpperCase()),1)]),_:1},8,["color"]))}}),oe=new b(pt.address);function fa(e,a){return b.findProgramAddressSync([F("raffle"),F(e),a.toArrayLike(vt.Buffer).reverse()],oe)[0]}function da(e){return b.findProgramAddressSync([F("tickets"),e.toBytes()],oe)[0]}function He(e){return b.findProgramAddressSync([F("vaultPrize"),e.toBytes()],oe)[0]}function ma(e){return b.findProgramAddressSync([F("vaultTickets"),e.toBytes()],oe)[0]}const pa=x({__name:"RaffleClaimPrize",props:["raffle","is_admin"],setup(e){const a=e;async function i(){var s;try{let n=new N;const l=(s=O())==null?void 0:s.pg_raffle.value,o=new b(a.raffle.account.prizeMint.toString()),c=new b(a.raffle.account.winner.toString()),f=await De(o,c,!0,ve,Le.ASSOCIATED_PROGRAM_ID);await U().connection.getAccountInfo(f)===null&&n.add(Ue(P(),f,c,o));const v=new b(a.raffle.publicKey.toString()),p=He(v);n.add(await(l==null?void 0:l.methods.claimPrize().accountsPartial({raffle:v,prizeMint:o,prizeVault:p,to:f}).instruction())),await z(n,"[Raffle] Claim Prize"),await R().updateStore()}catch(n){W.create({color:"red",message:`${n}`,timeout:5e3,position:"bottom-right"})}}return(s,n)=>(m(),k(V,{color:"primary",icon:"send",label:"Claim Prize",onClick:n[0]||(n[0]=l=>i())}))}});async function va(e){try{return!!await U().connection.getAccountInfo(e)}catch(a){return console.error("Error checking account:",a),!1}}const ga=x({__name:"RaffleClose",props:["raffle"],setup(e){const a=e;async function i(){var s;try{const n=new N,l=(s=O())==null?void 0:s.pg_raffle.value;let o=a.raffle.publicKey;const c=da(o),f=ma(o);let v=He(o);await va(v)||(v=null),n.add(await(l==null?void 0:l.methods.close().accountsPartial({creator:P(),raffle:o,tickets:c,ticketsVault:f,prizeVault:v}).instruction())),await z(n,"[Raffle] close"),await R().updateStore()}catch(n){W.create({color:"red",message:`${n}`,timeout:5e3})}}return(s,n)=>(m(),k(V,{square:"",color:"primary",icon:"send",label:"Close Raffle",onClick:n[0]||(n[0]=l=>i())}))}}),_a=x({__name:"RaffleClaimTickets",props:["raffle","is_admin"],setup(e){const a=e;async function i(){var s;try{const n=new N,l=(s=O())==null?void 0:s.pg_raffle.value,o=new b(a.raffle.account.ticketMint.toString()),c=await De(o,P(),!0,ve,Le.ASSOCIATED_PROGRAM_ID);await U().connection.getAccountInfo(c)===null&&n.add(Ue(P(),c,P(),o)),n.add(await(l==null?void 0:l.methods.claimTickets().accountsPartial({creator:P(),raffle:a.raffle.publicKey,ticketsMint:o,to:c}).instruction())),await z(n,"[Raffle Claim Tickets]"),await R().updateStore()}catch(n){W.create({color:"red",message:`${n}`,timeout:5e3,position:"bottom-right"})}}return(s,n)=>(m(),k(V,{color:"primary",icon:"send",label:"Claim Tickets",onClick:n[0]||(n[0]=l=>i())}))}}),ya=x({__name:"AccountsTable",props:["accounts"],setup(e){const a=_({rowsPerPage:0}),i=_([{name:"mint",required:!0,label:"Mint",align:"left",field:"mint",field:s=>{var n,l;return((n=I().token_list.find(o=>{var c;return o.address==((c=s.mint)==null?void 0:c.toString())}))==null?void 0:n.name)??((l=s.mint)==null?void 0:l.toString())},sortable:!0},{name:"calories",align:"right",label:"Amount",field:s=>s.tokenAmount.uiAmount,sortable:!0}]);return(s,n)=>{var l,o;return m(),k(ge,{square:"",dense:"",class:"col",title:"Accounts",rows:(o=(l=e.accounts)==null?void 0:l.value)==null?void 0:o.map(c=>c.account.data.parsed.info),columns:i.value,"row-key":"mint","hide-bottom":"",flat:"",pagination:a.value,"onUpdate:pagination":n[0]||(n[0]=c=>a.value=c),"rows-per-page-options":[0]},null,8,["rows","columns","pagination"])}}}),Ve=9,ka=95,ha=45,Ie=5;function wa(e){return e.split("").reduce((a,i)=>(a^i.charCodeAt(0))*-Ie,Ie)>>>2}function ba(e="",a=ka,i=ha,s=wa){const n=s(e),l=n%Ve*(360/Ve);return[...Array(e?25:0)].reduce((o,c,f)=>n&1<<f%15?o+`<rect x="${f>14?7-~~(f/5):~~(f/5)}" y="${f%5}" width="1" height="1"/>`:o,`<svg viewBox="-1.5 -1.5 8 8" xmlns="http://www.w3.org/2000/svg" fill="hsl(${l} ${a}% ${i}%)">`)+"</svg>"}const xa=["innerHTML"],Sa=x({__name:"IconFromSeed",props:{seed:{type:String,default:"default"}},setup(e){const i=_(ba(e.seed));return(s,n)=>(m(),B("div",{innerHTML:i.value},null,8,xa))}});const Ta=x({__name:"Apex_TicketsChart",props:["data_value","data_label"],setup(e){const a=e,i=D(()=>a.data_value?a.data_value:[44,55,41,17,15]),s=D(()=>a.data_label?{legend:{labels:{colors:"white"},position:"left"},theme:{palette:"palette3"},labels:a.data_label}:{labels:["Apple","Mango","Orange","Watermelon"]});return(n,l)=>{const o=gt("apexchart");return m(),k(o,{height:"200px",type:"donut",options:s.value,series:i.value},null,8,["options","series"])}}}),Aa=x({__name:"TicketsTable",props:["entrants"],setup(e){const a=_({rowsPerPage:0});_();const i=_([{name:"wallet",required:!0,label:"Wallet",align:"left",field:s=>ze(s.address),sortable:!0},{name:"amount",align:"right",label:"Amount",field:"amount",sortable:!0}]);return(s,n)=>{var l,o;return m(),B(Me,null,[t(ge,{square:"",dense:"",class:"col",title:"Tickets",rows:e.entrants,columns:i.value,"row-key":"mint","hide-bottom":"",flat:"",pagination:a.value,"onUpdate:pagination":n[0]||(n[0]=c=>a.value=c),"rows-per-page-options":[0]},null,8,["rows","columns","pagination"]),t(Ta,{data_value:(l=e.entrants)==null?void 0:l.map(c=>c.amount),data_label:(o=e.entrants)==null?void 0:o.map(c=>c.address)},null,8,["data_value","data_label"])],64)}}}),Pa={};function $a(e,a){return m(),k(_t,{size:"xs"},{default:r(()=>[t(je,{src:"solscan.png"})]),_:1})}var Ee=Lt(Pa,[["render",$a]]);const Ra=y("div",{class:"col q-gutter-y-sm"},[y("div",null,"Raffle account"),y("div",null,"Entrants account"),y("div",null,"Use Whitelist?")],-1),Ca={class:"col q-gutter-y-sm"},qa=x({__name:"RaffleLinks",props:["raffle","entrants"],setup(e){const a=e;return _({rowsPerPage:0}),(i,s)=>(m(),k(te,{flat:"",square:"",class:"row items-center q-pa-md"},{default:r(()=>[Ra,y("div",Ca,[t(V,{class:"full-width",size:"xs",square:"",color:"primary",href:"https://solscan.io/account/"+a.raffle.publicKey,target:"_blank"},{default:r(()=>[t(Ee)]),_:1},8,["href"]),t(V,{class:"full-width",square:"",size:"xs",color:"primary",href:"https://solscan.io/account/"+a.raffle.account.entrants,target:"_blank"},{default:r(()=>[t(Ee)]),_:1},8,["href"]),e.raffle.account.useWhitelist?(m(),k(ee,{key:0,name:"check"})):(m(),k(ee,{key:1,name:"clear"}))])]),_:1}))}}),Oa=x({__name:"RaffleToggleMode",props:["raffle"],setup(e){const a=e;async function i(){var s;try{const n=new N,l=(s=O())==null?void 0:s.pg_raffle.value;let o=await(l==null?void 0:l.account.raffle.fetch(a.raffle.publicKey));console.log(o),console.log(Object.keys(o.state)[0]);let c;switch(Object.keys(o.state)[0]){case"ready":n.add(await(l==null?void 0:l.methods.enable().accountsPartial({creator:P(),raffle:a.raffle.publicKey}).instruction())),await z(n,"[Raffle] enable");break;case"paused":n.add(await(l==null?void 0:l.methods.enable().accountsPartial({creator:P(),raffle:a.raffle.publicKey}).instruction())),await z(n,"[Raffle] enable");break;case"running":n.add(await(l==null?void 0:l.methods.disable().accountsPartial({creator:P(),raffle:a.raffle.publicKey}).instruction())),await z(n,"[Raffle] disable");break}await R().updateStore()}catch(n){W.create({color:"red",message:`${n}`,timeout:5e3})}}return(s,n)=>(m(),k(V,{icon:"send",label:"Start/Pause",square:"",color:"primary",onClick:n[0]||(n[0]=l=>i())}))}});async function de(e,a=3,i=1e3){let s=0;for(;s<a;)try{return await e()}catch(n){if(s++,s>=a)throw new Error(`Function ${e.name} failed after ${s} attempts: ${n}`);console.log(`Retry ${e.name}() | ${s}/${a} failed. Retrying in ${i}ms...`),await new Promise(l=>setTimeout(l,i))}throw new Error("This line should never be reached.")}const Va={class:"text-h5 q-mt-sm q-mb-xs"},Ia={class:"text-caption text-grey"},Ea=y("p",{class:"text-overline"},"Actions",-1),Qa={class:"col row justify-end q-mx-sm"},Ma=x({__name:"RaffleCard",props:["raffle","is_admin"],setup(e){const a=e,i=_(),s=_(),n=_();async function l(){const{pg_raffle:p}=O();i.value=await p.value.account.tickets.fetch(a.raffle.account.tickets),console.log(i.value)}async function o(){s.value=await U().connection.getParsedTokenAccountsByOwner(a.raffle.publicKey,{programId:ve})}async function c(){const{pg_raffle:p}=O(),w=await p.value.account.tickets.getAccountInfo(a.raffle.account.tickets);let u=[];for(let h=0;h<i.value.total;h++){let $=f(w.data,h);u.push($)}const g=u.map(h=>h.toString()).reduce((h,$)=>({...h,[$]:(h[$]||0)+1}),{});n.value=Object.entries(g).flatMap(h=>({address:h[0],amount:h[1]}))}function f(p,w){const u=16+32*w,d=u+32,g=p.slice(u,d);return new b(g)}se(async()=>{await de(l),await de(o),await de(c)});function v(){var p;return a.raffle.account.url?a.raffle.account.url:(console.log(I().token_list.find(w=>w.address===a.raffle.account.prizeMint.toString())),((p=I().token_list.find(w=>w.address===a.raffle.account.prizeMint.toString()))==null?void 0:p.logoURI)??"snb_icon.svg")}return(p,w)=>(m(),k(te,{square:"",flat:""},{default:r(()=>[t(je,{height:"200px",src:v()},null,8,["src"]),t(q,null,{default:r(()=>[t(ua,{raffle:e.raffle,tickets:i.value},null,8,["raffle","tickets"]),y("div",Va,E(e.raffle.account.name),1),y("div",Ia,E(e.raffle.account.description),1)]),_:1}),t(L),t(q,null,{default:r(()=>[t(Qt,null,{default:r(()=>[t(K,{clickable:""},{default:r(()=>[t(Q,{avatar:""},{default:r(()=>[t(ee,{color:"primary",name:"functions"})]),_:1}),t(Q,null,{default:r(()=>[t(M,{class:"text-h6"},{default:r(()=>{var u;return[S(E((u=i.value)==null?void 0:u.total)+" Tickets",1)]}),_:1}),t(M,{class:"text-accent",caption:""},{default:r(()=>[S("Total tickets")]),_:1})]),_:1})]),_:1}),t(K,{clickable:""},{default:r(()=>[t(Q,{avatar:""},{default:r(()=>[t(ee,{color:"red",name:"paid"})]),_:1}),t(Q,null,{default:r(()=>[t(M,{class:"text-h6"},{default:r(()=>{var u;return[S(E((e.raffle.account.ticketPrice.toNumber()*Math.pow(10,-e.raffle.account.ticketDecimals)).toFixed(2))+" "+E((u=A(fe)().tokenList.find(d=>d.address==e.raffle.account.ticketMint.toString()))==null?void 0:u.symbol),1)]}),_:1}),t(M,{class:"text-accent",caption:""},{default:r(()=>[S("Price per ticket")]),_:1})]),_:1})]),_:1}),t(K,{clickable:""},{default:r(()=>[t(Q,{avatar:""},{default:r(()=>[t(ee,{color:"amber",name:"local_movies"})]),_:1}),t(Q,{class:"q-gutter-y-md"},{default:r(()=>[y("div",null,[t(M,{class:"q-pt-md text-overline"},{default:r(()=>{var u;return[S(E(((u=A(fe)().tokenList.find(d=>d.address==e.raffle.account.prizeMint.toString()))==null?void 0:u.name)??e.raffle.account.ticketMint.toString()),1)]}),_:1}),t(M,{class:"text-accent",caption:""},{default:r(()=>[S("Prize-Mint")]),_:1})]),y("div",null,[t(M,{class:"text-overline"},{default:r(()=>{var u;return[S(E(((u=A(fe)().tokenList.find(d=>d.address==e.raffle.account.ticketMint.toString()))==null?void 0:u.name)??e.raffle.account.ticketMint.toString()),1)]}),_:1}),t(M,{class:"text-accent",caption:""},{default:r(()=>[S("Ticket-Mint")]),_:1})])]),_:1})]),_:1}),e.raffle.account.randomness!=null?(m(),k(K,{key:0,clickable:""},{default:r(()=>[t(Q,{avatar:""},{default:r(()=>{var u,d;return[t(Sa,{style:{width:"100px"},seed:(d=(u=e.raffle.account)==null?void 0:u.winner)==null?void 0:d.toString()},null,8,["seed"])]}),_:1}),t(Q,null,{default:r(()=>[t(M,{class:"text-h6",l:""},{default:r(()=>[S("Winner")]),_:1}),t(M,{class:"text-orange-9",caption:""},{default:r(()=>{var u;return[S(E(A(ze)((u=e.raffle.account.winner)==null?void 0:u.toString())),1)]}),_:1})]),_:1})]),_:1})):T("",!0)]),_:1})]),_:1}),t(L),t(Mt,{icon:"info",label:"Details"},{default:r(()=>[t(te,{flat:""},{default:r(()=>[t(L),t(q,null,{default:r(()=>[t(ya,{accounts:s.value},null,8,["accounts"])]),_:1}),t(L),t(q,null,{default:r(()=>[t(Aa,{entrants:n.value},null,8,["entrants"])]),_:1}),t(L),t(q,null,{default:r(()=>[t(qa,{raffle:e.raffle,entrants:n.value,class:"q-pb-md"},null,8,["raffle","entrants"])]),_:1})]),_:1})]),_:1}),t(L),e.is_admin?(m(),k(q,{key:0},{default:r(()=>[Object.keys(e.raffle.account.state)[0]=="created"?(m(),k(Ht,{key:0,raffle:e.raffle},null,8,["raffle"])):T("",!0)]),_:1})):T("",!0),Object.keys(e.raffle.account.state)[0]=="running"&&!e.is_admin?(m(),k(Be,{key:1},{default:r(()=>[t(la,{raffle:e.raffle,tickets:i.value},null,8,["raffle","tickets"])]),_:1})):T("",!0),e.is_admin?(m(),k(q,{key:2,class:"col"},{default:r(()=>[Ea,y("div",Qa,[Object.keys(e.raffle.account.state)[0]=="full"?(m(),k(ia,{key:0,raffle:e.raffle},null,8,["raffle"])):T("",!0),Object.keys(e.raffle.account.state)[0]=="claimprize"||Object.keys(e.raffle.account.state)[0]=="ready"?(m(),k(pa,{key:1,raffle:e.raffle},null,8,["raffle"])):T("",!0),Object.keys(e.raffle.account.state)[0]=="claimtickets"?(m(),k(_a,{key:2,raffle:e.raffle},null,8,["raffle"])):T("",!0),Object.keys(e.raffle.account.state)[0]=="ready"||Object.keys(e.raffle.account.state)[0]=="running"||Object.keys(e.raffle.account.state)[0]=="paused"?(m(),k(Oa,{key:3,raffle:e.raffle},null,8,["raffle"])):T("",!0),Object.keys(e.raffle.account.state)[0]=="created"||Object.keys(e.raffle.account.state)[0]=="done"?(m(),k(ga,{key:4,raffle:e.raffle},null,8,["raffle"])):T("",!0)])]),_:1})):T("",!0)]),_:1}))}}),za={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},Qe=x({__name:"RaffleGrid",props:{is_admin:{type:Boolean,default:!1},raffles:{type:[],default:[]},count:{type:Number,default:0}},setup(e){const a=e,i=D(()=>[0]),s=_({rowsPerPage:0});return(n,l)=>(m(),k(ge,{grid:"",rows:a.raffles,"row-key":"name","hide-header":"",pagination:s.value,"onUpdate:pagination":l[0]||(l[0]=o=>s.value=o),"rows-per-page-options":i.value},{item:r(o=>[y("div",za,[t(Ma,{is_admin:e.is_admin,raffle:o.row},null,8,["is_admin","raffle"])])]),_:1},8,["rows","pagination","rows-per-page-options"]))}}),ja=y("p",{class:"text-h5"},"Raffle",-1),Ba=y("p",{class:"text-h5"},"Tickets",-1),La={class:"row justify-center"},Da=y("p",{class:"text-h5"},"Whitelist",-1),Ua={class:"col q-gutter-y-sm"},Na=x({__name:"RaffleCreateRaffle",setup(e){const a=_(),i=_(),s=_(),n=_(),l=_(),o=_(),c=_([]);se(()=>f()),ae(()=>Oe().whitelists,()=>f());function f(){Oe().whitelists.forEach(u=>{c.value.push({label:"Crew",value:u.publicKey.toString()})}),c.value.push({label:"none",value:null}),o.value=c.value.find(u=>u.label=="Crew")}async function v(){var u,d;try{const g=new N,h=(u=O())==null?void 0:u.pg_raffle.value,$=new pe(window.crypto.getRandomValues(new Uint8Array(8))),G=fa(a.value,$),Y=Ne(),re=await U().connection.getParsedAccountInfo(new b(l.value.value));g.add(await(h==null?void 0:h.methods.initialize(a.value,i.value,zt(n.value,(d=re.value)==null?void 0:d.data.parsed.info.decimals),s.value,$).accountsPartial({creator:P(),raffle:G,ticketsMint:new b(l.value.value),whitelist:Y}).instruction())),await z(g,"[Raffle] Create"),await R().updateStore()}catch(g){W.create({color:"red",message:`${g}`,timeout:5e3})}}const p=_([]);return _(le().token_accounts.filter(u=>u.account.data.parsed.info.tokenAmount.uiAmount>0).flatMap(u=>u.account.data.parsed.info.mint)).value.forEach(u=>{var g,h;const d=((g=I().token_list.find($=>$.address==u))==null?void 0:g.name)??u+" ["+((h=I().token_list.find($=>$.address==u))==null?void 0:h.symbol)??"]";p.value.push({label:d,value:u})}),(u,d)=>(m(),k(te,{square:"",flat:"",class:"col q-pa-sm",style:{"max-width":"800px"}},{default:r(()=>[t(q,{class:"q-gutter-y-md"},{default:r(()=>[ja,t(J,{filled:"",square:"",modelValue:a.value,"onUpdate:modelValue":d[0]||(d[0]=g=>a.value=g),type:"text",label:"Name"},null,8,["modelValue"]),t(J,{filled:"",square:"",modelValue:i.value,"onUpdate:modelValue":d[1]||(d[1]=g=>i.value=g),type:"text",label:"Description"},null,8,["modelValue"])]),_:1}),t(L),t(q,{class:"q-gutter-y-md"},{default:r(()=>[Ba,y("div",La,[t(me,{class:"col",filled:"",square:"",modelValue:l.value,"onUpdate:modelValue":d[2]||(d[2]=g=>l.value=g),clearable:"","use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",behavior:"menu",label:"Select Ticket by mint",options:p.value,style:{width:"250px"}},{"no-option":r(()=>[t(K,null,{default:r(()=>[t(Q,{class:"text-grey"},{default:r(()=>[S(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"]),t(V,{icon:"refresh",color:"primary",square:"",onClick:d[3]||(d[3]=g=>A(le)().update_accounts())})]),t(J,{filled:"",square:"",modelValue:s.value,"onUpdate:modelValue":d[4]||(d[4]=g=>s.value=g),type:"number",label:"Tickets"},null,8,["modelValue"]),t(J,{filled:"",square:"",type:"number",modelValue:n.value,"onUpdate:modelValue":d[5]||(d[5]=g=>n.value=g),label:"Ticket Price"},null,8,["modelValue"])]),_:1}),t(q,{class:"q-gutter-y-md"},{default:r(()=>[Da,y("div",Ua,[t(me,{class:"full-width",filled:"",square:"",modelValue:o.value,"onUpdate:modelValue":d[6]||(d[6]=g=>o.value=g),clearable:"","use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",behavior:"menu",label:"Whitelist selcted",options:c.value,style:{width:"250px"}},{"no-option":r(()=>[t(K,null,{default:r(()=>[t(Q,{class:"text-grey"},{default:r(()=>[S(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])])]),_:1}),t(L),t(q,{class:"row justify-end"},{default:r(()=>[t(V,{icon:"send",square:"",class:"row",color:"primary",onClick:d[7]||(d[7]=g=>v()),label:"Create"})]),_:1})]),_:1}))}}),Wa={class:"row shadow-2"},Ha={key:0,class:"row"},Ka={key:1,class:""},Fa={key:1,class:"row justify-center"},$n=x({__name:"RafflePage",setup(e){const a=_("raffle");return se(async()=>{await R().updateStore()}),(i,s)=>(m(),k(kt,{class:"col bg-black"},{default:r(()=>[y("div",Wa,[t(lt,{modelValue:a.value,"onUpdate:modelValue":s[0]||(s[0]=n=>a.value=n),"no-caps":"","outside-arrows":"","mobile-arrows":"",class:"col bg-dark"},{default:r(()=>[t(ue,{name:"raffle",label:"Raffle"}),A(I)().is_admin?(m(),k(ue,{key:0,name:"create",label:"Create"})):T("",!0),A(I)().is_admin?(m(),k(ue,{key:1,name:"manage",label:"Manage"})):T("",!0)]),_:1},8,["modelValue"]),t(V,{flat:"",class:"bg-dark",icon:"refresh",onClick:s[1]||(s[1]=n=>A(R)().updateStore())})]),A(R)().raffles.length==0?(m(),B("div",Ha,[t(ne),t(yt,{class:"row",color:"primary",size:"10rem"}),t(ne)])):T("",!0),A(R)().raffles.length>0?(m(),B("div",Ka,[a.value==="raffle"?(m(),k(Qe,{key:0,raffles:A(R)().getRunningRaffles,is_admin:!1},null,8,["raffles"])):T("",!0),a.value==="create"?(m(),B("div",Fa,[t(Na,{class:"q-mt-xl"})])):T("",!0),a.value==="manage"?(m(),k(Qe,{key:2,raffles:A(R)().raffles,is_admin:A(I)().is_admin},null,8,["raffles","is_admin"])):T("",!0)])):T("",!0)]),_:1}))}});export{$n as default};
