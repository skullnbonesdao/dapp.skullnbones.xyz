import{a as de,Q as it}from"./QTabs.357927f9.js";import{aF as S,bZ as me,dm as ct,dn as ut,dp as ft,dh as Q,au as _,J as v,b1 as m,ak as E,al as g,as as a,cm as O,cP as K,de as $,cp as W,cS as T,cr as F,dq as pe,cU as j,ah as M,bs as ee,aT as xe,cc as Se,c7 as Te,bC as dt,aC as ze,b_ as Be,cd as mt,ar as C,bx as c,V as b,cn as pt,cV as vt,aX as ne,bz as yt,a6 as Ee,df as le,dr as gt,ai as y,a1 as D,P as je,ds as kt,d6 as ht,dt as Ue,d9 as ve,du as De,dv as Ne,b9 as wt,aj as w,cW as bt,co as Z,dw as se,cQ as oe,cX as _t,ck as re,dx as xt}from"./index.cf301924.js";import{Q as te}from"./QSpace.3d522f2e.js";import{Q as St}from"./QPage.9c9521fc.js";import{f as Le,Q as Tt,a as ye}from"./WhitelistInterface.c2dea5e9.js";import{Q as Ke}from"./QImg.1913682e.js";import{Q as L,a as V}from"./QInput.b0c076f2.js";import{Q as I}from"./QSeparator.d2cc2b28.js";import{A as $t,u as At,m as Pt,B as $e,C as Ct,e as qt,n as Rt,f as Qt,o as Vt,D as Ot,E as Mt,h as It,p as zt,F as Ae,G as Bt,c as Pe,g as Et,H as Ce,I as jt,Q as J,j as N,k as B}from"./rtl.e52b5641.js";import{Q as Ut}from"./QList.e243a32e.js";import{Q as qe}from"./QExpansionItem.4a3f971f.js";import{Q as We}from"./QCardActions.f652d359.js";import{Q as ae,u as Dt,a as Nt}from"./use-key-composition.10000431.js";import{h as z}from"./handleTransaction.c00ea172.js";import{_ as He}from"./TokenSelectDropdown.b81a236a.js";import{_ as Lt,f as ie}from"./format_address.2f7b0b45.js";import{c as Kt,Q as Wt}from"./QSelect.a57a0909.js";import{C as Ht}from"./ClosePopup.7d3a010e.js";import{Q as Re}from"./QBadge.a78fff63.js";import{_ as Ft}from"./plugin-vue_export-helper.21dcd24c.js";import"./QResizeObserver.7f1663f0.js";import"./QCheckbox.f01a2b32.js";import"./use-checkbox.cff3b875.js";import"./QSlideTransition.813e1dc5.js";import"./FormatNumber.8e11c58a.js";const Gt=[S("rect",{x:"0",y:"0",width:"100",height:"100",fill:"none"}),S("g",{transform:"translate(25 25)"},[S("rect",{x:"-20",y:"-20",width:"40",height:"40",fill:"currentColor",opacity:"0.9"},[S("animateTransform",{attributeName:"transform",type:"scale",from:"1.5",to:"1",repeatCount:"indefinite",begin:"0s",dur:"1s",calcMode:"spline",keySplines:"0.2 0.8 0.2 0.8",keyTimes:"0;1"})])]),S("g",{transform:"translate(75 25)"},[S("rect",{x:"-20",y:"-20",width:"40",height:"40",fill:"currentColor",opacity:"0.8"},[S("animateTransform",{attributeName:"transform",type:"scale",from:"1.5",to:"1",repeatCount:"indefinite",begin:"0.1s",dur:"1s",calcMode:"spline",keySplines:"0.2 0.8 0.2 0.8",keyTimes:"0;1"})])]),S("g",{transform:"translate(25 75)"},[S("rect",{x:"-20",y:"-20",width:"40",height:"40",fill:"currentColor",opacity:"0.7"},[S("animateTransform",{attributeName:"transform",type:"scale",from:"1.5",to:"1",repeatCount:"indefinite",begin:"0.3s",dur:"1s",calcMode:"spline",keySplines:"0.2 0.8 0.2 0.8",keyTimes:"0;1"})])]),S("g",{transform:"translate(75 75)"},[S("rect",{x:"-20",y:"-20",width:"40",height:"40",fill:"currentColor",opacity:"0.6"},[S("animateTransform",{attributeName:"transform",type:"scale",from:"1.5",to:"1",repeatCount:"indefinite",begin:"0.2s",dur:"1s",calcMode:"spline",keySplines:"0.2 0.8 0.2 0.8",keyTimes:"0;1"})])])];var Yt=me({name:"QSpinnerCube",props:ct,setup(e){const{cSize:t,classes:i}=ut(e);return()=>S("svg",{class:i.value,width:t.value,height:t.value,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid"},Gt)}});const A=ft("raffleStore",{state:()=>({raffles:[]}),getters:{getRunningRaffles(e){return e.raffles.filter(t=>Object.keys(t.account.state)[0]=="running"||Object.keys(t.account.state)[0]=="full"||Object.keys(t.account.state)[0]=="claimprize").sort((t,i)=>t.account.name.localeCompare(i.account.name))}},actions:{async updateStore(){if(Q())try{const e=Q().pg_raffle.value;this.raffles=(await(e==null?void 0:e.account.raffle.all())).sort((t,i)=>t.account.name.localeCompare(i.account.name)),console.log("[Updated] RaffleStore")}catch(e){console.error(e)}}}}),Xt={class:"col q-pa-sm"},Jt=g("p",{class:"text-overline"},"Add a prize:",-1),Zt={class:"col q-gutter-y-sm"},ea={class:"row"},ta=_({__name:"RafflePrepare",props:["raffle"],setup(e){const t=v(1),i=v(""),o=v(""),n=e;v([]);async function l(){var s,r,d,p;try{const u=new K,f=(s=Q())==null?void 0:s.pg_raffle.value,k=new $(o.value.mint),h=(await W().connection.getParsedTokenAccountsByOwner(T(),{mint:k})).value[0].pubkey,P=new $(n.raffle.publicKey.toString()),q=await W().connection.getParsedAccountInfo(k);console.log((r=q.value)==null?void 0:r.data.parsed.info.decimals),i.value=((d=F().token_list.find(x=>x.address==k))==null?void 0:d.logoURI)??"",u.add(await(f==null?void 0:f.methods.prepare(new pe(t.value*Math.pow(10,(p=q.value)==null?void 0:p.data.parsed.info.decimals)),i.value).accountsPartial({creator:T(),raffle:P,from:h,prizeMint:k}).instruction())),await z(u,"[Raffle] prepare"),await A().updateStore()}catch(u){j.create({color:"red",message:`${u}`,timeout:5e3})}}return(s,r)=>(m(),E("div",Xt,[Jt,g("div",Zt,[a(He,{label:"","textbox-label":"Select prize",onToken_account_selected:r[0]||(r[0]=d=>o.value=d)}),g("div",ea,[a(L,{class:"col",filled:"",square:"",modelValue:t.value,"onUpdate:modelValue":r[1]||(r[1]=d=>t.value=d),type:"number",label:"Count"},null,8,["modelValue"]),a(O,{filled:"",square:"",class:"col-2",color:"primary",icon:"send",onClick:r[2]||(r[2]=d=>l())})])])]))}});var aa=me({name:"QTooltip",inheritAttrs:!1,props:{...$t,...At,...Pt,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{default:"jump-down"},transitionHide:{default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:$e},self:{type:String,default:"top middle",validator:$e},offset:{type:Array,default:()=>[14,14],validator:Ct},scrollTarget:{default:void 0},delay:{type:Number,default:0},hideDelay:{type:Number,default:0}},emits:[...qt],setup(e,{slots:t,emit:i,attrs:o}){let n,l;const s=ze(),{proxy:{$q:r}}=s,d=v(null),p=v(!1),u=M(()=>Ce(e.anchor,r.lang.rtl)),f=M(()=>Ce(e.self,r.lang.rtl)),k=M(()=>e.persistent!==!0),{registerTick:h,removeTick:P}=Rt(),{registerTimeout:q}=Qt(),{transitionProps:x,transitionStyle:G}=Vt(e),{localScrollTarget:ge,changeScrollEvent:Ye,unconfigureScrollTarget:Xe}=Ot(e,be),{anchorEl:U,canShow:Je,anchorEvents:Y}=Mt({showing:p,configureAnchorEl:st}),{show:Ze,hide:ue}=It({showing:p,canShow:Je,handleShow:tt,handleHide:at,hideOnRouteChange:k,processOnMount:!0});Object.assign(Y,{delayShow:nt,delayHide:lt});const{showPortal:ke,hidePortal:he,renderPortal:et}=zt(s,d,rt,"tooltip");if(r.platform.is.mobile===!0){const R={anchorEl:U,innerRef:d,onClickOutside(H){return ue(H),H.target.classList.contains("q-dialog__backdrop")&&mt(H),!0}},fe=M(()=>e.modelValue===null&&e.persistent!==!0&&p.value===!0);ee(fe,H=>{(H===!0?jt:Ae)(R)}),xe(()=>{Ae(R)})}function tt(R){ke(),h(()=>{l=new MutationObserver(()=>X()),l.observe(d.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),X(),be()}),n===void 0&&(n=ee(()=>r.screen.width+"|"+r.screen.height+"|"+e.self+"|"+e.anchor+"|"+r.lang.rtl,X)),q(()=>{ke(!0),i("show",R)},e.transitionDuration)}function at(R){P(),he(),we(),q(()=>{he(!0),i("hide",R)},e.transitionDuration)}function we(){l!==void 0&&(l.disconnect(),l=void 0),n!==void 0&&(n(),n=void 0),Xe(),Se(Y,"tooltipTemp")}function X(){Bt({targetEl:d.value,offset:e.offset,anchorEl:U.value,anchorOrigin:u.value,selfOrigin:f.value,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function nt(R){if(r.platform.is.mobile===!0){Pe(),document.body.classList.add("non-selectable");const fe=U.value,H=["touchmove","touchcancel","touchend","click"].map(_e=>[fe,_e,"delayHide","passiveCapture"]);Te(Y,"tooltipTemp",H)}q(()=>{Ze(R)},e.delay)}function lt(R){r.platform.is.mobile===!0&&(Se(Y,"tooltipTemp"),Pe(),setTimeout(()=>{document.body.classList.remove("non-selectable")},10)),q(()=>{ue(R)},e.hideDelay)}function st(){if(e.noParentEvent===!0||U.value===null)return;const R=r.platform.is.mobile===!0?[[U.value,"touchstart","delayShow","passive"]]:[[U.value,"mouseenter","delayShow","passive"],[U.value,"mouseleave","delayHide","passive"]];Te(Y,"anchor",R)}function be(){if(U.value!==null||e.scrollTarget!==void 0){ge.value=Et(U.value,e.scrollTarget);const R=e.noParentEvent===!0?X:ue;Ye(ge.value,R)}}function ot(){return p.value===!0?S("div",{...o,ref:d,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",o.class],style:[o.style,G.value],role:"tooltip"},Be(t.default)):null}function rt(){return S(dt,x.value,ot)}return xe(we),Object.assign(s.proxy,{updatePosition:X}),et}});const na={key:0,class:"col q-pa-sm q-gutter-y-sm"},la=g("p",{class:"text-h6"},"Buy Tickets",-1),sa={class:"row"},oa={class:"row"},ra={class:"text-caption text-right text-weight-thin"},ia={class:"col"},ca={key:1,class:"row full-width justify-center"},ua=_({__name:"RaffleBuyTicket",props:["raffle","tickets"],setup(e){const t=v(),i=e,o=M(()=>!vt().publicKey.value);async function n(){var k,h,P;const l=new K,s=(k=Q())==null?void 0:k.pg_raffle.value,r=(h=Q())==null?void 0:h.pg_whitelist.value,d=new $(i.raffle.account.ticketMint.toString()),p=(await W().connection.getParsedTokenAccountsByOwner(T(),{mint:d})).value[0].pubkey,u=new $(i.raffle.publicKey.toString());let f=Le();try{l.add(await(s==null?void 0:s.methods.buyTickets(new pe(t.value)).accountsPartial({signer:T(),raffle:u,entrant:T(),ticketsMint:d,from:p,whitelist:f,whitelistEntry:$.findProgramAddressSync([(P=T())==null?void 0:P.toBytes(),f.toBytes()],r==null?void 0:r.programId)[0],whitelistProgram:r==null?void 0:r.programId}).instruction())),await z(l,"[Raffle] buy ticket"),await A().updateStore()}catch(q){j.create({color:"danger",message:`${q}`,timeout:5e3})}}return(l,s)=>o.value?(m(),E("div",ca,[a(b(pt),{class:"",dark:""})])):(m(),E("div",na,[la,g("div",sa,[a(L,{square:"",filled:"",outlined:"",type:"number",class:"col",label:"Amount",modelValue:t.value,"onUpdate:modelValue":s[0]||(s[0]=r=>t.value=r)},null,8,["modelValue"]),a(O,{square:"",disable:!t.value,color:"primary",icon:"send",onClick:s[1]||(s[1]=r=>n())},null,8,["disable"])]),g("div",oa,[a(te),g("p",ra,[C(" 0.001\u25CE fee "),a(aa,{anchor:"bottom right",self:"top middle"},{default:c(()=>[C(" cover deployment costs ")]),_:1})])]),g("div",ia,[a(Lt,{mint:e.raffle.account.ticketMint},null,8,["mint"])])]))}}),fa=g("source",{src:"Burningticket.mp4",type:"video/mp4"},null,-1),da=_({__name:"BurningTicket",setup(e){const t=v();return ne(()=>{t.value.playbackRate=.3,console.log(t.value)}),(i,o)=>(m(),E("video",{ref_key:"ticket_burning",ref:t,autoplay:"",playbackspeed:"0.1"},[fa,C(" Your browser does not support the video tag. ")],512))}}),ma=g("div",{class:"text-h6 text-center"},"Drawing...",-1),pa=_({__name:"RaffleRevealWinner",props:["raffle","is_admin"],setup(e){v();const t=e,i=v(!1);ee(()=>i.value,()=>{i.value==!1&&A().updateStore()});async function o(){var n;try{const l=new K,s=(n=Q())==null?void 0:n.pg_raffle.value,r=new $(t.raffle.publicKey.toString());let[d,p]=$.findProgramAddressSync([le("tickets"),r.toBytes()],s==null?void 0:s.programId);l.add(await(s==null?void 0:s.methods.revealWinners().accounts({raffle:r,tickets:d,recentBlockHashes:gt}).instruction())),await z(l,"[Raffle] reveal winner"),i.value=!0}catch(l){j.create({color:"red",message:`${l}`,timeout:5e3})}}return(n,l)=>(m(),E(Ee,null,[a(O,{square:"",class:"row",color:"primary",icon:"send",label:"Reveal Winner",onClick:l[0]||(l[0]=s=>o())}),a(Kt,{maximized:!0,modelValue:i.value,"onUpdate:modelValue":l[2]||(l[2]=s=>i.value=s)},{default:c(()=>[a(ae,{flat:"",square:"",class:""},{default:c(()=>[a(V,null,{default:c(()=>[ma]),_:1}),a(V,{class:"q-pt-none row"},{default:c(()=>[a(te),a(da),a(te)]),_:1}),a(We,{align:"right"},{default:c(()=>[yt(a(O,{flat:"",label:"close",color:"primary",onClick:l[1]||(l[1]=s=>b(A)().update_raffles())},null,512),[[Ht]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),va={class:"absolute-full flex flex-center"};var Fe=(e=>(e.created="orange",e.ready="orange",e.paused="pink",e.full="purple",e.claimprize="purple",e.claimtickets="purple",e.running="primary",e))(Fe||{});const ya=_({__name:"RaffleStateBadge",props:["raffle","tickets"],setup(e){const t=e,i=M(()=>{var o,n;return((o=t.tickets)==null?void 0:o.sold)/((n=t.tickets)==null?void 0:n.total)});return(o,n)=>Object.keys(e.raffle.account.state)[0]=="running"?(m(),y(Tt,{key:0,size:"25px",value:i.value,color:"primary"},{default:c(()=>{var l,s;return[g("div",va,[a(Re,{color:"black","text-color":"primary",label:`Tickets: ${(l=e.tickets)==null?void 0:l.sold}/${(s=e.tickets)==null?void 0:s.total}`},null,8,["label"])])]}),_:1},8,["value"])):(m(),y(Re,{key:1,color:Fe[Object.keys(e.raffle.account.state)[0]],class:"text-h6 justify-center full-width"},{default:c(()=>[C(D(Object.keys(e.raffle.account.state)[0].toUpperCase()),1)]),_:1},8,["color"]))}}),ce=new je(kt.address);function ga(e,t){return $.findProgramAddressSync([le("raffle"),t.toArrayLike(ht.Buffer).reverse()],ce)[0]}function ka(e){return $.findProgramAddressSync([le("tickets"),e.toBytes()],ce)[0]}function Ge(e){return $.findProgramAddressSync([le("vaultPrize"),e.toBytes()],ce)[0]}function ha(e){return $.findProgramAddressSync([le("vaultTickets"),e.toBytes()],ce)[0]}const wa=_({__name:"RaffleClaimPrize",props:["raffle","is_admin"],setup(e){const t=e;async function i(){var o;try{let n=new K;const l=(o=Q())==null?void 0:o.pg_raffle.value,s=new $(t.raffle.account.prizeMint.toString()),r=new $(t.raffle.account.winner.toString()),d=await Ue(s,r,!0,ve,De.ASSOCIATED_PROGRAM_ID);await W().connection.getAccountInfo(d)===null&&n.add(Ne(T(),d,r,s));const p=new $(t.raffle.publicKey.toString()),u=Ge(p);n.add(await(l==null?void 0:l.methods.claimPrize().accountsPartial({raffle:p,prizeMint:s,prizeVault:u,to:d}).instruction())),await z(n,"[Raffle] Claim Prize"),await A().updateStore()}catch(n){j.create({color:"red",message:`${n}`,timeout:5e3,position:"bottom-right"})}}return(o,n)=>(m(),y(O,{color:"primary",icon:"send",label:"Claim Prize",onClick:n[0]||(n[0]=l=>i())}))}});async function ba(e){try{return!!await W().connection.getAccountInfo(e)}catch(t){return console.error("Error checking account:",t),!1}}const _a=_({__name:"RaffleClose",props:["raffle"],setup(e){const t=e;async function i(){var o;try{const n=new K,l=(o=Q())==null?void 0:o.pg_raffle.value;let s=t.raffle.publicKey;const r=ka(s),d=ha(s);let p=Ge(s);await ba(p)||(p=null),n.add(await(l==null?void 0:l.methods.close().accountsPartial({creator:T(),raffle:s,tickets:r,ticketsVault:d,prizeVault:p}).instruction())),await z(n,"[Raffle] close"),await A().updateStore()}catch(n){j.create({color:"red",message:`${n}`,timeout:5e3})}}return(o,n)=>(m(),y(O,{square:"",color:"primary",icon:"send",label:"Close Raffle",onClick:n[0]||(n[0]=l=>i())}))}}),xa=_({__name:"RaffleClaimTickets",props:["raffle","is_admin"],setup(e){const t=e;async function i(){var o;try{const n=new K,l=(o=Q())==null?void 0:o.pg_raffle.value,s=new $(t.raffle.account.ticketMint.toString()),r=await Ue(s,T(),!0,ve,De.ASSOCIATED_PROGRAM_ID);await W().connection.getAccountInfo(r)===null&&n.add(Ne(T(),r,T(),s)),n.add(await(l==null?void 0:l.methods.claimTickets().accountsPartial({creator:T(),raffle:t.raffle.publicKey,ticketsMint:s,to:r}).instruction())),await z(n,"[Raffle Claim Tickets]"),await A().updateStore()}catch(n){j.create({color:"red",message:`${n}`,timeout:5e3,position:"bottom-right"})}}return(o,n)=>(m(),y(O,{color:"primary",icon:"send",label:"Claim Tickets",onClick:n[0]||(n[0]=l=>i())}))}}),Sa=_({__name:"AccountsTable",props:["accounts"],setup(e){const t=v({rowsPerPage:0}),i=v([{name:"mint",required:!0,label:"Mint",align:"left",field:"mint",field:o=>{var n,l;return((n=F().token_list.find(s=>{var r;return s.address==((r=o.mint)==null?void 0:r.toString())}))==null?void 0:n.name)??((l=o.mint)==null?void 0:l.toString())},sortable:!0},{name:"calories",align:"right",label:"Amount",field:o=>o.tokenAmount.uiAmount,sortable:!0}]);return(o,n)=>{var l,s;return m(),y(ye,{square:"",dense:"",class:"col",title:"Accounts",rows:(s=(l=e.accounts)==null?void 0:l.value)==null?void 0:s.map(r=>r.account.data.parsed.info),columns:i.value,"row-key":"mint","hide-bottom":"",flat:"",pagination:t.value,"onUpdate:pagination":n[0]||(n[0]=r=>t.value=r),"rows-per-page-options":[0]},null,8,["rows","columns","pagination"])}}}),Qe=9,Ta=95,$a=45,Ve=5;function Aa(e){return e.split("").reduce((t,i)=>(t^i.charCodeAt(0))*-Ve,Ve)>>>2}function Pa(e="",t=Ta,i=$a,o=Aa){const n=o(e),l=n%Qe*(360/Qe);return[...Array(e?25:0)].reduce((s,r,d)=>n&1<<d%15?s+`<rect x="${d>14?7-~~(d/5):~~(d/5)}" y="${d%5}" width="1" height="1"/>`:s,`<svg viewBox="-1.5 -1.5 8 8" xmlns="http://www.w3.org/2000/svg" fill="hsl(${l} ${t}% ${i}%)">`)+"</svg>"}const Ca=["innerHTML"],qa=_({__name:"IconFromSeed",props:{seed:{type:String,default:"default"}},setup(e){const i=v(Pa(e.seed));return(o,n)=>(m(),E("div",{innerHTML:i.value},null,8,Ca))}}),Ra=["text","rect","circle","QBtn","QBadge","QChip","QToolbar","QCheckbox","QRadio","QToggle","QSlider","QRange","QInput","QAvatar"],Qa=["wave","pulse","pulse-x","pulse-y","fade","blink","none"];var Va=me({name:"QSkeleton",props:{...Dt,tag:{type:String,default:"div"},type:{type:String,validator:e=>Ra.includes(e),default:"rect"},animation:{type:String,validator:e=>Qa.includes(e),default:"wave"},animationSpeed:{type:[String,Number],default:1500},square:Boolean,bordered:Boolean,size:String,width:String,height:String},setup(e,{slots:t}){const i=ze(),o=Nt(e,i.proxy.$q),n=M(()=>{const s=e.size!==void 0?[e.size,e.size]:[e.width,e.height];return{"--q-skeleton-speed":`${e.animationSpeed}ms`,width:s[0],height:s[1]}}),l=M(()=>`q-skeleton q-skeleton--${o.value===!0?"dark":"light"} q-skeleton--type-${e.type}`+(e.animation!=="none"?` q-skeleton--anim q-skeleton--anim-${e.animation}`:"")+(e.square===!0?" q-skeleton--square":"")+(e.bordered===!0?" q-skeleton--bordered":""));return()=>S(e.tag,{class:l.value,style:n.value},Be(t.default))}});const Oa=_({__name:"Apex_TicketsChart",props:["data_value","data_label"],setup(e){const t=e,i=M(()=>t.data_value?t.data_value:[44,55,41,17,15]),o=M(()=>t.data_label?{legend:{labels:{colors:"white"},position:"left"},theme:{palette:"palette3"},labels:t.data_label}:{labels:["Apple","Mango","Orange","Watermelon"]});return(n,l)=>{const s=wt("apexchart");return e.data_value&&e.data_label?(m(),y(s,{key:0,height:"200px",type:"donut",options:o.value,series:i.value},null,8,["options","series"])):w("",!0)}}}),Ma=_({__name:"TicketsTable",props:["raffle","ticketsAccount"],setup(e){const t=e,i=v({rowsPerPage:0}),o=v();ne(async()=>{console.log(t.raffle),await n()}),ee(()=>t.ticketsAccount,async()=>{await n(),await u()});async function n(){if(!t.ticketsAccount)return;const{pg_raffle:f}=Q(),k=await f.value.account.tickets.getAccountInfo(t.raffle.account.tickets);let h=[];for(let x=0;x<t.ticketsAccount.total;x++){let G=l(k.data,x);h.push(G)}const q=h.map(x=>x.toString()).reduce((x,G)=>({...x,[G]:(x[G]||0)+1}),{});o.value=Object.entries(q).flatMap(x=>({address:x[0],amount:x[1]}))}function l(f,k){const h=16+32*k,P=h+32,q=f.slice(h,P);return new je(q)}v();const s=v([{name:"wallet",required:!0,label:"Wallet",align:"left",field:f=>ie(f.address),sortable:!0},{name:"amount",align:"right",label:"Amount",field:"amount",sortable:!0}]),r=v(),d=v(),p=v(!0);async function u(){var k,h;r.value=(k=o.value)==null?void 0:k.map(P=>P.amount);const f=(h=o.value)==null?void 0:h.flatMap(P=>ie(P.address));d.value=f,p.value=!1}return(f,k)=>(m(),E(Ee,null,[a(ye,{square:"",dense:"",class:"col",title:"Tickets",rows:o.value,columns:s.value,"row-key":"mint","hide-bottom":"",flat:"",pagination:i.value,"onUpdate:pagination":k[0]||(k[0]=h=>i.value=h),"rows-per-page-options":[0]},null,8,["rows","columns","pagination"]),p.value?(m(),y(Va,{key:0,type:"QInput"})):w("",!0),a(Oa,{data_value:r.value,data_label:d.value},null,8,["data_value","data_label"])],64))}}),Ia={};function za(e,t){return m(),y(bt,{size:"xs"},{default:c(()=>[a(Ke,{src:"solscan.png"})]),_:1})}var Oe=Ft(Ia,[["render",za]]);const Ba=g("div",{class:"col q-gutter-y-sm"},[g("div",null,"Raffle account"),g("div",null,"Entrants account"),g("div",null,"Use Whitelist?")],-1),Ea={class:"col q-gutter-y-sm"},ja=_({__name:"RaffleLinks",props:["raffle","entrants"],setup(e){const t=e;return v({rowsPerPage:0}),(i,o)=>(m(),y(ae,{flat:"",square:"",class:"row items-center q-pa-md"},{default:c(()=>[Ba,g("div",Ea,[a(O,{class:"full-width",size:"xs",square:"",color:"primary",href:"https://solscan.io/account/"+t.raffle.publicKey,target:"_blank"},{default:c(()=>[a(Oe)]),_:1},8,["href"]),a(O,{class:"full-width",square:"",size:"xs",color:"primary",href:"https://solscan.io/account/"+t.raffle.account.entrants,target:"_blank"},{default:c(()=>[a(Oe)]),_:1},8,["href"]),e.raffle.account.useWhitelist?(m(),y(Z,{key:0,name:"check"})):(m(),y(Z,{key:1,name:"clear"}))])]),_:1}))}}),Ua=_({__name:"RaffleToggleMode",props:["raffle"],setup(e){const t=e;async function i(){var o;try{const n=new K,l=(o=Q())==null?void 0:o.pg_raffle.value;let s=await(l==null?void 0:l.account.raffle.fetch(t.raffle.publicKey));console.log(s),console.log(Object.keys(s.state)[0]);let r;switch(Object.keys(s.state)[0]){case"ready":n.add(await(l==null?void 0:l.methods.enable().accountsPartial({creator:T(),raffle:t.raffle.publicKey}).instruction())),await z(n,"[Raffle] enable");break;case"paused":n.add(await(l==null?void 0:l.methods.enable().accountsPartial({creator:T(),raffle:t.raffle.publicKey}).instruction())),await z(n,"[Raffle] enable");break;case"running":n.add(await(l==null?void 0:l.methods.disable().accountsPartial({creator:T(),raffle:t.raffle.publicKey}).instruction())),await z(n,"[Raffle] disable");break}await A().updateStore()}catch(n){j.create({color:"red",message:`${n}`,timeout:5e3})}}return(o,n)=>(m(),y(O,{icon:"send",label:"Start/Pause",square:"",color:"primary",onClick:n[0]||(n[0]=l=>i())}))}}),Da=_({__name:"RaffleEdit",props:["raffle"],setup(e){const t=v(""),i=v(""),o=v(""),n=e;ne(()=>{t.value=n.raffle.account.name,i.value=n.raffle.account.description,o.value=n.raffle.account.url});async function l(){var d;const s=new K,r=(d=Q())==null?void 0:d.pg_raffle.value;try{s.add(await(r==null?void 0:r.methods.edit(t.value,i.value,o.value).accountsPartial({creator:T(),raffle:n.raffle.publicKey}).instruction())),await z(s,"[Raffle] update"),await A().updateStore()}catch(p){j.create({color:"danger",message:`${p}`,timeout:5e3})}}return(s,r)=>(m(),E("div",null,[a(L,{square:"",filled:"",label:"Name",modelValue:t.value,"onUpdate:modelValue":r[0]||(r[0]=d=>t.value=d)},null,8,["modelValue"]),a(L,{square:"",filled:"",label:"Description",modelValue:i.value,"onUpdate:modelValue":r[1]||(r[1]=d=>i.value=d)},null,8,["modelValue"]),a(L,{square:"",filled:"",label:"Image-URL",modelValue:o.value,"onUpdate:modelValue":r[2]||(r[2]=d=>o.value=d)},null,8,["modelValue"]),a(O,{square:"",class:"full-width",color:"primary",label:"Update",onClick:r[3]||(r[3]=d=>l())})]))}});async function Me(e){try{await navigator.clipboard.writeText(e),j.create({message:`Clipboard: ${e}`,position:"bottom-right",type:"info"})}catch{alert("Cannot copy")}}const Na={class:"text-h5 q-mt-sm q-mb-xs"},La={class:"text-caption text-grey"},Ka=g("p",{class:"text-overline"},"Actions",-1),Wa={class:"col row justify-end q-mx-sm"},Ha=_({__name:"RaffleCard",props:["raffle","is_admin"],setup(e){const t=e,i=v(),o=v(),n=v();async function l(){const{pg_raffle:d}=Q();i.value=await d.value.account.tickets.fetch(t.raffle.account.tickets)}async function s(){o.value=await W().connection.getParsedTokenAccountsByOwner(t.raffle.publicKey,{programId:ve})}ne(async()=>{await se(l),await se(s)}),ee(()=>t.raffle,async()=>{await se(l),await se(s)});const r=M(()=>t.raffle.account.url.length>0?t.raffle.account.url.toString():"unknown.svg");return ie(""),oe(),(d,p)=>(m(),y(ae,{square:"",flat:""},{default:c(()=>[a(Ke,{height:"200px",src:r.value},null,8,["src"]),a(V,null,{default:c(()=>[a(ya,{raffle:e.raffle,tickets:i.value},null,8,["raffle","tickets"]),g("div",Na,D(e.raffle.account.name),1),g("div",La,D(e.raffle.account.description),1)]),_:1}),a(I),a(V,null,{default:c(()=>[a(Ut,null,{default:c(()=>[a(J,{clickable:""},{default:c(()=>[a(N,{avatar:""},{default:c(()=>[a(Z,{color:"primary",name:"functions"})]),_:1}),a(N,null,{default:c(()=>[a(B,{class:"text-h6"},{default:c(()=>{var u;return[C(D((u=i.value)==null?void 0:u.total)+" Tickets",1)]}),_:1}),a(B,{class:"text-accent",caption:""},{default:c(()=>[C("Total tickets")]),_:1})]),_:1})]),_:1}),a(J,{clickable:""},{default:c(()=>[a(N,{avatar:""},{default:c(()=>[a(Z,{color:"red",name:"paid"})]),_:1}),a(N,null,{default:c(()=>[a(B,{class:"text-h6"},{default:c(()=>{var u;return[C(D((e.raffle.account.ticketPrice.toNumber()*Math.pow(10,-e.raffle.account.ticketDecimals)).toFixed(2))+" "+D((u=b(oe)().tokenList.find(f=>f.address==e.raffle.account.ticketMint.toString()))==null?void 0:u.symbol),1)]}),_:1}),a(B,{class:"text-accent",caption:""},{default:c(()=>[C("Price per ticket")]),_:1})]),_:1})]),_:1}),a(J,{clickable:""},{default:c(()=>[a(N,{avatar:""},{default:c(()=>[a(Z,{color:"amber",name:"local_movies"})]),_:1}),a(N,{class:"q-gutter-y-md"},{default:c(()=>[g("div",{onClick:p[0]||(p[0]=u=>b(Me)(e.raffle.account.prizeMint.toString()))},[a(B,{class:"q-pt-md text-overline"},{default:c(()=>{var u;return[C(D(((u=b(oe)().tokenList.find(f=>f.address==e.raffle.account.prizeMint.toString()))==null?void 0:u.name)??e.raffle.account.ticketMint.toString()),1)]}),_:1}),a(B,{class:"text-accent",caption:""},{default:c(()=>[C("Prize-Mint")]),_:1})]),g("div",{onClick:p[1]||(p[1]=u=>b(Me)(e.raffle.account.ticketMint.toString()))},[a(B,{class:"text-overline"},{default:c(()=>{var u;return[C(D(((u=b(oe)().tokenList.find(f=>f.address==e.raffle.account.ticketMint.toString()))==null?void 0:u.name)??e.raffle.account.ticketMint.toString()),1)]}),_:1}),a(B,{class:"text-accent",caption:""},{default:c(()=>[C("Ticket-Mint")]),_:1})])]),_:1})]),_:1}),e.raffle.account.randomness!=null?(m(),y(J,{key:0,clickable:""},{default:c(()=>[a(N,{avatar:""},{default:c(()=>{var u,f;return[a(qa,{style:{width:"100px"},seed:(f=(u=e.raffle.account)==null?void 0:u.winner)==null?void 0:f.toString()},null,8,["seed"])]}),_:1}),a(N,null,{default:c(()=>[a(B,{class:"text-h6",l:""},{default:c(()=>[C("Winner")]),_:1}),a(B,{class:"text-orange-9",caption:""},{default:c(()=>{var u;return[C(D(b(ie)((u=e.raffle.account.winner)==null?void 0:u.toString())),1)]}),_:1})]),_:1})]),_:1})):w("",!0)]),_:1})]),_:1}),a(I),e.is_admin?(m(),y(qe,{key:0,icon:"info",label:"Edit"},{default:c(()=>[a(Da,{raffle:e.raffle},null,8,["raffle"])]),_:1})):w("",!0),e.is_admin?(m(),y(I,{key:1})):w("",!0),Object.keys(e.raffle.account.state)[0]=="running"&&!e.is_admin?(m(),y(We,{key:2},{default:c(()=>[a(ua,{raffle:e.raffle,tickets:i.value},null,8,["raffle","tickets"])]),_:1})):w("",!0),a(I),e.is_admin?w("",!0):(m(),y(qe,{key:3,icon:"info",label:"Details"},{default:c(()=>[a(ae,{flat:""},{default:c(()=>[a(I),a(V,null,{default:c(()=>[a(Sa,{accounts:o.value},null,8,["accounts"])]),_:1}),a(I),a(V,null,{default:c(()=>[a(Ma,{raffle:e.raffle,"tickets-account":i.value},null,8,["raffle","tickets-account"])]),_:1}),a(I),a(V,null,{default:c(()=>[a(ja,{raffle:e.raffle,entrants:n.value,class:"q-pb-md"},null,8,["raffle","entrants"])]),_:1})]),_:1})]),_:1})),e.is_admin?w("",!0):(m(),y(I,{key:4})),e.is_admin?(m(),y(V,{key:5},{default:c(()=>[Object.keys(e.raffle.account.state)[0]=="created"?(m(),y(ta,{key:0,raffle:e.raffle},null,8,["raffle"])):w("",!0)]),_:1})):w("",!0),e.is_admin?(m(),y(V,{key:6,class:"col"},{default:c(()=>[Ka,g("div",Wa,[Object.keys(e.raffle.account.state)[0]=="full"?(m(),y(pa,{key:0,raffle:e.raffle},null,8,["raffle"])):w("",!0),Object.keys(e.raffle.account.state)[0]=="claimprize"||Object.keys(e.raffle.account.state)[0]=="ready"?(m(),y(wa,{key:1,raffle:e.raffle},null,8,["raffle"])):w("",!0),Object.keys(e.raffle.account.state)[0]=="claimtickets"?(m(),y(xa,{key:2,raffle:e.raffle},null,8,["raffle"])):w("",!0),Object.keys(e.raffle.account.state)[0]=="ready"||Object.keys(e.raffle.account.state)[0]=="running"||Object.keys(e.raffle.account.state)[0]=="paused"?(m(),y(Ua,{key:3,raffle:e.raffle},null,8,["raffle"])):w("",!0),Object.keys(e.raffle.account.state)[0]=="created"||Object.keys(e.raffle.account.state)[0]=="done"?(m(),y(_a,{key:4,raffle:e.raffle},null,8,["raffle"])):w("",!0)])]),_:1})):w("",!0)]),_:1}))}}),Fa={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},Ie=_({__name:"RaffleGrid",props:{is_admin:{type:Boolean,default:!1},raffles:{type:[],default:[]},count:{type:Number,default:0}},setup(e){const t=e,i=M(()=>[0]),o=v({rowsPerPage:0});return(n,l)=>(m(),y(ye,{grid:"",rows:t.raffles,"row-key":"name","hide-header":"",pagination:o.value,"onUpdate:pagination":l[0]||(l[0]=s=>o.value=s),"rows-per-page-options":i.value},{item:c(s=>[g("div",Fa,[a(Ha,{is_admin:e.is_admin,raffle:s.row},null,8,["is_admin","raffle"])])]),_:1},8,["rows","pagination","rows-per-page-options"]))}}),Ga=g("p",{class:"text-h5"},"Raffle",-1),Ya=g("p",{class:"text-h5"},"Tickets",-1),Xa={class:""},Ja=g("p",{class:"text-h5"},"Whitelist",-1),Za={class:"col q-gutter-y-sm"},en=_({__name:"RaffleCreateRaffle",setup(e){const t=v(),i=v(),o=v(),n=v(),l=v();async function s(){var p,u;try{const f=new K,k=(p=Q())==null?void 0:p.pg_raffle.value,h=new pe(window.crypto.getRandomValues(new Uint8Array(8))),P=ga(t.value,h),q=Le(),x=await W().connection.getParsedAccountInfo(new $(l.value.mint));f.add(await(k==null?void 0:k.methods.initialize(t.value,i.value,xt(n.value,(u=x.value)==null?void 0:u.data.parsed.info.decimals),o.value,h).accountsPartial({creator:T(),raffle:P,ticketsMint:new $(l.value.mint),whitelist:re().whitelistSelected.publicKey}).instruction())),await z(f,"[Raffle] Create"),await A().updateStore()}catch(f){j.create({color:"red",message:`${f}`,timeout:5e3})}}const r=v([]);return v(_t().accounts.filter(p=>p.account.data.parsed.info.tokenAmount.uiAmount>0).flatMap(p=>p.account.data.parsed.info.mint)).value.forEach(p=>{var f,k;const u=((f=F().token_list.find(h=>h.address==p))==null?void 0:f.name)??p+" ["+((k=F().token_list.find(h=>h.address==p))==null?void 0:k.symbol)??"]";r.value.push({label:u,value:p})}),(p,u)=>(m(),y(ae,{square:"",flat:"",class:"col q-pa-sm",style:{"max-width":"800px"}},{default:c(()=>[a(V,{class:"q-gutter-y-md"},{default:c(()=>[Ga,a(L,{filled:"",square:"",modelValue:t.value,"onUpdate:modelValue":u[0]||(u[0]=f=>t.value=f),type:"text",label:"Name"},null,8,["modelValue"]),a(L,{filled:"",square:"",modelValue:i.value,"onUpdate:modelValue":u[1]||(u[1]=f=>i.value=f),type:"text",label:"Description"},null,8,["modelValue"])]),_:1}),a(I),a(V,{class:"q-gutter-y-md"},{default:c(()=>[Ya,g("div",Xa,[a(He,{label:"","textbox-label":"Token",onToken_account_selected:u[2]||(u[2]=f=>l.value=f)})]),a(L,{filled:"",square:"",modelValue:o.value,"onUpdate:modelValue":u[3]||(u[3]=f=>o.value=f),type:"number",label:"Tickets Count"},null,8,["modelValue"]),a(L,{filled:"",square:"",type:"number",modelValue:n.value,"onUpdate:modelValue":u[4]||(u[4]=f=>n.value=f),label:"Ticket Price"},null,8,["modelValue"])]),_:1}),a(I),a(V,{class:"q-gutter-y-md"},{default:c(()=>[Ja,g("div",Za,[a(Wt,{class:"full-width",filled:"",square:"",modelValue:b(re)().whitelistSelected,"onUpdate:modelValue":u[5]||(u[5]=f=>b(re)().whitelistSelected=f),clearable:"","use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",behavior:"menu","option-label":f=>{var k;return(k=f.account)==null?void 0:k.name},label:"Whitelist selcted",options:b(re)().whitelists,style:{width:"250px"}},{"no-option":c(()=>[a(J,null,{default:c(()=>[a(N,{class:"text-grey"},{default:c(()=>[C(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","option-label","options"])])]),_:1}),a(I),a(V,{class:"row justify-end"},{default:c(()=>[a(O,{icon:"send",square:"",class:"row",color:"primary",onClick:u[6]||(u[6]=f=>s()),label:"Create"})]),_:1})]),_:1}))}}),tn={class:"row shadow-2"},an={class:""},nn={key:0,class:"row"},ln={key:2,class:"row justify-center"},Rn=_({__name:"RafflePage",setup(e){const t=v("raffle");return ne(async()=>{await A().updateStore()}),(i,o)=>(m(),y(St,{class:"col bg-black"},{default:c(()=>[g("div",tn,[a(it,{modelValue:t.value,"onUpdate:modelValue":o[0]||(o[0]=n=>t.value=n),"no-caps":"","outside-arrows":"","mobile-arrows":"",class:"col bg-dark"},{default:c(()=>[a(de,{name:"raffle",label:"Raffle"}),b(F)().is_admin?(m(),y(de,{key:0,name:"create",label:"Create"})):w("",!0),b(F)().is_admin?(m(),y(de,{key:1,name:"manage",label:"Manage"})):w("",!0)]),_:1},8,["modelValue"]),a(O,{flat:"",class:"bg-dark",icon:"refresh",onClick:o[1]||(o[1]=n=>b(A)().updateStore())})]),g("div",an,[t.value==="raffle"&&b(A)().raffles.length==0?(m(),E("div",nn,[a(te),a(Yt,{class:"row",color:"primary",size:"10rem"}),a(te)])):w("",!0),t.value==="raffle"&&b(A)().raffles.length>0?(m(),y(Ie,{key:1,raffles:b(A)().getRunningRaffles,is_admin:!1},null,8,["raffles"])):w("",!0),t.value==="create"?(m(),E("div",ln,[a(en,{class:"q-mt-xl"})])):w("",!0),t.value==="manage"?(m(),y(Ie,{key:3,raffles:b(A)().raffles,is_admin:b(F)().is_admin},null,8,["raffles","is_admin"])):w("",!0)])]),_:1}))}});export{Rn as default};
